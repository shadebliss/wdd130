try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="9f8ede96-f2ec-43af-90fb-853074d21740",e._sentryDebugIdIdentifier="sentry-dbid-9f8ede96-f2ec-43af-90fb-853074d21740")}catch(e){}("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{}).SENTRY_RELEASE={id:"b44d885"},(self.webpackChunk_loomhq_web_client=self.webpackChunk_loomhq_web_client||[]).push([["7389"],{50744:function(e,t,r){"use strict";r.d(t,{Ay:()=>sP});var s,i,n,o,a,c,l,u,h,d,f,p,m,y,g,b,v,I,E,w=r(51034),_=r(84802);class A{constructor(){(0,w.A)(this,"_bindEventListeners",()=>{document.addEventListener(this._visibilityChange,this._handleVisibilityChange,!1)}),(0,w.A)(this,"_handleVisibilityChange",()=>{let e=document[this._hidden];this._isHidden=e,this._callbacks.forEach(t=>t(e))}),this._isHidden=!1,this._callbacks=new Map,this._hidden=void 0,this._visibilityChange=void 0,"u">typeof document&&("u">typeof document.hidden?(this._isHidden=document.hidden,this._hidden="hidden",this._visibilityChange="visibilitychange"):"u">typeof document.msHidden?(this._isHidden=document.msHidden,this._hidden="msHidden",this._visibilityChange="msvisibilitychange"):"u">typeof document.webkitHidden&&(this._isHidden=document.webkitHidden,this._hidden="webkitHidden",this._visibilityChange="webkitvisibilitychange"),"u">typeof document.addEventListener&&void 0!==this._hidden&&this._bindEventListeners())}addCallback(e,t){if("string"!=typeof e)throw Error("Invalid name, must be string");if("function"!=typeof t)throw Error("Invalid callback, must be function");this._callbacks.set(e,t)}removeCallback(e){this._callbacks.has(e)&&this._callbacks.delete(e)}getIsHidden(){return this._isHidden}}class O{constructor(){this._performance=window.performance}clearMarks(...e){this._performance&&this._performance.clearMarks&&this._performance.clearMarks(...e)}mark(...e){this._performance&&this._performance.mark&&this._performance.mark(...e)}getEntriesByName(...e){return this._performance&&this._performance.getEntriesByName?this._performance.getEntriesByName(...e):[]}getTimeOrigin(){return this._performance&&(this._performance.timeOrigin||this._performance.timing)?this._performance.timeOrigin||this._performance.timing.navigationStart:0}now(){return this._performance&&this._performance.now?this._performance.now():Date.now?Date.now():+new Date}isAvailable(){return!!this._performance&&!!this._performance.clearMarks&&!!this._performance.mark&&!!this._performance.getEntriesByName&&!!this._performance.timing}}function S(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function T(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?S(Object(r),!0).forEach(function(t){(0,w.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):S(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}class P{constructor(e,t){if((0,w.A)(this,"_getEventKey",({task:e,taskId:t})=>t?`${e}.${t}`:e),(0,w.A)(this,"_getEventTimingByName",e=>{let t=this._performance.getEntriesByName(e);return t[t.length-1]}),(0,w.A)(this,"_getApdexFields",e=>{let t=this._getApdexTimings(e),r=this._calculateApdex({duration:t.duration,threshold:e.threshold});return T(T({},t),{},{apdex:r})}),(0,w.A)(this,"_getApdexTimings",e=>{let t=this._getEventKey(e),r=`${t}-start`,s=e.startTime||this._getStartTime(e,r),i=e.stopTime||this._getStopTime();return this._cleanApdexState(t),{startTime:s,stopTime:i,duration:i-s}}),(0,w.A)(this,"_getStartTime",(e,t)=>{let r;let s=this._performance.getTimeOrigin();if(e.type===_.LR.INITIAL_LOAD)r=s;else{let e=this._getEventTimingByName(t);r=s+e.startTime}return r}),(0,w.A)(this,"_getStopTime",()=>this._performance.getTimeOrigin()+this._performance.now()),(0,w.A)(this,"_cleanApdexState",e=>{this._performance.clearMarks(`${e}-start`),this._performance.clearMarks(`${e}-stop`),this._startedEvents.delete(e)}),(0,w.A)(this,"_getVisibilityFields",e=>{let t;if(e.type===_.LR.INITIAL_LOAD)t=!this._wasPreviouslyHidden;else if(e.type===_.LR.TRANSITION){let r=this._getEventKey(e);t=this._isActiveEvents.get(r)}return(e.startTime||e.stopTime)&&(t=!this._pageVisibility.getIsHidden()),{isActiveTab:t}}),(0,w.A)(this,"_calculateApdex",({duration:e,threshold:t=this._threshold})=>e<=t?1:e<=4*t?.5:0),(0,w.A)(this,"_validateStartEvent",e=>{if(!e)throw Error('Missing "event" in Apdex start event');if(!e.task)throw Error('Missing "task" in Apdex start event');if("string"!=typeof e.task)throw Error('Invalid "task" in Apdex start event');if(e.taskId&&"string"!=typeof e.taskId)throw Error('Invalid "taskId" in Apdex start event')}),(0,w.A)(this,"_validateStopEvent",e=>{if(!e)throw Error('Missing "event" in Apdex stop event');if(!e.task)throw Error('Missing "task" in Apdex stop event');if("string"!=typeof e.task)throw Error('Invalid "task" in Apdex stop event');if(e.taskId&&"string"!=typeof e.taskId)throw Error('Invalid "taskId" in Apdex stop event');if(!e.type)throw Error('Missing "type" in Apdex stop event');if(e.type&&!(0,_.Xj)(_.LR,e.type))throw Error('Invalid "type" in Apdex stop event');if(e.threshold&&"number"!=typeof e.threshold)throw Error('Invalid "threshold" in Apdex stop event');if(!e.startTime&&e.type===_.LR.TRANSITION){let t=this._getEventKey(e);if(!this._startedEvents.has(t))throw Error(`Apdex event transition "${t}" was not started`)}if(e.startTime&&!("number"==typeof e.startTime&&e.startTime>=0))throw Error('Invalid "startTime" in Apdex stop event');if(e.stopTime&&"number"!=typeof e.stopTime)throw Error('Invalid "stopTime" in Apdex stop event');if(e.stopTime<=e.startTime)throw Error('"stopTime" should be greater than "startTime" in Apdex stop event')}),(0,w.A)(this,"_shouldSendEvent",e=>!(!e||"number"!=typeof e.apdex)),(0,w.A)(this,"_sendEvent",(e,t)=>{this._shouldSendEvent(e)&&this._onEvent({source:"ui",action:"readyForUser",actionSubject:"ui",attributes:T(T({},e.additionalAttributes),{},{task:e.task,taskId:e.taskId,type:e.type,threshold:e.threshold||this._threshold,apdex:e.apdex,startTime:e.startTime,stopTime:e.stopTime,duration:e.duration,isActiveTab:e.isActiveTab})},t)}),!e)throw Error("Missing onEvent callback");if("function"!=typeof e)throw Error("Invalid onEvent, must be function");if(!(t instanceof A))throw Error("Invalid pageVisibility, must be PageVisibility class");this._startedEvents=new Map,this._performance=new O,this._onEvent=e,this._threshold=1e3,this._wasPreviouslyHidden=t.getIsHidden(),this._isActiveEvents=new Map,this._pageVisibility=t,this._pageVisibility.addCallback("apdexEvent",e=>{this.onVisibilityChange(!e)})}start(e){if(this._validateStartEvent(e),!this._performance.isAvailable())return;let t=this._getEventKey(e),r=`${t}-start`;this._startedEvents.set(t,!0),this._isActiveEvents.set(t,!this._pageVisibility.getIsHidden()),this._performance.clearMarks(r),this._performance.mark(r)}getStart(e){if(this._validateStartEvent(e),!this._performance.isAvailable())return;let t=`${this._getEventKey(e)}-start`;return this._getEventTimingByName(t)}stop(e,t){if(this._validateStopEvent(e),!this._performance.isAvailable())return;let r=this._getApdexFields(e),s=this._getVisibilityFields(e);this._sendEvent(T(T(T({},e),r),s),t)}onVisibilityChange(e){e||(this._wasPreviouslyHidden=!0,Array.from(this._isActiveEvents.keys()).forEach(e=>this._isActiveEvents.set(e,!1)))}}var C=r(68731);let k=e=>"function"==typeof e,D=(e,t)=>()=>{if(k(e))try{return e()}catch(e){C.error(`${t} - ${e instanceof Error?e.message:String(e)}`);return}return e};var R="xpis",j=["jira","confluence","townsquare","loom"],N=r(12958),x=r(77408),L=r(24868),M=r(15200),F=r(4449),U=r(31259),B=r(45440),$=(0,N.A)(function e(){var t=this;(0,x.A)(this,e),(0,w.A)(this,"data",{}),(0,w.A)(this,"length",0),(0,w.A)(this,"setItem",function(e,r){return t.data[e]=r,t.length=Object.keys(t.data).length,r}),(0,w.A)(this,"getItem",function(e){return e in t.data?t.data[e]:null}),(0,w.A)(this,"removeItem",function(e){return e in t.data&&delete t.data[e],t.length=Object.keys(t.data).length,null}),(0,w.A)(this,"clear",function(){t.data={},t.length=0}),(0,w.A)(this,"key",function(e){return Object.keys(t.data)[e]})});let H=new $;var K="awcInMemoryStorageFallback",W=((s={}).DEV="dev",s.LOCAL="local",s.PROD="prod",s.STAGING="staging",s);function G(e){var t="test_value";if(!e)return!1;try{var r="awc.storage.support";e.setItem(r,t);var s=e.getItem(r);return e.removeItem(r),s===t}catch{return!1}}function V(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(V=function(){return!!e})()}var q=function(e){function t(e){var r,s,i;(0,x.A)(this,t);try{r=window.sessionStorage||H}catch{r=H}return s=t,i=[r,e],s=(0,U.A)(s),(0,F.A)(this,V()?Reflect.construct(s,i||[],(0,U.A)(this).constructor):s.apply(this,i))}return(0,B.A)(t,e),(0,N.A)(t)}((0,N.A)(function e(t){var r=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,x.A)(this,e),(0,w.A)(this,"getStore",function(){return r.store}),(0,w.A)(this,"getItem",function(e){return r.store.getItem(r.createKey(e))}),(0,w.A)(this,"removeItem",function(e){return r.store.removeItem(r.createKey(e))}),(0,w.A)(this,"setItem",function(e,t){try{r.store.setItem(r.createKey(e),t)}catch(s){(function(e){var t=!1;if(e.code)switch(e.code){case 22:t=!0;break;case 1014:"NS_ERROR_DOM_QUOTA_REACHED"===e.name&&(t=!0)}else -2147024882===e.number&&(t=!0);return t})(s)&&(r.swapToInMemory(),r.store.setItem(r.createKey(e),t))}}),(0,w.A)(this,"swapToInMemory",function(){if(!(r.store===H||typeof window>"u")){var e,t=Object.keys(r.store||{});G(window[K])?e=window[K]:(e=H,window[K]||(window[K]=H)),t.forEach(function(t){if(0===t.indexOf(r.getPrefix())){var s=r.store.getItem(t);s&&e.setItem(t,s)}}),r.store=e}}),(0,w.A)(this,"clear",function(){return r.store.clear()}),(0,w.A)(this,"key",function(e){return r.store.key(e)}),(0,w.A)(this,"getPrefix",function(){return r.prefix}),(0,w.A)(this,"createKey",function(e){return r.prefix?"".concat(r.getPrefix(),".").concat(e):e}),this.options=s;var i=[];(void 0===s.useStoragePrefix||s.useStoragePrefix)&&i.push("awc"),s.envPrefix&&s.envPrefix!==W.PROD&&i.push(s.envPrefix),this.prefix=i.join("-"),G(t)?this.store=t:this.swapToInMemory()})),Q="interactionSession.id",J="interactionSession.id.prev",Y="interactionSession.expiry",X=/^\d+$/,z="interactionSessionIdUpdated",Z=(0,N.A)(function e(){var t=this;(0,x.A)(this,e),(0,w.A)(this,"analyticsReady",!1),(0,w.A)(this,"generateNewSessionId",function(){if(!t.analyticsReady)return null;var e=t.safeSessionStorage.getItem(Q),r=Date.now().toString();return t.safeSessionStorage.setItem(Q,r),e?(t.safeSessionStorage.setItem(J,e),t.sendInteractionSessionEvent("renewed")):t.sendInteractionSessionEvent("started"),document.dispatchEvent(new Event(z)),r}),(0,w.A)(this,"updateSessionExpiry",function(){var e=Date.now()+t.sessionExpiryTime;return t.safeSessionStorage.setItem(Y,e.toString()),e}),(0,w.A)(this,"debouncedUpdateSessionExpiry",function(e){var r=t.updateSessionExpiry;e<Date.now()+t.sessionExpiryDebounceThresholdPercentage*t.sessionExpiryTime?r():(t.sessionExpiryDebounceTimer&&clearTimeout(t.sessionExpiryDebounceTimer),t.sessionExpiryDebounceTimer=setTimeout(function(){r()},t.sessionExpiryDebounce))}),this.sessionExpiryTime=18e5,this.sessionExpiryDebounce=5e3,this.sessionExpiryDebounceThresholdPercentage=.9,this.safeSessionStorage=new q},[{key:"getCurrentInteractionSessionId",value:function(){if(!this.analyticsReady)return null;var e=this.safeSessionStorage.getItem(Q),t=parseInt(this.safeSessionStorage.getItem(Y)||"0",10)||0;return this.debouncedUpdateSessionExpiry(t),!e||t<=Date.now()||Number.isNaN(t)?this.generateNewSessionId():e}},{key:"getPreviousInteractionSessionId",value:function(){return this.analyticsReady?this.safeSessionStorage.getItem(J):null}},{key:"setInteractionSessionId",value:function(e){return!!this.validateSessionId(e)&&this.safeSessionStorage.getItem(Q)!==e&&(this.debouncedUpdateSessionExpiry(0),this.safeSessionStorage.setItem(Q,e),this.safeSessionStorage.removeItem(J),document.dispatchEvent(new Event(z)),!0)}},{key:"setAnalyticsCallback",value:function(e){this.analyticsReady||(e&&"function"==typeof e?(this.sendEventCallback=e,this.analyticsReady=!0):this.analyticsReady=!1)}},{key:"validateSessionId",value:function(e){if(e&&X.test(e)){var t=Date.now()-parseInt(e,10);if(t>=0&&t<=864e5)return!0}return!1}},{key:"sendInteractionSessionEvent",value:function(e){this.sendEventCallback&&this.sendEventCallback({action:e,actionSubject:"interactionSession",source:"interactionComponent",tags:["navigationExperiences"]})}}]),ee=r(68731),et="analyticsInteractionSesssionTrackingClient",er=(0,N.A)(function e(){(0,x.A)(this,e)},null,[{key:"getInstance",value:function(){var e;try{et in window||(window[et]=new Z),e=window[et]}catch(e){ee.error("Error initialising InteractionSessionTracking - ".concat(e instanceof Error?e.message:String(e)))}return e}}]),es="interactionSession.source",ei="interactionSession.bridge",en=(0,N.A)(function e(t,r,s){var i=this;if((0,x.A)(this,e),(0,w.A)(this,"getCurrentInteractionSessionId",function(){return i.isEnabled&&i.interactionSessionTracking?i.interactionSessionTracking.getCurrentInteractionSessionId():null}),(0,w.A)(this,"getPreviousInteractionSessionId",function(){return i.isEnabled&&i.interactionSessionTracking?i.interactionSessionTracking.getPreviousInteractionSessionId():null}),(0,w.A)(this,"getBridge",function(){return i.isEnabled&&i.safeSessionStorage?i.safeSessionStorage.getItem(ei):null}),(0,w.A)(this,"getInteractionSource",function(){return i.isEnabled&&i.safeSessionStorage?i.safeSessionStorage.getItem(es):null}),this.isEnabled=(0,M.fg)("analytics_cross_product_interaction_tracking")&&!(0,L.F2)(),this.isEnabled){this.interactionSessionTracking=er.getInstance();var n=!1;this.interactionSessionTracking&&t&&(this.interactionSessionTracking.setAnalyticsCallback(t.analyticsEventCallback),n=this.interactionSessionTracking.setInteractionSessionId(t.persistedSessionId)),this.safeSessionStorage=new q,n&&(r&&this.safeSessionStorage.setItem(ei,r),s&&this.safeSessionStorage.setItem(es,s))}}),eo=r(42433);let ea=(e,t)=>Object.keys(e).reduce((r,s)=>{let i=t(e[s],s,e);return r[i]=e[s],r},{}),ec=(e,t)=>t.reduce((t,r)=>(r in e&&(t[r]=e[r]),t),{}),el=(e,t)=>Object.keys(e).filter(r=>!t(e[r],r)).reduce((t,r)=>(t[r]=e[r],t),{}),eu=(e,t)=>Object.keys(e).filter(r=>t(e[r],r)).reduce((t,r)=>(t[r]=e[r],t),{}),eh=(e,t)=>Object.keys(e).filter(e=>0>t.indexOf(e)).reduce((t,r)=>(t[r]=e[r],t),{}),ed=(e,t)=>{if(e===t)return!0;if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(!e||!t||"object"!=typeof e&&"object"!=typeof t)return e===t;if(e.prototype!==t.prototype)return!1;let r=Object.keys(e);return r.length===Object.keys(t).length&&r.every(r=>ed(e[r],t[r]))},ef=(e,t)=>e.reduce((e,r,s,i)=>(e[t(r,s,i)?0:1].push(r),e),[[],[]]),ep=e=>window.history.replaceState({},"",e),em=(e,t=ep)=>{let r=window.location.href,s=window.location.hash,i=""!==s?r.replace(s,""):r,{url:n,query:o}=(0,eo.parseUrl)(i),a=eu(o,e);if(Object.keys(a).length>0){let r=el(o,e);if(Object.keys(r).length>0){let e=`${n}?${(0,eo.stringify)(r)}${s}`;t(e)}else t(`${n}${s}`)}return a},ey=(e,t)=>t===R;class eg{constructor(e){if((0,w.A)(this,"validProduct",!1),this.isEnabled=(0,M.fg)("analytics_cross_product_interaction_tracking")&&e.perimeter!==_.KW.FEDRAMP_MODERATE,this.urlValidation={result:!0,interactionSessionBlob:""},this.sendEventCallback=e.sendEventCallback,this.isEnabled){let t,r,s,i;if(this.validProduct=j.includes(e.product),this.validProduct){let e=em(ey),n=R in e?e[R]:null;if(n)try{let e=JSON.parse(atob(n));e.bridge&&e.id&&e.source?(t=e.bridge,r=e.id,s=e.source):(this.urlValidation.result=!1,this.urlValidation.interactionSessionBlob=n)}catch{this.urlValidation.result=!1,this.urlValidation.interactionSessionBlob=n}i={analyticsEventCallback:this.sendEventCallback,persistedSessionId:r}}this.analyticsCrossProductInteractionClient=new en(i,t,s)}}getInteractionSession(){return this.isEnabled&&this.analyticsCrossProductInteractionClient?{bridge:this.analyticsCrossProductInteractionClient.getBridge(),id:this.analyticsCrossProductInteractionClient.getCurrentInteractionSessionId(),prevId:this.analyticsCrossProductInteractionClient.getPreviousInteractionSessionId(),source:this.analyticsCrossProductInteractionClient.getInteractionSource()}:{bridge:null,id:null,prevId:null,source:null}}validateInteractionSession(){this.urlValidation.result||this.sendEventCallback({action:"corrupted",actionSubject:"interactionSession",attributes:{interactionSessionBlob:this.urlValidation.interactionSessionBlob},source:"interactionComponent",tags:["navigationExperiences"]})}}let eb=e=>e.embeddedType===_.vH.FIRST_PARTY&&void 0!==e.embeddedFromProduct,ev=e=>e.embeddedType===_.vH.THIRD_PARTY&&void 0!==e.embeddedFromTopLevelDomain;function eI(e){return!0==(null!==e&&"object"==typeof e&&!1===Array.isArray(e))&&"[object Object]"===Object.prototype.toString.call(e)}function eE(e){if(!1===eI(e))return!1;let t=e.constructor;if("function"!=typeof t)return!1;let r=t.prototype;return!(!1===eI(r)||!("isPrototypeOf"in r))}function ew(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function e_(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ew(Object(r),!0).forEach(function(t){(0,w.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ew(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function eA(e){return{tenantIdType:e.tenantIdType,tenantId:e.tenantId}}function eO(e){return{userIdType:e.userIdType}}function eS(e){return{orgId:e.orgId}}function eT(e){return{workspaceId:e.workspaceId}}function eP(e){if(eN(e))return{aliases:e}}function eC(e){if(eN(e))return{groups:e}}function ek(e){return e.anonymousId?{anonymousId:e.anonymousId}:{}}function eD(e){if((0,M.fg)("analytics_cross_product_interaction_tracking"))return{interactionSession:e}}function eR(e,t){return void 0===t?e:t}function ej(e,t){let r=t||{},s=eR(e.env,r.env),i=eR(e.product,r.product),n=eR(e.subproduct(),r.subproduct),o=eR(e.version,r.version),a=eR(e.origin,r.origin),c=eR(e.platform,r.platform),l=e.ic;return{env:s,product:i,subproduct:n,version:o,origin:a,platform:c,ic:l}}function eN(e){return eE(e)&&Object.keys(e).length>0}function ex(e,t){return eN(t)?{[e]:t}:void 0}function eL(e){if(eN(e)){let t=function(e){let t={};return Object.keys(e).forEach(r=>{let s=e[r];t[r]={id:s.id,type:s.type}}),t}(e);return ex("containers",t)}}function eM(e,t){return e_({containerType:e.containerType,containerId:e.containerId,source:e.source,objectType:e.objectType,objectId:e.objectId,actionSubject:e.actionSubject,action:e.action,actionSubjectId:e.actionSubjectId,attributes:e.attributes,nonPrivacySafeAttributes:e.nonPrivacySafeAttributes,tags:e.tags,highPriority:e.highPriority,eventType:t},eL(e.containers))}function eF(e){return`${e.actionSubject} ${e.action}`}let eU=((i={}).QUIET="quiet",i.STANDARD="standard",i.COMPLETE="complete",i);function eB(e,t,r,s,i,n,o,a,c,l,u,h,d,f){let p=ej(e,function(e){let{env:t,product:r,subproduct:s,version:i,origin:n,platform:o}=e;return{env:t,product:r,subproduct:s,version:i,origin:n,platform:o}}(s)),m=eA(t),y=eS(l),g=eT(h),b=eO(r),v=eM(s,i);return e_(e_(e_(e_(e_(e_(e_(e_(e_(e_({},p),m),y),b),v),ek(s)),{},{tabId:n,sessionId:o,taskSessions:a},eD(c)),{},{pageLoadId:u},g),eP(d)),eC(f))}let e$=1e4,eH=Object.freeze([_.$q.OPERATIONAL,_.$q.TRACK,_.$q.UI]);function eK(e){if(e){if(e&&e.constructor!==Object)throw Error("properties.containers must be an Object");Object.values(e).forEach(e=>(function(e){if(!eE(e))throw Error("properties.containers must be an Object");if(!("id"in e))throw Error("properties.containers is missing field 'id'");if("string"!=typeof e.id)throw Error("properties.containers.id must be of type String");if("type"in e&&"string"!=typeof e.type)throw Error("properties.containers.type must be of type String")})(e))}}function eW(e){switch(e){case _.$q.OPERATIONAL:case _.$q.TRACK:case _.$q.UI:return!0;default:return!1}}function eG(e){if(!e)throw Error("Missing event");if(!e.source)throw Error("Missing event.source");if(!e.actionSubject)throw Error("Missing event.actionSubject");if(!e.action)throw Error("Missing event.action");eK(e.containers)}class eV{constructor(e,t){if((0,w.A)(this,"canCompress",e=>{try{return e&&eW(e.eventType)&&this.predicate(e)}catch{return!1}}),(0,w.A)(this,"compress",e=>{let[t,r]=ef(e,e=>this.canCompress(e)),s=this.compressFn(t);if(!s)throw Error("No events were returned from the compression function");return s.forEach(e=>{(function(e){if(!eW(e))throw Error(`Invalid action event type: ${e}, must be one of: [${eH}]`)})(e.eventType),eG(e)}),s.concat(r)}),"function"!=typeof e)throw Error("Invalid predicate, must be a function that accepts an event and returns a boolean");if("function"!=typeof t)throw Error("Invalid compressFn, must be a function that both accepts and returns an array of events");this.predicate=e,this.compressFn=t}}function eq(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function eQ(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?eq(Object(r),!0).forEach(function(t){(0,w.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):eq(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}class eJ{constructor(e=[]){if((0,w.A)(this,"canCompress",e=>this.compressionRules.some(t=>t.canCompress(e))),(0,w.A)(this,"compress",e=>this.createGroups(e).reduce((e,t)=>{let r=this.compressGroup(t);return e.concat(r)},[])),(0,w.A)(this,"createGroups",e=>e.reduce((e,t)=>{let r;let s=this.compressionRules.find(e=>e.canCompress(t));if(s){let e=eM(t,t.eventType);r=eh(t,Object.keys(e))}let i=e.find(e=>s===e.compressor&&ed(r,e.contextFields));return i?i.events.push(t):e.push({contextFields:r,compressor:s,events:[t]}),e},[])),(0,w.A)(this,"compressGroup",e=>{if(!e.compressor)return e.events;try{return e.compressor.compress(e.events).map(t=>eQ(eQ({},t),e.contextFields))}catch{return e.events}}),!Array.isArray(e))throw Error("Event compressors must be constructed with an array of CompressionRules");if(!e.every(e=>e instanceof eV))throw Error("Event compressors can only be constructed with instances of CompressionRule");this.compressionRules=e}}var eY=r(68731);class eX{constructor(e,t){(0,w.A)(this,"push",(e,t,r,s)=>{this.eventArgs.push({identifier:e,builtEvent:t,context:r,userInfo:s})}),(0,w.A)(this,"size",()=>this.eventArgs.length),(0,w.A)(this,"startFlush",()=>{try{this.eventArgs=this.compressEventArgs(this.eventArgs)}catch(e){eY.warn(`Failed to perform compression on the delayed analytics events. Error: ${e.message}. Sending ${this.eventArgs.length} uncompressed events instead`)}this.flushNextBatch()}),(0,w.A)(this,"cancelFlush",()=>{this.flushBatchTimeout&&(clearTimeout(this.flushBatchTimeout),this.flushBatchTimeout=null)}),(0,w.A)(this,"flushNextBatch",()=>{this.eventArgs.splice(0,7).forEach(e=>this.processFn(e.identifier,e.builtEvent,e.context,e.userInfo)),this.eventArgs.length>0?this.flushBatchTimeout=setTimeout(()=>this.flushNextBatch(),100):this.flushBatchTimeout=null}),(0,w.A)(this,"compressEventArgs",e=>{let[t,r]=ef(e,e=>this.compressor.canCompress(e.builtEvent)),s=t.reduce((e,t)=>{let r=e.find(e=>ed(e.userInfo,t.userInfo)&&ed(e.context,t.context));return r?r.eventArgs.push(t):e.push({userInfo:t.userInfo,context:t.context,eventArgs:[t]}),e},[]).reduce((e,t)=>{try{let r=t.eventArgs.map(e=>e.builtEvent),s=this.compressor.compress(r).map(e=>({identifier:eF(e),builtEvent:e,userInfo:t.userInfo,context:t.context}));return e.concat(s)}catch(e){return eY.warn(`Failed to compress some analytics events. Error: ${e.message}. Sending ${t.eventArgs.length} uncompressed events instead`),t.eventArgs}},[]);return r.forEach(e=>s.push(e)),s}),this.processFn=e,this.flushBatchTimeout=null,this.eventArgs=[],this.compressor=new eJ(t)}}let ez=((n={}).TIMEOUT="timeout",n.MANUAL="manual",n);class eZ{constructor(e,t){(0,w.A)(this,"push",(e,t,r,s)=>{this.delayQueue.push(e,t,r,s)}),(0,w.A)(this,"startLowPriorityEventDelay",(e=e$,t)=>{if(Number.isNaN(e)||e<=0)throw Error(`Invalid timeout period: ${e}, must be a number greater than 0`);this.delayTimeout&&clearTimeout(this.delayTimeout),this.delayCallback=t,this.delayTimeout=setTimeout(()=>this.stopLowPriorityEventDelay(ez.TIMEOUT),e?Math.min(e,3e4):3e4),this.delayQueue.cancelFlush(),this.isDelaying=!0}),(0,w.A)(this,"stopLowPriorityEventDelay",(e=ez.MANUAL)=>{var t;this.delayTimeout&&(clearTimeout(this.delayTimeout),this.delayTimeout=void 0),this.delayQueue.startFlush(),this.isDelaying=!1,null===(t=this.delayCallback)||void 0===t||t.call(this,e),this.delayCallback=void 0}),(0,w.A)(this,"isDelayingLowPriorityEvents",()=>this.isDelaying),this.isDelaying=!1,this.delayQueue=new eX(e,t)}}let e0=((o={}).IN_PROGRESS="inProgress",o.QUEUE="queue",o.RECLAIM_START="reclaimStart",o.RECLAIM_END="reclaimEnd",o.ACK="ack",o),e1=((a={})[a.RECLAIM_TIMEOUT=1e4]="RECLAIM_TIMEOUT",a[a.RECLAIM_WAIT=500]="RECLAIM_WAIT",a[a.RECLAIM_WAIT_THRESHOLD=2e3]="RECLAIM_WAIT_THRESHOLD",a),e4=(e,t)=>({[e0.ACK]:`${e}.${t}.${e0.ACK}`,[e0.QUEUE]:`${e}.${t}.${e0.QUEUE}`,[e0.IN_PROGRESS]:`${e}.${t}.${e0.IN_PROGRESS}`,[e0.RECLAIM_START]:`${e}.${t}.${e0.RECLAIM_START}`,[e0.RECLAIM_END]:`${e}.${t}.${e0.RECLAIM_END}`}),e2=Object.values(e0),e3=e=>{if("string"!=typeof e||0===e.length)return 0;try{let t=Object.keys(localStorage).filter(t=>t&&t.startsWith(`${e}.`)||!1).map(e=>e.split(".")).filter(e=>3===e.length&&e2.includes(e[2])).reduce((e,t)=>{let[,r,s]=t;return void 0===e[r]&&(e[r]={}),e[r][s]=!0,e},{}),r=Object.keys(t).filter(e=>!0!==t[e][e0.ACK]);return r.forEach(t=>{let{queue:r,inProgress:s,reclaimStart:i,reclaimEnd:n}=e4(e,t);localStorage.removeItem(s),localStorage.removeItem(r),localStorage.removeItem(i),localStorage.removeItem(n)}),r.length}catch{}return 0};function e5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function e6(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?e5(Object(r),!0).forEach(function(t){(0,w.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):e5(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let e7=e=>new Promise(t=>{setTimeout(t,e)}),e8=e=>{try{return Object.keys(localStorage).filter(t=>t.startsWith(e)).map(e=>e.split(".")).filter(t=>{if(3===t.length&&t[0]===e&&t[2]===e0.ACK)try{let e=localStorage.getItem(t.join("."));if(e){let t=parseInt(e);return e1.RECLAIM_TIMEOUT+t<Date.now()}}catch{}return!1}).map(e=>e[1])}catch{}return[]},e9=async(e,t)=>{let{ack:r,reclaimStart:s,reclaimEnd:i}=e.storageKeys,n=Date.now();if(localStorage.setItem(s,e.reclaimProcessId),localStorage.setItem(r,n.toString()),await e7(e1.RECLAIM_WAIT),Date.now()>n+e1.RECLAIM_WAIT_THRESHOLD||localStorage.getItem(s)!==e.reclaimProcessId)throw Error("Took to long to callback, reclaim abandonded. After reclaimStart.");if(localStorage.setItem(i,e.reclaimProcessId),await e7(e1.RECLAIM_WAIT),Date.now()>n+e1.RECLAIM_WAIT_THRESHOLD||localStorage.getItem(s)!==e.reclaimProcessId||localStorage.getItem(i)!==e.reclaimProcessId)throw Error("Took to long to callback, reclaim abandonded. After reclaimEnd.");return te(e,t)},te=async(e,t)=>{let{queue:r,inProgress:s}=e.storageKeys,i=JSON.parse(localStorage.getItem(r)||"[]"),n=JSON.parse(localStorage.getItem(s)||"{}"),o=Object.entries(n).map(([e,t])=>e6(e6({},t),{},{attemptNumber:t.attemptNumber+1,id:e})),a=[...i,...o];if(a.length>0){let i=await t(a);if("successful"===i.status)tt(e.storageKeys);else if("partial"===i.status){let e=a.filter(e=>!i.acceptedItemIds.includes(e.id));return localStorage.removeItem(s),localStorage.setItem(r,JSON.stringify(e)),{fullReclaim:!1}}}else tt(e.storageKeys);return{fullReclaim:!0}},tt=e=>{localStorage.removeItem(e.queue),localStorage.removeItem(e.inProgress),localStorage.removeItem(e.reclaimEnd),localStorage.removeItem(e.reclaimStart),localStorage.removeItem(e.ack)},tr=async(e,t)=>{if("string"!=typeof e||0===e.length)return{fullReclaims:0,partialReclaims:0,failedReclaims:0};let r=crypto.randomUUID(),s=e8(e).map(s=>e9({queuePrefix:e,reclaimProcessId:r,storageKeys:e4(e,s)},t)),i=await Promise.allSettled(s),n=i.filter(e=>"rejected"===e.status),o=i.filter(e=>"fulfilled"===e.status).map(e=>e.value),a=o.filter(e=>e.fullReclaim),c=o.filter(e=>!e.fullReclaim);return{failedReclaims:n.length,partialReclaims:c.length,fullReclaims:a.length}},ts="namespace-timeAdded",ti="analytics-resilience",tn="timeToBeProcessedAfter",to="timeAdded",ta="retryAttempts",tc=((c={}).INDEXEDDB="indexeddb",c.MEMORY="memory",c),tl=((l={}).IGNORE="ignore",l.ABANDON="abandon",l.EVICT="evict",l);class tu extends Error{constructor(){super("window.indexeddb is undefined."),Object.setPrototypeOf(this,tu.prototype),this.name="NoIndexedDbError"}}let th="AbandonWriteError";class td extends Error{constructor(e){super(`Event Limit reached. Abandoning write to: ${e}`),Object.setPrototypeOf(this,td.prototype),this.name=th}}let tf="CallbackProcessingError";class tp extends Error{constructor(e){let t=e&&"object"==typeof e&&"toString"in e&&"function"==typeof e.toString&&e.toString()||"string"==typeof e&&e||"Argument passed to CallbackProcessingError was not an Error or string.";super(`Error thrown while processing events in callback: ${t}`),Object.setPrototypeOf(this,tp.prototype),this.name=tf}}let tm="InvalidPolicyError";class ty extends Error{constructor(e,t){super(`Method '${t}' cannot be called with policy '${e}'.`),this.name=tm}}let tg=e=>!!e&&"object"==typeof e&&"name"in e&&"string"==typeof e.name&&(e.name===th||e.name===tf||e.name===tm);var tb=r(50938);let tv=7;var tI=r(68731);let tE=(e,t,{id:r,retryAttempts:s,timeToProcessOffset:i})=>({item:e,id:r||crypto.randomUUID(),retryAttempts:s||0,timeToBeProcessedAfter:Date.now()+(i||0),namespace:t,timeAdded:Date.now()}),tw=e=>({logger:e.logger||tI,useMemory:e.useMemory||!1,maxAttempts:e.maxAttempts||10,maxEventLimit:e.maxEventLimit||5e3}),t_=e=>new Promise((t,r)=>{e.onsuccess=e=>{t(e)},e.onerror=e=>{r(e)}}),tA=e=>new Promise((t,r)=>{e.oncomplete=()=>{t()},e.onerror=e=>{r(e)},e.onabort=e=>{r(e)}}),tO=(e,t)=>{try{"function"==typeof e.commit&&e.commit()}catch(e){throw t.error("Failed to force commit transaction:",e),e}return tA(e)},tS=(e,t)=>{e.onerror=e=>{t.warn("Error thrown from request:",e)}};class tT{constructor(e,t,r,s){if((0,w.A)(this,"deleteOldestNEvents",async(e,t)=>{var r;let s=e.index(ts),i=IDBKeyRange.bound([this.namespace,0],[this.namespace,Date.now()]),n=s.getAllKeys(i,t),o=await t_(n),a=null==o||null===(r=o.target)||void 0===r?void 0:r.result;if(a&&Array.isArray(a)&&a.length>0)try{let t=a.map(t=>this.deleteItemHandler(e,t));await Promise.all(t)}catch(e){throw this.logger.warn("Failed to delete items from indexeddb.",e),e}}),e>0)this.eventLimit=e;else throw Error("Event Limit has to be set higher than 1");this.namespace=t,this.logger=r,this.deleteItemHandler=s}async insertItems(e,t,r=tl.ABANDON){let s=[...t],i=0;switch(r){case tl.ABANDON:await this.throwIfNotEnoughSpace(e,t.length);break;case tl.EVICT:i=await this.evictIfNotEnoughSpace(e,t.length);break;case tl.IGNORE:await this.calculateHowManyEventsWeCanAdd(e,s)}let n=s.map(t=>t_(e.add(t)));return await Promise.all(n),await tO(e.transaction,this.logger),{items:s,numberOfEvictedItems:i}}async throwIfNotEnoughSpace(e,t){let r=await this.calculateFreeSpace(e);if(r<t)throw new td(`Not enough space in IndexedDb. Needed ${t} but only had ${r}`)}async evictIfNotEnoughSpace(e,t){let r=await this.calculateFreeSpace(e);if(r<t){let s=t-r;return await this.deleteOldestNEvents(e,s),s}return 0}async calculateHowManyEventsWeCanAdd(e,t){let r=await this.calculateFreeSpace(e);if(r<t.length){let e=t.length-r,s=t.length-e;t.splice(s,e)}}async calculateFreeSpace(e){let t=await this.getCountofEventsInObjectStore(e);return this.eventLimit-t}async getCountofEventsInObjectStore(e){let t=e.index(ts),r=IDBKeyRange.bound([this.namespace,0],[this.namespace,Date.now()]),s=t.count(r);return(await t_(s)).target.result}}let tP=["item"],tC=["items"];function tk(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}class tD{constructor(e,t={}){if((0,w.A)(this,"startDB",async()=>new Promise(async(e,t)=>{if("u">typeof window){let r=window.setTimeout(()=>{this.logger.warn("IndexedDB timed out."),t(new tu)},15e3),s=window.indexedDB.open("analytics-web-client",1);s.onupgradeneeded=e=>{if(0!==e.oldVersion)throw Error("We cannot upgrade the database. Do not do this.");let t=s.result.createObjectStore(ti,{keyPath:"id"});t.createIndex(tn,tn,{unique:!1}),t.createIndex(ta,ta,{unique:!1}),t.createIndex(to,to,{unique:!1}),t.createIndex(ts,["namespace","timeAdded"],{unique:!1})},s.onerror=function(){t(new tu)};try{return await t_(s),e(s.result)}catch(e){this.logger.warn("IndexedDB failed to initialise.",e),t(new tu)}finally{window.clearTimeout(r)}}else this.logger.warn("IndexedDB failed to initialise. No 'window' object."),t(new tu)})),(0,w.A)(this,"addItem",async(e,t={},r=tl.ABANDON)=>{let{logger:s,namespace:i}=this,n=tE(e,i,t),{objectStore:o}=await this.getObjectStoreAndTransaction("readwrite");if(r===tl.IGNORE)throw new ty(r,"IndexedDbConnector#addItem");try{if(!n.namespace||0===n.namespace.length||"string"!=typeof n.namespace)throw Error("Namespace not specified");let e=await this.globalEventLimitGuard.insertItems(o,[n],r);if(1===e.items.length)return{item:e.items[0],numberOfEvictedItems:e.numberOfEvictedItems};throw Error(`Incorrect number of items added. Expected: 1, got: ${e.items.length}`)}catch(e){throw tg(e)?e:(s.log("Failed to add item to table",e),Error("Request to add item to table failed"))}}),(0,w.A)(this,"bulkAddItem",async(e,t=tl.ABANDON)=>{let{logger:r,namespace:s}=this,i=e.map(e=>{let{item:t}=e;return tE(t,s,(0,tb.A)(e,tP))}),{objectStore:n}=await this.getObjectStoreAndTransaction("readwrite");try{return await this.globalEventLimitGuard.insertItems(n,i,t)}catch(e){throw tg(e)?e:(r.log("Failed to add item to table",e),Error("Request to add item to table failed"))}}),(0,w.A)(this,"getItems",async(e=tv)=>{let t=e>0?e:tv,{logger:r}=this,s=this.options.maxAttempts,{transaction:i,objectStore:n}=await this.getObjectStoreAndTransaction("readwrite"),o=n.index(tn),a=IDBKeyRange.upperBound(Date.now()),c=o.openCursor(a),l=await new Promise(async(e,i)=>{let n=[],o=0;c.onerror=e=>{r.error("Failed to open cursor:",e),i("Failed to open cursor")},c.onsuccess=i=>{let a=i.target.result;if(a){let i=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?tk(Object(r),!0).forEach(function(t){(0,w.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tk(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({},a.value);n.push(i);let c=a.value;if(c.retryAttempts+=1,c.timeToBeProcessedAfter=Date.now()+6e4,c.retryAttempts>=s){++o;let e=a.delete();tS(e,r)}else{let e=a.update(c);tS(e,r)}n.length<t?a.continue():e({items:n,numberOfDeletedItems:o})}else e({items:n,numberOfDeletedItems:o})}});return await tO(i,this.logger),l}),(0,w.A)(this,"deleteItems",async e=>{let{transaction:t,objectStore:r}=await this.getObjectStoreAndTransaction("readwrite");try{let s=e.map(e=>this.deleteItem(r,e));await tO(t,this.logger),await Promise.all(s)}catch(e){throw this.logger.warn("Failed to delete items from indexeddb.",e),e}}),(0,w.A)(this,"getItemCount",async()=>{let{transaction:e,objectStore:t}=await this.getObjectStoreAndTransaction("readonly"),r=t.index(tn),s=IDBKeyRange.upperBound(Date.now()),i=r.count(s),n=await t_(i);return await tO(e,this.logger),n.target.result}),(0,w.A)(this,"processItems",async(e,t=tv)=>{let r=await this.getItems(t),{items:s}=r,i=(0,tb.A)(r,tC);try{let t=await e(s,i),r=s.map(e=>e.id);return await this.deleteItems(r),t}catch(e){throw new tp(e)}}),(0,w.A)(this,"deleteItem",async(e,t)=>{let{logger:r}=this;try{await t_(e.delete(t))}catch(e){throw r.error("Failed to delete item:",t,e),e}}),(0,w.A)(this,"getObjectStoreAndTransaction",async e=>{let t=(await this.db).transaction(ti,e),r=t.objectStore(ti);return{transaction:t,objectStore:r}}),this.options=tw(t),this.namespace=e,this.logger=this.options.logger,!window.indexedDB)throw new tu;this.db=this.startDB(),this.db.catch(()=>{}),this.globalEventLimitGuard=new tT(this.options.maxEventLimit,this.namespace,this.logger,this.deleteItem)}storeType(){return tc.INDEXEDDB}}class tR{constructor(e,t){if((0,w.A)(this,"insertItemsToMemoryStore",(e,t)=>{switch(t){case tl.ABANDON:return this.handleAbandonIfLimitWillExceedPolicy(e);case tl.EVICT:return Promise.resolve(this.handleEvictOldestIfLimitExceededPolicy(e));case tl.IGNORE:return this.handleAddAsManyAsPossible(e)}}),e>0)this.eventLimit=e;else throw Error("Event Limit has to be set higher than 1");this.memoryItemHandlers=t}async handleAbandonIfLimitWillExceedPolicy(e){if(await this.memoryItemHandlers.getItemCount()+e.length>this.eventLimit)throw new td(tc.MEMORY);return this.memoryItemHandlers.addItems(e),{items:e,numberOfEvictedItems:0}}handleEvictOldestIfLimitExceededPolicy(e){this.memoryItemHandlers.addItems(e);let t=this.memoryItemHandlers.evictEventsIfNeeded(this.eventLimit);return{items:e,numberOfEvictedItems:t}}async handleAddAsManyAsPossible(e){let t=this.eventLimit-await this.memoryItemHandlers.getItemCount(),r=t>e.length?e:e.slice(0,t);return this.memoryItemHandlers.addItems(r),{items:r,numberOfEvictedItems:0}}}let tj=["item"],tN=["items"];function tx(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}class tL{constructor(e,t={}){this.namespace=e,this.memoryStore=[],this.options=tw(t),this.globalEventLimitGuard=new tR(this.options.maxEventLimit,{addItems:this.addItems.bind(this),getItemCount:this.getItemCount.bind(this),evictEventsIfNeeded:this.evictEventsIfNeeded.bind(this)})}async addItem(e,t={},r=tl.ABANDON){if(r===tl.IGNORE)throw new ty(r,"IndexedDbConnector#addItem");let s=tE(e,this.namespace,t),i=await this.globalEventLimitGuard.insertItemsToMemoryStore([s],r);return Promise.resolve({item:i.items[0],numberOfEvictedItems:i.numberOfEvictedItems})}bulkAddItem(e,t=tl.ABANDON){let r=e.map(e=>{let{item:t}=e,r=(0,tb.A)(e,tj);return tE(t,this.namespace,r)});return this.bulkAddItemWrapperType(r,t)}bulkAddItemWrapperType(e,t=tl.ABANDON){return Promise.resolve(this.globalEventLimitGuard.insertItemsToMemoryStore(e,t))}getItems(e=tv){return Promise.resolve(this.synchronousGetItems(e))}synchronousGetItems(e=tv){let t=e>0?e:tv,r=Date.now(),s=[],i=[];for(let e of this.memoryStore)if(e.timeToBeProcessedAfter<=r&&(s.push(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?tx(Object(r),!0).forEach(function(t){(0,w.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tx(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({},e)),e.timeToBeProcessedAfter+=6e4,e.retryAttempts+=1,e.retryAttempts>=this.options.maxAttempts&&i.push(e)),s.length>=t)break;return i.forEach(e=>{let t=this.memoryStore.indexOf(e);this.memoryStore.splice(t,1)}),{items:s,numberOfDeletedItems:i.length}}deleteItems(e){return this.memoryStore=this.memoryStore.filter(t=>!e.includes(t.id)),Promise.resolve(void 0)}getItemCount(){let e=Date.now(),t=this.memoryStore.filter(t=>t.timeToBeProcessedAfter<=e).length;return Promise.resolve(t)}async processItems(e,t){let r=this.synchronousGetItems(t),{items:s}=r,i=(0,tb.A)(r,tN),n=s.map(e=>e.id);try{let t=await e(s,i);return await this.deleteItems(n),t}catch(e){throw new tp(e)}}storeType(){return tc.MEMORY}addItems(e){this.memoryStore.push(...e),this.memoryStore.sort(function(e,t){return e.timeAdded-t.timeAdded})}evictEventsIfNeeded(e){let t=this.memoryStore.length;if(t>e){let r=t-e;return this.memoryStore.splice(0,r),r}return 0}}let tM=class{constructor(e,t={}){if(this.namespace=e,this.options=tw(t),!e||0===e.length||"string"!=typeof e)throw Error("Invalid namespace provided");this.resilience=this.getResilienceMechanism(e,t)}getResilienceMechanism(e,t){if(!t.useMemory)try{return new tD(e,t)}catch(e){if(!(e instanceof tu)){var r;null===(r=t.logger)||void 0===r||r.warn("Attempted to create IndexedDbResilience but failed. Using memory instead.")}}return new tL(this.namespace,t)}addItem(e,t,r=tl.ABANDON){return this.runOrFailOver(()=>this.resilience.addItem(e,t,r))}bulkAddItem(e,t=tl.ABANDON){return this.runOrFailOver(()=>this.resilience.bulkAddItem(e,t))}getItems(e){return this.runOrFailOver(()=>this.resilience.getItems(e))}deleteItems(e){return this.runOrFailOver(()=>this.resilience.deleteItems(e))}getItemCount(){return this.runOrFailOver(()=>this.resilience.getItemCount())}processItems(e,t){return this.runOrFailOver(()=>this.resilience.processItems(e,t))}storeType(){return this.resilience.storeType()}async runOrFailOver(e){try{return await e()}catch(t){if(tg(t))throw t;return this.resilience.storeType()===tc.INDEXEDDB&&await this.failOver(),e()}}async failOver(){let e=this.resilience,t=new tL(this.namespace,this.options);this.resilience=t;try{let{items:r}=await e.getItems(this.options.maxEventLimit);if(r.length>0){let s=(await t.bulkAddItemWrapperType(r,tl.IGNORE)).items.map(e=>e.id);await e.deleteItems(s)}}catch{this.options.logger.warn("Unexpected error from ResilienceDb, switching to MemoryDb")}}},tF=((u={}).INDEXEDDB="indexeddb",u.MEMORY="memory",u),tU=((h={})[h.ONLINE=0]="ONLINE",h[h.OFFLINE=1]="OFFLINE",h);class tB{constructor(){(0,w.A)(this,"itemsDiscardedByRetry",0),(0,w.A)(this,"eventCount",0),(0,w.A)(this,"itemsDiscardedByOverflow",0),(0,w.A)(this,"resilienceMechanism",tF.INDEXEDDB),(0,w.A)(this,"localstorageNumberOfQueuesPurged",0),(0,w.A)(this,"localstorageNumberOfFullReclaims",0),(0,w.A)(this,"localstorageNumberOfPartialReclaims",0),(0,w.A)(this,"localstorageNumberOfFailedReclaims",0)}addToItemsDiscardedByRetryCounter(e=1){this.itemsDiscardedByRetry+=e}addToEventCount(){this.eventCount++}addToItemsDiscardedByOverflowCounter(e=1){this.itemsDiscardedByOverflow+=e}setResilienceMechanism(e){this.resilienceMechanism=e}addToReclaimMetrics(e){this.localstorageNumberOfFullReclaims+=e.fullReclaims,this.localstorageNumberOfPartialReclaims+=e.partialReclaims,this.localstorageNumberOfFailedReclaims+=e.failedReclaims}addToPurgedQueuesMetrics(e){this.localstorageNumberOfQueuesPurged+=e}subtractFromMetrics(e){this.itemsDiscardedByRetry=this.subtractFromCount(this.itemsDiscardedByRetry,e.itemsDiscardedByRetry),this.eventCount=this.subtractFromCount(this.eventCount,e.eventCount),this.itemsDiscardedByOverflow=this.subtractFromCount(this.itemsDiscardedByOverflow,e.itemsDiscardedByOverflow),this.localstorageNumberOfFullReclaims=this.subtractFromCount(this.localstorageNumberOfFullReclaims,e.fullReclaims),this.localstorageNumberOfPartialReclaims=this.subtractFromCount(this.localstorageNumberOfPartialReclaims,e.partialReclaims),this.localstorageNumberOfFailedReclaims=this.subtractFromCount(this.localstorageNumberOfFailedReclaims,e.failedReclaims),this.localstorageNumberOfQueuesPurged=this.subtractFromCount(this.localstorageNumberOfQueuesPurged,e.localstorageQueuesPurged)}subtractFromCount(e,t){return Math.max(e-(t||0),0)}getMetricsPayload(){return{itemsDiscardedByRetry:this.itemsDiscardedByRetry,eventCount:this.eventCount,itemsDiscardedByOverflow:this.itemsDiscardedByOverflow,resilienceMechanism:this.resilienceMechanism,localstorageQueuesPurged:this.localstorageNumberOfQueuesPurged,fullReclaims:this.localstorageNumberOfFullReclaims,partialReclaims:this.localstorageNumberOfPartialReclaims,failedReclaims:this.localstorageNumberOfFailedReclaims}}}let t$=null,tH=()=>(t$||(t$=new tB),t$);class tK{constructor(e){this._networkChangeCallback=e,"u">typeof window&&(window.addEventListener("offline",()=>this._networkChangeCallback(tU.OFFLINE)),window.addEventListener("online",()=>this._networkChangeCallback(tU.ONLINE)))}removeListeners(){"u">typeof window&&(window.addEventListener("offline",()=>this._networkChangeCallback(tU.OFFLINE)),window.addEventListener("online",()=>this._networkChangeCallback(tU.ONLINE)))}getNetworkStatus(){return window.navigator.onLine?tU.ONLINE:tU.OFFLINE}}let tW=((d={}).IDLE="idle",d.RUNNING="running",d.COMPLETED="completed",d.TIMED_OUT="timedOut",d),tG=((f={}).EXECUTE="execute",f.COMPLETE="complete",f.TIMEOUT="timeout",f);class tV{constructor(e){if((0,w.A)(this,"timeoutHandle",void 0),(0,w.A)(this,"callbackStatus",tW.IDLE),e>0){this.timeoutPeriod=e;return}throw Error("CallbackWithTimeout requires timeout period higher than 0")}transitionCallbackStatus(e,t){switch(e){case tW.IDLE:case tW.TIMED_OUT:case tW.COMPLETED:t===tG.EXECUTE&&(this.callbackStatus=tW.RUNNING);break;case tW.RUNNING:switch(t){case tG.COMPLETE:this.callbackStatus=tW.COMPLETED;break;case tG.TIMEOUT:this.callbackStatus=tW.TIMED_OUT}break;default:this.callbackStatus=e}}executeCallbackWithTimeout(e,t,r){typeof window>"u"||(this.transitionCallbackStatus(this.callbackStatus,tG.EXECUTE),this.timeoutHandle=window.setTimeout(()=>{this.transitionCallbackStatus(this.callbackStatus,tG.TIMEOUT),r()},this.timeoutPeriod),e(e=>{this.cancelTimeout(),this.getCallbackStatus()!==tW.TIMED_OUT&&(this.transitionCallbackStatus(this.callbackStatus,tG.COMPLETE),t(e))}))}getCallbackStatus(){return this.callbackStatus}cancelTimeout(){"u">typeof window&&this.timeoutPeriod>0&&this.timeoutHandle&&(window.clearTimeout(this.timeoutHandle),this.timeoutHandle=void 0)}}let tq=((p={})[p.NOOP=0]="NOOP",p[p.SUCCESS=1]="SUCCESS",p[p.ERROR=2]="ERROR",p),tQ={minRetryDelay:1e3,maxRetryDelay:3e4,backoffFactor:2,backoffJitterPercentage:0,waitInterval:500,callbackTimeoutPeriod:5e3},tJ=((m={})[m.NONE=0]="NONE",m[m.IMMEDIATE=1]="IMMEDIATE",m[m.WAIT=2]="WAIT",m);class tY{constructor(e,t){(0,w.A)(this,"schedule",({immediate:e}={})=>{typeof window>"u"||(this.operationInFlight?e?this.queuedSchedule=tJ.IMMEDIATE:this.queuedSchedule!==tJ.IMMEDIATE&&(this.queuedSchedule=tJ.WAIT):(e||this.options.waitInterval<=0)&&0===this.failureCount?(this.clearTimeout(),this.run()):this.failureCount>0&&null===this.scheduledTimeout?this.scheduledTimeout=window.setTimeout(this.run,this.calculateBackoff()):null===this.scheduledTimeout&&(this.scheduledTimeout=window.setTimeout(this.run,this.options.waitInterval)))}),(0,w.A)(this,"stop",()=>{this.clearTimeout(),this.queuedSchedule=tJ.NONE}),(0,w.A)(this,"getFailureCount",()=>this.failureCount),(0,w.A)(this,"getCallbackStatus",()=>this.callbackTimer.getCallbackStatus()),(0,w.A)(this,"clearTimeout",()=>{"u">typeof window&&null!==this.scheduledTimeout&&(window.clearTimeout(this.scheduledTimeout),this.scheduledTimeout=null)}),(0,w.A)(this,"run",()=>{this.operationInFlight=!0,this.clearTimeout();try{this.callbackTimer.executeCallbackWithTimeout(this.callback,this.done,()=>this.done(tq.ERROR))}catch(e){this.done(e)}}),(0,w.A)(this,"done",e=>{this.operationInFlight=!1,e===tq.ERROR||this.callbackTimer.getCallbackStatus()===tW.TIMED_OUT?(this.failureCount++,this.clearTimeout()):e===tq.SUCCESS&&(this.failureCount=0),this.processQueuedSchedule()}),(0,w.A)(this,"processQueuedSchedule",()=>{if(this.queuedSchedule!==tJ.NONE){let e=this.queuedSchedule===tJ.IMMEDIATE;this.queuedSchedule=tJ.NONE,this.schedule({immediate:e})}else this.failureCount>0&&this.schedule()}),(0,w.A)(this,"calculateBackoff",()=>{let{minRetryDelay:e,maxRetryDelay:t,backoffFactor:r,backoffJitterPercentage:s}=this.options,i=e*r**this.failureCount;if(s){let e=Math.random(),t=Math.floor(e*s*i);5>Math.floor(10*e)?i-=t:i+=t}return Number(Math.min(i,t).toPrecision(1))}),this.options={minRetryDelay:e.minRetryDelay||tQ.minRetryDelay,maxRetryDelay:e.maxRetryDelay||tQ.maxRetryDelay,backoffFactor:e.backoffFactor||tQ.backoffFactor,backoffJitterPercentage:e.backoffJitterPercentage||tQ.backoffJitterPercentage,waitInterval:void 0!==e.waitInterval?e.waitInterval:tQ.waitInterval,callbackTimeoutPeriod:e.callbackTimeoutPeriod||tQ.callbackTimeoutPeriod},this.scheduledTimeout=null,this.failureCount=0,this.callback=t,this.operationInFlight=!1,this.queuedSchedule=tJ.NONE,this.callbackTimer=new tV(this.options.callbackTimeoutPeriod)}}function tX(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function tz(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?tX(Object(r),!0).forEach(function(t){(0,w.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tX(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let tZ={backoffFactor:0,backoffJitterPercentage:0,flushWaitMs:6e4,minRetryDelay:6e4,maxRetryDelay:6e4},t0={backoffFactor:2,backoffJitterPercentage:.2,batchFlushSize:7,flushBeforeUnload:!1,flushWaitMs:500,maxAttempts:10,maxItems:1e3,maxRetryDelay:3e4,minRetryDelay:1e3};class t1{constructor(e,t,r,s){this.queuePrefix=e,this.resilience=new tM(t,{logger:s,maxAttempts:r?.maxAttempts,maxEventLimit:r?.maxItems}),this.options=this.buildOptions(r),this.scheduler=new tY(tz(tz({},this.options),{},{waitInterval:null!=r&&r.flushBeforeUnload?0:this.options.flushWaitMs}),this.scheduleCallback.bind(this)),this.longPollingScheduler=new tY(tz(tz({},tZ),{},{waitInterval:tZ.flushWaitMs}),this.scheduleLongCallBack.bind(this)),this.metricsCollector=tH(),this.networkStatus=new tK(e=>{e===tU.OFFLINE?this.scheduler.stop():this.checkEventCountAndReschedule()})}start(e){this.batchFlushCallback=e,this.longPollingScheduler.schedule()}stop(){this.scheduler.stop(),this.longPollingScheduler.stop()}async addItem(e){let t=JSON.parse(JSON.stringify(e)),{numberOfEvictedItems:r}=await this.resilience.addItem(t,{},tl.EVICT);this.scheduler.schedule(),this.metricsCollector.addToEventCount(),r>0&&this.metricsCollector.addToItemsDiscardedByOverflowCounter(r)}getGlobalRetryCount(){return this.scheduler.getFailureCount()}async scheduleCallback(e){if(this.networkStatus.getNetworkStatus()===tU.OFFLINE){e(tq.NOOP);return}try{let t=await this.resilience.processItems(this.flush.bind(this),this.options.batchFlushSize);e(t)}catch(t){if(t.name===tf){e(tq.ERROR);return}}finally{await this.checkEventCountAndReschedule()}}async checkEventCountAndReschedule(){let e=await this.resilience.getItemCount();e>0&&this.scheduler.schedule({immediate:e>=this.options.batchFlushSize})}async scheduleLongCallBack(e){let t=e3(this.queuePrefix);this.metricsCollector.addToPurgedQueuesMetrics(t);let r=await tr(this.queuePrefix,async e=>{let t=e.map(e=>({item:e.item,retryAttempts:e.attemptNumber,id:e.id})),{items:r}=await this.resilience.bulkAddItem(t,tl.IGNORE);return r.length===t.length?{status:"successful"}:{status:"partial",acceptedItemIds:r.map(e=>e.id)}});this.metricsCollector.addToReclaimMetrics(r),await this.checkEventCountAndReschedule(),e(tq.SUCCESS),this.longPollingScheduler.schedule()}flush(e,t){this.metricsCollector.setResilienceMechanism(this.resilience.storeType());let{batchFlushCallback:r}=this;if(!r)throw Error("batchFlushCallback has not been set. Call PullBatchableQueue#start first.");return new Promise((s,i)=>{if(e.length<=0){s(tq.NOOP);return}let n=e.map(e=>{let t=e.item;return e.retryAttempts>0&&t.msg&&(t.msg._metadata||(t.msg._metadata={}),t.msg._metadata.failedAttempts=e.retryAttempts),t});r(n,e=>{e?(t.numberOfDeletedItems>0&&this.metricsCollector.addToItemsDiscardedByRetryCounter(t.numberOfDeletedItems),i(e)):s(tq.SUCCESS)})})}buildOptions(e){return{backoffFactor:e?.backoffFactor||t0.backoffFactor,backoffJitterPercentage:e?.backoffJitterPercentage!==void 0?e.backoffJitterPercentage:t0.backoffJitterPercentage,batchFlushSize:e?.batchFlushSize||t0.batchFlushSize,flushBeforeUnload:e?.flushBeforeUnload||t0.flushBeforeUnload,flushWaitMs:e?.flushWaitMs||t0.flushWaitMs,maxItems:e?.maxItems||t0.maxItems,maxAttempts:e?.maxAttempts||t0.maxAttempts,maxRetryDelay:e?.maxRetryDelay||t0.maxRetryDelay,minRetryDelay:e?.minRetryDelay||t0.minRetryDelay}}}let t4=(e,t,r,s)=>new t1(e,t,r||{},s);class t2{constructor(e,t){this.reason=e,this.message=t instanceof Error?t.message:null,this.statusCode=t instanceof t6?t.statusCode:null}}let t3=((y={}).IDENTIFY="identify",y.PAGE="page",y.TRACK="track",y);(g={}).XC="xc",g.UID="uid",(b={}).NEW="NEW",b.CHANGED="CHANGED",b.EXISTING="EXISTING",b.TIMEOUT="TIMEOUT",b.ERROR="ERROR",b.UNAVAILABLE="UNAVAILABLE",b.MALFORMED="MALFORMED",b.UNKNOWN="UNKNOWN";class t5{constructor(e,t){this.props=e,this.url=t}static fromJson(e){var t;let r="string"==typeof(t=e?.url)||t instanceof String?e.url.trim():"";return new t5(e?.props||null,r.startsWith("http")?r:null)}}class t6 extends Error{constructor(e,t,r){super(e),this.statusCode=t,this.statusText=r}}let t7=["FetchError","AbortError","TypeError"];function t8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function t9(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?t8(Object(r),!0).forEach(function(t){(0,w.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):t8(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}async function re(e,t){try{let r=await t;return e.map(e=>(function(e,t){if(!(t&&t instanceof Function))return e;if(e.msg.type===t3.PAGE||e.msg.type===t3.TRACK){let r=t();r&&Array.isArray(r)&&(e.msg.properties=t9(t9({},e.msg.properties),{},{xid:r}))}else if(e.msg.traits&&e.msg.type===t3.IDENTIFY){let r=t();r&&Array.isArray(r)&&(e.msg.traits=t9(t9({},e.msg.traits),{},{xid:r}))}return e})(e,r))}catch{return e}}let rt=new Map([[200,"OK"],[400,"Bad Request"],[401,"Unauthorized"],[402,"Payment Required"],[403,"Forbidden"],[404,"Not Found"],[405,"Method Not Allowed"],[406,"Not Acceptable"],[407,"Proxy Authentication Required"],[408,"Request Timeout"],[409,"Conflict"],[410,"Gone"],[411,"Length Required"],[412,"Precondition Failed"],[413,"Payload Too Large"],[414,"URI Too Long"],[415,"Unsupported Media Type"],[416,"Requested range not satisfiable"],[417,"Expectation Failed"],[418,"I'm a teapot"],[422,"Unprocessable Entity"],[423,"Locked"],[424,"Failed Dependency"],[425,"Too Early"],[426,"Upgrade Required"],[428,"Precondition Required"],[429,"Too Many Requests"],[431,"Request Header Fields Too Large"],[451,"Unavailable For Legal Reasons"],[500,"Internal Server Error"],[501,"Not Implemented"],[502,"Bad Gateway"],[503,"Service Unavailable"],[504,"Gateway Timeout"],[505,"HTTP Version not supported"],[506,"Variant Also Negotiates"],[507,"Insufficient Storage"],[508,"Loop Detected"],[509,"Bandwidth Limit Exceeded"],[510,"Not Extended"],[511,"Network Authentication Required"],[-1,"Unknown Status"]]);var rr=r(11771);function rs(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}let ri=async e=>{var t;let r=null===(t=rn(e))||void 0===t?void 0:t.signal,s=ro(e.url),i=await fetch(e.url,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?rs(Object(r),!0).forEach(function(t){(0,w.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rs(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({method:"POST",headers:{"Content-Type":"text/plain"},body:JSON.stringify(e.batch),signal:r},s));if(429===i.status||i.status>=500&&i.status<600)throw new t6(`HTTP Error ${i.status} (${i.statusText})`,i.status,i.statusText);return i},rn=e=>{if(e.abortController)return e.abortController;if(e.timeout){let t=new AbortController;return setTimeout(()=>{t.abort()},e.timeout),t}},ro=(0,rr.A)(e=>new URL(e).origin===location.origin?{}:{mode:"cors",credentials:"include"});var ra=r(67793),rc=r(43363),rl=r.n(rc);let ru=((v={}).AWC_TLD_TEST="AWC_TLD_TEST",v.AWC_ANALYTICS_DEBUG="AWC_ANALYTICS_DEBUG",v.AJS_ANONYMOUS_ID="AJS_ANONYMOUS_ID",v);class rh{constructor(e,t){this.key=e,this.options=t}getAttributes(){return this.options}getKey(){return this.key}}let rd=()=>{try{return window&&window.location&&"https:"===window.location.protocol}catch{return!1}},rf={[ru.AWC_TLD_TEST]:new rh("__awc_tld_test__",{expires:365,secure:rd(),path:"/"}),[ru.AWC_ANALYTICS_DEBUG]:new rh("atlassian_analytics_debug",{expires:365,secure:rd(),path:"/"}),[ru.AJS_ANONYMOUS_ID]:new rh("ajs_anonymous_id",{expires:365,secure:rd(),path:"/"})},rp=new class{constructor(){(0,w.A)(this,"_data",{}),(0,w.A)(this,"length",0),(0,w.A)(this,"setItem",(e,t)=>(this._data[e]=t,this.length=Object.keys(this._data).length,t)),(0,w.A)(this,"getItem",e=>e in this._data?this._data[e]:null),(0,w.A)(this,"removeItem",e=>(e in this._data&&delete this._data[e],this.length=Object.keys(this._data).length,null)),(0,w.A)(this,"clear",()=>{this._data={},this.length=0}),(0,w.A)(this,"key",e=>Object.keys(this._data)[e])}},rm="awcInMemoryStorageFallback";function ry(e){let t="test_value";if(!e)return!1;try{let r="awc.storage.support";e.setItem(r,t);let s=e.getItem(r);return e.removeItem(r),s===t}catch{return!1}}class rg{constructor(e,t={}){(0,w.A)(this,"getStore",()=>this._store),(0,w.A)(this,"getItem",e=>this._store.getItem(this.createKey(e))),(0,w.A)(this,"removeItem",e=>this._store.removeItem(this.createKey(e))),(0,w.A)(this,"setItem",(e,t)=>{try{this._store.setItem(this.createKey(e),t)}catch(r){(function(e){let t=!1;if(e.code)switch(e.code){case 22:t=!0;break;case 1014:"NS_ERROR_DOM_QUOTA_REACHED"===e.name&&(t=!0)}else -2147024882===e.number&&(t=!0);return t})(r)&&(this.swapToInMemory(),this._store.setItem(this.createKey(e),t))}}),(0,w.A)(this,"swapToInMemory",()=>{let e;if(this._store===rp||typeof window>"u")return;let t=Object.keys(this._store||{});ry(window[rm])?e=window[rm]:(e=rp,window[rm]||(window[rm]=rp)),t.forEach(t=>{if(0===t.indexOf(this.getPrefix())){let r=this._store.getItem(t);r&&e.setItem(t,r)}}),this._store=e}),(0,w.A)(this,"clear",()=>this._store.clear()),(0,w.A)(this,"key",e=>this._store.key(e)),(0,w.A)(this,"getPrefix",()=>this._prefix),(0,w.A)(this,"createKey",e=>this._prefix?`${this.getPrefix()}.${e}`:e),this.options=t;let r=[];(void 0===t.useStoragePrefix||t.useStoragePrefix)&&r.push("awc"),t.envPrefix&&t.envPrefix!==_.sR.PROD&&r.push(t.envPrefix),this._prefix=r.join("-"),ry(e)?this._store=e:this.swapToInMemory()}}let rb=class extends rg{constructor(e){let t;try{t=window.localStorage||rp}catch{t=rp}super(t,e)}};class rv{constructor(){this.safeStorage=new rb({useStoragePrefix:!1})}set(e,t){return this.safeStorage.setItem(e,t),t}get(e){return this.safeStorage.getItem(e)||void 0}remove(e){this.safeStorage.removeItem(e)}}let rI=(e=!1)=>!e&&!("file:"===location.protocol||"chrome-extension:"===location.protocol),rE=rf.AWC_TLD_TEST.getKey(),rw="tld_test",r_=(0,rr.A)(()=>{if(typeof location>"u")return"";let{hostname:e}=location,t=e.split(".");for(let e=1;e<=t.length;e++){let r=`.${t.slice(-1*e).join(".")}`;if(rl().set(rE,rw,{domain:r}),rl().get(rE)===rw)return rl().remove(rE,{domain:r}),r}return e});var rA=r(68731);function rO(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function rS(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?rO(Object(r),!0).forEach(function(t){(0,w.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rO(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}class rT{constructor(e){this.cookieLike=rI(e)?rl():new rv}set(e,t,r){if(!rf[e]){rA.warn(`Unknown cookie key ${e} provided, not set.`);return}return this.cookieLike.set(rf[e].getKey(),t,rS(rS({},rf[e].getAttributes()),{},{domain:r_()},r))}get(e){if(!rf[e]){rA.warn(`Unknown cookie key ${e} provided, not fetched.`);return}return this.cookieLike.get(rf[e].getKey())}remove(e,t){if(!rf[e]){rA.warn(`Unknown cookie key ${e} provided, not removed.`);return}this.cookieLike.remove(rf[e].getKey(),rS({},t))}}let rP="SAFE",rC="UNSAFE",rk="LOCAL_STORAGE";class rD{constructor(e){this.store=new rb({useStoragePrefix:!1}),this.cookie=new rT(e)}getUserId(){return this.userId||null}setUserId(e){this.userId=e}getAnonymousId(e){return this.getAnonymousIdFromLocalStorageAndUpdateCookieIfStale()||this.getAnonymousIdFromCookieAndUpdateLocalStorage()||this.generateNewAnonymousId(e)}setAnonymousId(e){let t=JSON.stringify(e);return this.cookie.set(ru.AJS_ANONYMOUS_ID,t),this.lastAnonymousIdCookieUpdate=Date.now(),this.store.setItem(rf.AJS_ANONYMOUS_ID.getKey(),t)}getAnonymousIdFromStorage(e){let t=e===rk?this.store.getItem(rf.AJS_ANONYMOUS_ID.getKey()):this.cookie.get(ru.AJS_ANONYMOUS_ID);if(t){let e={type:rC,anonymousId:t};try{let r=JSON.parse(t);return r&&"string"==typeof r?{type:rP,anonymousId:r}:e}catch{return e}}return{type:"NOT_FOUND"}}getAnonymousIdFromLocalStorageAndUpdateCookieIfStale(){let e=this.getAnonymousIdFromStorage(rk),t=!1;switch((!this.lastAnonymousIdCookieUpdate||(0,ra.A)(new Date,new Date(this.lastAnonymousIdCookieUpdate))>=7)&&(t=!0),e.type){case rP:return t&&this.setAnonymousId(e.anonymousId),e.anonymousId;case rC:return e.anonymousId;default:return null}}getAnonymousIdFromCookieAndUpdateLocalStorage(){let e=this.getAnonymousIdFromStorage("COOKIE");switch(e.type){case rP:case rC:return this.store.setItem(rf.AJS_ANONYMOUS_ID.getKey(),JSON.stringify(e.anonymousId)),e.anonymousId;default:return null}}generateNewAnonymousId(e){let t=("function"==typeof e?e:()=>crypto.randomUUID())();return this.setAnonymousId(t),t}}var rR=r(85651),rj=r.n(rR);function rN(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function rx(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?rN(Object(r),!0).forEach(function(t){(0,w.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rN(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let rL=e=>rx(rx({},e.context),{},{userAgent:navigator.userAgent}),rM=e=>{let t=rF(e,"$.properties");return rj()(t)},rF=(e,t)=>{let r=(e,t,s,i)=>{if(null===e||"object"!=typeof e)return e;if(i>512)return{_depthLimitExceeded:!0,message:`Object nesting depth limit exceeded at path '${s}' with depth '${i}'`};if(t.has(e)){let r=t.get(e);return{_circularReference:!0,message:`Circular reference to object at original path '${r}' detected at path '${s}'`,originalPath:r}}t.set(e,s);let n={};return Object.keys(e).forEach(o=>{let a=e[o];if(void 0!==a){if(Array.isArray(a)){let e=[];a.forEach((n,a)=>{let c=r(n,t,`${s}.${o}[${a}]`,i+1);void 0!==c&&e.push(c)}),n[o]=e}else{let e=r(a,t,`${s}.${o}`,i+1);void 0!==e&&(n[o]=e)}}}),t.delete(e),n};return r(e,new Map,t,0)};var rU=r(68731);function rB(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function r$(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?rB(Object(r),!0).forEach(function(t){(0,w.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rB(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}class rH{constructor(e,t,r,s,i){this.success=e,this.validationErrors=t,this.message=r,this.code=s,this.validationReports=i}isSuccess(){return this.success}getValidationErrors(){return this.validationErrors}getMessage(){return this.message}getCode(){return this.code}getValidationReports(){return void 0===this.validationReports?null:this.validationReports}}class rK{constructor(e){this.error=e}}class rW{constructor(e,t,r,s){this.success=e,this.statusCode=t,this.message=r,this.eventResponseList=s}isSuccess(){return this.success}getStatusCode(){return this.statusCode}getMessage(){return this.message}getEventResponseList(){return this.eventResponseList}}class rG{constructor(e,t,r){this.messageId=e,this.results=t,this.segmentEvent=r}getMessageId(){return this.messageId}getResults(){return this.results}getSegmentEvent(){return this.segmentEvent}}class rV{constructor(e){var t;(0,w.A)(this,"sendEvents",async(e,t)=>{var r,s;if(!1===this.options.enableEventCalls)return;let i=this.resilienceQueue.getGlobalRetryCount(),n=this.metrics.getMetricsPayload(),o=await this.attachXIDs(e),a=new Date().toISOString(),c=await this.metadataClient.getMetadataAsync(),[l,u]=this.getEventUrl(c),h=r$(r$({},n),{},{httpRetryCount:i,lastSendEventsErrorReason:(null===(r=this.lastSendEventsError)||void 0===r?void 0:r.message)||null,lastSendEventsError:this.lastSendEventsError,lastUrlFallbackError:this.lastUrlFallbackError,isUsingFallbackUrl:u,props:c?.props||null,metadataClientMetrics:(null===(s=this.metadataClient)||void 0===s?void 0:s.metrics)||null});this.cleanLibraryMetadata(h);let d={batch:o.map(e=>(e.msg.sentAt=a,e.msg)),sentAt:a,metadata:h};try{let r=await ri({url:l,batch:d,timeout:this.options.requestTimeout});this.lastSendEventsError=null,this.lastUrlFallbackError=null,this.metrics.subtractFromMetrics(n),t(null,r),await this.invokeLocalResponseCallbackAsync(e,r,null)}catch(r){if(r instanceof t6&&[429,503].includes(r.statusCode))this.lastSendEventsError=new t2("ServerBusyError",r);else{let e=r instanceof Error&&t7.includes(r.name)?r.name:"Unknown";this.lastSendEventsError=new t2(e,r),this.useUrlFromMetadata=!1;let[t,s]=this.getEventUrl(c);s&&s!==u&&(this.lastUrlFallbackError=this.lastSendEventsError)}t(r,null),await this.invokeLocalResponseCallbackAsync(e,null,r)}}),this.options=r$(r$({},e),{},{requestTimeout:e.requestTimeout||1e4,retryQueueOptions:e.retryQueueOptions||{},logger:e.logger||rU,disableCookiePersistence:e.disableCookiePersistence||!1,env:e.env,perimeter:e.perimeter||"",enableMetadataCalls:"boolean"!=typeof e.enableMetadataCalls||e.enableMetadataCalls,enableEventCalls:"boolean"!=typeof e.enableEventCalls||e.enableEventCalls}),this.user=new rD(null===(t=this.options)||void 0===t?void 0:t.disableCookiePersistence),this.xidPromiseCallback=e.xidPromiseGetter(),this.gasv3BatchUrl=`${e.apiHostProtocol}://${e.apiHost}/batch`,this.metrics=tH(),this.responseCallback=e.responseCallback,this.resilienceQueue=t4(e.retryQueuePrefix,e.product,this.options.retryQueueOptions,this.options.logger),this.metadataClient=e.metadataClient,this.useUrlFromMetadata=!0,this.lastSendEventsError=null,this.lastUrlFallbackError=null,setInterval(()=>{this.useUrlFromMetadata=!0},6e5),this.resilienceQueue.start(this.sendEvents)}getUser(){return this.user}async track(e,t,r,s){let i=this.buildBaseEvent(r,t3.TRACK,t),n=r$(r$({},i),{},{type:t3.TRACK,properties:rM(t),event:e}),o=r$(r$({},n),{},{messageId:this.createMessageId()}),a=this.packageEvent(o);await this.enqueueEvent(a),s&&s()}async page(e,t,r,s){let i=this.buildBaseEvent(r,t3.PAGE,t),n=r$(r$({},i),{},{type:t3.PAGE,properties:rM(t),name:e}),o=r$(r$({},n),{},{messageId:this.createMessageId()}),a=this.packageEvent(o);await this.enqueueEvent(a),s&&s()}async identify(e,t,r,s){let i=this.buildBaseEvent(r,t3.IDENTIFY,t),n=r$(r$({},i),{},{type:t3.IDENTIFY,traits:rM(t)}),o=r$(r$({},n),{},{messageId:this.createMessageId()}),a=this.packageEvent(o);await this.enqueueEvent(a),s&&s()}async enqueueEvent(e){this.options.enableMetadataCalls&&this.metadataClient.start(!1),await this.resilienceQueue.addItem(e)}buildBaseEvent(e,t,r){let s=rM(e);return{context:rL(s),timestamp:new Date().toISOString(),type:t,userId:this.user.getUserId(),anonymousId:r.anonymousId||this.user.getAnonymousId()}}createMessageId(){return`ajs-${crypto.randomUUID()}`}packageEvent(e){let{apiHost:t,apiHostProtocol:r}=this.options;return{headers:{"Content-Type":"text/plain"},msg:e,url:`${r}://${t}/${e.type.charAt(0)}`}}getEventUrl(e){let t=null!=e&&e.url?e.url:this.gasv3BatchUrl,r=this.useUrlFromMetadata?t:this.gasv3BatchUrl,s=t===this.gasv3BatchUrl?null:r!==t;return[r,s]}cleanLibraryMetadata(e){if(!(null===e||"object"!=typeof e))for(let t in e){if("props"===t)continue;let r=e[t];null==r||"number"==typeof r&&0===r?delete e[t]:Array.isArray(r)?0===r.length?delete e[t]:r.forEach(e=>{this.cleanLibraryMetadata(e)}):"object"==typeof r&&this.cleanLibraryMetadata(e[t])}}async invokeLocalResponseCallbackAsync(e,t,r){let s=this.responseCallback;if(s){let n=null;if(t){var i;let e;try{e=await t.clone().json()}catch{}(e=e||{}).code=Number.parseInt(e.code)>0?Number.parseInt(e.code):t.status,e.success=e.success||e.code>=200&&e.code<=299,n=new rH(e.success,e.validationErrors||new Map,new rK((null===(i=e.message)||void 0===i?void 0:i.error)||""),e.code,e.validationReports||null)}!r||r instanceof Error||(r=Error(String(r)));let o=rq.toAnalyticsResponse(e||[],r||null,n);s(o)}}async attachXIDs(e){return this.xidPromiseCallback?re(e,this.xidPromiseCallback):Promise.resolve(e)}setResponseCallback(e){this.responseCallback=e}refreshMetadata(e,t){this.metadataClient.userInfo=e,this.metadataClient.tenantInfo=t}}class rq{static toAnalyticsResponse(e,t,r){let s=[];if(null!==r){var i,n;let[t,o]=[r.code,r.success];if(t>=200&&t<=299)return null===(i=r.validationReports)||void 0===i||i.forEach(t=>{let r=e.find(e=>e.msg.messageId===t.messageId);r&&s.push(new rG(r.msg.messageId,t.results,r.msg))}),new rW(o,t,rt.get(t),s);if(t>=400&&t<=499){let i=(null===(n=r.message)||void 0===n?void 0:n.error)!==null?r.message.error:rt.has(t)?rt.get(t):rt.get(-1);return e.forEach(e=>{s.push(new rG(e.msg.messageId,[],e.msg))}),new rW(o,t,i,s)}}else if(null!=t&&t.message){let r=t.message.match(rq.http_error_regex);if(r)return e.forEach(e=>{s.push(new rG(e.msg.messageId,[],e.msg))}),new rW(!1,Number(r[1]),r[2],s)}return e.forEach(e=>{s.push(new rG(e.msg.messageId,[],e.msg))}),new rW(!1,-1,rt.get(-1),s)}}(0,w.A)(rq,"http_error_regex",/HTTP Error\s([0-9]{3})\s\((.+)\)/);let rQ="/gateway/api/gasv3/api/v1",rJ=({useStargate:e,env:t,useLegacyUrl:r,envOverride:s})=>{if(t===_.sR.LOCAL||t===_.sR.DEV)throw Error("No LOCAL or DEV environments for FedRAMP.");if(t===_.sR.PROD&&s)throw Error("Cannot override to FedRAMP Sandbox for Prod.");return e?r?t===_.sR.PROD?"api.atlassian-us-gov-mod.com/gasv3/api/v1":"api.stg.atlassian-us-gov-mod.com/gasv3/api/v1":window.location.host+rQ:t===_.sR.PROD?"as.atlassian-us-gov-mod.com/api/v1":"as.staging.atl-paas-us-gov-mod.net/api/v1"},rY=({useStargate:e,env:t,useLegacyUrl:r})=>e?r?t===_.sR.PROD?"api-private.atlassian.com/gasv3/api/v1":"api-private.stg.atlassian.com/gasv3/api/v1":window.location.host+rQ:t===_.sR.PROD?"as.atlassian.com/api/v1":"as.staging.atl-paas.net/api/v1";class rX{static isGeminiVREnvironment(){try{for(let e in r.g)if(e.startsWith("__gemini_")&&e.endsWith("__"))return!0}catch{}return!1}static areMetadataCallsDisabled(){return this.areFetchCallsDisabled()||this.getGlobalBooleanProperty(rX.DISABLE_METADATA_CALLS_PROPERTY)}static areEventCallsDisabled(){return this.areFetchCallsDisabled()||this.getGlobalBooleanProperty(rX.DISABLE_EVENT_CALLS_PROPERTY)}static areFetchCallsDisabled(){return this.getGlobalBooleanProperty(rX.DISABLE_FETCH_CALLS_PROPERTY)}static getSyntheticFlagOverride(){return this.getGlobalTriStateProperty(rX.SYNTHETIC_FLAG_OVERRIDE_PROPERTY)}static getGlobalBooleanProperty(e){return!!(r.g&&r.g.hasOwnProperty(e))&&!0===r.g[e]}static getGlobalTriStateProperty(e){if(r.g&&r.g.hasOwnProperty(e)){let t=r.g[e];if("boolean"==typeof t)return t}}}function rz(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}(0,w.A)(rX,"DISABLE_METADATA_CALLS_PROPERTY","__awc_disable_metadata_calls__"),(0,w.A)(rX,"DISABLE_EVENT_CALLS_PROPERTY","__awc_disable_event_calls__"),(0,w.A)(rX,"DISABLE_FETCH_CALLS_PROPERTY","__awc_disable_fetch_calls__"),(0,w.A)(rX,"SYNTHETIC_FLAG_OVERRIDE_PROPERTY","__awc_synthetic_flag_override__");let rZ=async(e,t,r,s)=>{var i,n,o,a;let c=r0(r,s),l=r1(e),u=e+"?"+new URLSearchParams({product:`${t.product}`,userId:`${(null===(i=t.userInfo)||void 0===i?void 0:i.userId)||""}`,userIdType:`${(null===(n=t.userInfo)||void 0===n?void 0:n.userIdType)||""}`,tenantId:`${(null===(o=t.tenantInfo)||void 0===o?void 0:o.tenantId)||""}`,tenantIdType:`${(null===(a=t.tenantInfo)||void 0===a?void 0:a.tenantIdType)||""}`}).toString(),h=await fetch(u,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?rz(Object(r),!0).forEach(function(t){(0,w.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rz(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({method:"GET",signal:c.signal},l));if(200!==h.status)throw new t6(`Metadata: HTTP Error ${h.status} (${h.statusText})`,h.status,h.statusText);return h},r0=(e,t)=>{let r=new AbortController;return setTimeout(()=>{r.abort()},e||3e4),t?.addEventListener("abort",()=>{r.abort()}),r},r1=(0,rr.A)(e=>new URL(e).origin===location.origin?{}:{mode:"cors",credentials:"include"});function r4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function r2(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?r4(Object(r),!0).forEach(function(t){(0,w.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):r4(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}class r3{constructor(e,t,r){this._userInfo={anonymousId:""},this._tenantInfo={},this._url=`${e}://${t}/metadata`,this._product=r,this._metadataInfo=null,this._requestStatus="PENDING",this._lastFetchRequestCount=0,this._lastErrorReason=null,this._fetchAbortController=null,this._hasBeenStopped=!1,this._isEnabled=!1,this._propertyChangeRefreshTimeout=null;let s=function({apiHost:e}){return e===window.location.host+rQ}({apiHost:t});this._metadataHost=s?"PRODUCT_HOST":t,this._options=this.buildOptions({backoffFactor:2,backoffJitterPercentage:.2,batchFlushSize:7,flushBeforeUnload:!1,flushWaitMs:500,maxAttempts:10,maxItems:1e3,maxRetryDelay:3e4,minRetryDelay:1e3}),this._scheduler=new tY(r2(r2({},this._options),{},{waitInterval:6e5}),this.scheduleCallback.bind(this)),this._networkStatus=null}start(e){this._isEnabled||this._hasBeenStopped&&!e||(this._isEnabled=!0,this.startNetworkStatusMonitor(),setTimeout(()=>{this._scheduler.schedule({immediate:!0})},r3.INITIAL_REFRESH_DELAY))}stop(){var e;this._isEnabled&&(this._hasBeenStopped=!0,this._isEnabled=!1,this.stopNetworkStatusMonitor(),this._scheduler.stop(),null===(e=this._fetchAbortController)||void 0===e||e.abort(),this.resetPropertyChangeRefresh())}startNetworkStatusMonitor(){this._networkStatus||(this._networkStatus=new tK(e=>{e===tU.OFFLINE?this._scheduler.stop():this._isEnabled&&this._scheduler.schedule({immediate:null===this._metadataInfo})}))}stopNetworkStatusMonitor(){this._networkStatus&&(this._networkStatus.removeListeners(),this._networkStatus=null)}async refreshMetadataAsync(){var e;if(rX.areFetchCallsDisabled()||!this._isEnabled)return Promise.resolve();null===(e=this._fetchAbortController)||void 0===e||e.abort(),this._fetchAbortController=new AbortController;let t=this._fetchAbortController.signal;this._lastFetchRequestCount=this._scheduler.getFailureCount(),await rZ(this._url,{product:this._product,userInfo:this._userInfo,tenantInfo:this._tenantInfo},6e4,t).then(async e=>{let t=await e.json();this._metadataInfo=t5.fromJson(t),this._lastFetchRequestCount++,this._requestStatus="FETCHED",this._lastErrorReason=null}).catch(e=>{if(!t.aborted)throw this._requestStatus="FAILED",e instanceof t6&&[429,503].includes(e.statusCode)?this._lastErrorReason="ServerBusyError":this._lastErrorReason=e instanceof Error&&t7.includes(e.name)?e.name:"Unknown",e})}getMetadataAsync(){return Promise.resolve(this._metadataInfo)}get status(){return this._requestStatus}get lastErrorReason(){return this._lastErrorReason}get lastFetchRequestCount(){return this._lastFetchRequestCount}get userInfo(){return this._userInfo}set userInfo(e){var t,r;(null===(t=this._userInfo)||void 0===t?void 0:t.userId)===e?.userId&&(null===(r=this._userInfo)||void 0===r?void 0:r.userIdType)===e?.userIdType||(this._userInfo=e,this.schedulePropertyChangeRefresh())}get tenantInfo(){return this._tenantInfo}set tenantInfo(e){var t,r;(null===(t=this._tenantInfo)||void 0===t?void 0:t.tenantId)===e?.tenantId&&(null===(r=this._tenantInfo)||void 0===r?void 0:r.tenantIdType)===e?.tenantIdType||(this._tenantInfo=e,this.schedulePropertyChangeRefresh())}get metrics(){return{host:this._metadataHost,status:this.status,lastErrorReason:this.lastErrorReason,lastRefreshRequestCount:this.lastFetchRequestCount}}async scheduleCallback(e){var t;if((null===(t=this._networkStatus)||void 0===t?void 0:t.getNetworkStatus())===tU.OFFLINE){e(tq.NOOP);return}try{await this.refreshMetadataAsync(),e(tq.SUCCESS),this._scheduler.schedule()}catch{e(tq.ERROR)}}schedulePropertyChangeRefresh(){this._isEnabled&&(this.resetPropertyChangeRefresh(),this._propertyChangeRefreshTimeout=setTimeout(()=>{this.resetPropertyChangeRefresh(),this._scheduler.schedule({immediate:!0})},10))}resetPropertyChangeRefresh(){this._propertyChangeRefreshTimeout&&(clearTimeout(this._propertyChangeRefreshTimeout),this._propertyChangeRefreshTimeout=null)}buildOptions(e){return{backoffFactor:e?.backoffFactor||t0.backoffFactor,backoffJitterPercentage:e?.backoffJitterPercentage!==void 0?e.backoffJitterPercentage:t0.backoffJitterPercentage,batchFlushSize:e?.batchFlushSize||t0.batchFlushSize,flushBeforeUnload:e?.flushBeforeUnload||t0.flushBeforeUnload,flushWaitMs:e?.flushWaitMs||t0.flushWaitMs,maxItems:e?.maxItems||t0.maxItems,maxAttempts:e?.maxAttempts||t0.maxAttempts,maxRetryDelay:e?.maxRetryDelay||t0.maxRetryDelay,minRetryDelay:e?.minRetryDelay||t0.minRetryDelay}}}(0,w.A)(r3,"INITIAL_REFRESH_DELAY",1),(0,w.A)(r3,"Factory",(e,t,r)=>new r3(e,t,r));class r5{constructor(){(0,w.A)(this,"handleOriginParameters",(e,t)=>{let r=Object.keys(e);if(!(r.length>0))throw Error("Empty parameter mapping provided");let s=r.filter(e=>0>Object.values(_.D0).indexOf(e));if(s.length>0)throw Error(`Invalid Origin Tracing Parameter(s) supplied: ${s.join()}!`);let i=em((e,t)=>r.indexOf(t)>=0,t);return Object.keys(i).map(t=>{let r=e[t](i[t]);return{[t]:r}}).reduce((e,t)=>Object.assign(e,t),{})}),this._originStore={}}}let r6="session.id",r7="session.expiry",r8=/^\d+$/,r9=()=>{};class se{constructor(e={}){(0,w.A)(this,"_generateNewSessionId",()=>{let e=Date.now().toString();return this._safeLocalStorage.setItem(r6,e),this._onNewSessionStarted&&this._onNewSessionStarted(),e}),(0,w.A)(this,"_updateSessionExpiry",()=>{let e=Date.now()+this._sessionExpiryTime;return this._safeLocalStorage.setItem(r7,e.toString()),e}),(0,w.A)(this,"_debouncedUpdateSessionExpiry",e=>{let{_updateSessionExpiry:t}=this;e<Date.now()+this._sessionExpiryDebounceThresholdPercentage*this._sessionExpiryTime?t():(this._sessionExpiryDebounceTimer&&clearTimeout(this._sessionExpiryDebounceTimer),this._sessionExpiryDebounceTimer=setTimeout(()=>{t()},this._sessionExpiryDebounce))}),this._sessionExpiryTime=e.sessionExpiryTime||18e5,this._sessionExpiryDebounce=e.sessionExpiryDebounce||5e3,this._sessionExpiryDebounceThresholdPercentage=e.sessionExpiryDebounceThresholdPercentage||.9,this._onNewSessionStarted=e.onNewSessionStarted?e.onNewSessionStarted:r9,this._safeLocalStorage=new rb}getCurrentSessionId(){let e=this._safeLocalStorage.getItem(r6),t=parseInt(this._safeLocalStorage.getItem(r7)||"0",10)||0;return this._debouncedUpdateSessionExpiry(t),!e||t<=Date.now()||Number.isNaN(t)?this._generateNewSessionId():r8.test(e)?e:this._generateNewSessionId()}}let st=class extends rg{constructor(e){let t;try{t=window.sessionStorage||rp}catch{t=rp}super(t,e)}},sr="tab.id";class ss{constructor(){(0,w.A)(this,"_generateNewTabId",()=>{let e=crypto.randomUUID();return this._safeSessionStorage.setItem(sr,e),e}),this._safeSessionStorage=new st}getCurrentTabId(){let e=this._safeSessionStorage.getItem(sr);return e||(e=this._generateNewTabId()),e}}function si(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function sn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?si(Object(r),!0).forEach(function(t){(0,w.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):si(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let so="taskSessions",sa="taskSessionsInit",sc="awc.";class sl{constructor(){(0,w.A)(this,"_taskSessionsNotRecentlyInitialised",e=>null===this._safeSessionStorage.getItem(so)||null===this._safeSessionStorage.getItem(sa)||parseInt(this._safeSessionStorage.getItem(sa)||"0",10)<e-3e3),(0,w.A)(this,"_removeTaskSessionPrefix",(e,t)=>t.split(sc)[1]),(0,w.A)(this,"_isTaskSessionQueryParam",(e,t)=>t.startsWith(sc)),(0,w.A)(this,"getAllTaskSessions",()=>{try{return JSON.parse(this._safeSessionStorage.getItem(so)||"")}catch{return{}}}),(0,w.A)(this,"_writeToSessionStorage",e=>{try{this._safeSessionStorage.setItem(so,JSON.stringify(e))}catch{}}),(0,w.A)(this,"_appendTaskSessions",e=>{let t=this.getAllTaskSessions(),r=null===t?e:Object.assign(t,e);this._writeToSessionStorage(r)}),(0,w.A)(this,"_safelyRemoveKey",(e,t)=>null===e?{}:(delete e[t],e)),(0,w.A)(this,"createTaskSession",e=>{let t=crypto.randomUUID(),r={};return r[e]=t,this._appendTaskSessions(r),t}),(0,w.A)(this,"createTaskSessionWithProvidedId",(e,t)=>{if("string"!=typeof t)throw TypeError("invalid taskSessionId, must be string");let r={};r[e]=t,this._appendTaskSessions(r)}),(0,w.A)(this,"completeTaskSession",e=>{let t=this.getAllTaskSessions(),r=this._safelyRemoveKey(t,e);this._writeToSessionStorage(r)}),(0,w.A)(this,"formatTaskSessionQueryString",({uri:e,includedTaskSessions:t})=>{let{url:r,query:s}=(0,eo.parseUrl)(e),i=this.getAllTaskSessions(),n=t?ec(i,t):eh(i,Object.values(_.D0));if(0===Object.keys(n).length)return e;let o=sn(sn({},ea(n,(e,t)=>sc+t)),s);return`${r}?${(0,eo.stringify)(o)}`}),(0,w.A)(this,"stripQueryParameters",()=>{let e=ea(em(this._isTaskSessionQueryParam),this._removeTaskSessionPrefix);this._appendTaskSessions(e)});let e=Date.now();this._safeSessionStorage=new st;try{this._taskSessionsNotRecentlyInitialised(e)&&(this._writeToSessionStorage({}),this._safeSessionStorage.setItem(sa,e.toString()))}catch{}}}let su=rf.AWC_ANALYTICS_DEBUG.getKey(),sh="synthetic";class sd{constructor(e,t){this._syntheticFlagOverride="boolean"==typeof e?e:void 0,this._enableTestingCache="boolean"==typeof t?t:void 0,this._isDebugCookieEnabled=sd.getDebugCookie(),this.bind()}saveEvent(e){try{if(!e)return;this.bind(),this.addSyntheticTag(e),this.cache(e)}catch{}}bind(){!this.shouldCacheEvent()||typeof window>"u"||window.testAnalytics||(window.testAnalytics={eventCache:[],events:()=>window.testAnalytics.eventCache,clear:()=>{window.testAnalytics.eventCache=[];try{localStorage.removeItem("awc.ui.viewed.last.sent"),localStorage.removeItem("awc-staging.ui.viewed.last.sent"),localStorage.removeItem("awc-dev.ui.viewed.last.sent"),localStorage.removeItem("awc-local.ui.viewed.last.sent")}catch{}}})}cache(e){!this.shouldCacheEvent()||typeof window>"u"||!window.testAnalytics||(window.testAnalytics.eventCache.length>=100&&(window.testAnalytics.eventCache=window.testAnalytics.eventCache.slice(1,window.testAnalytics.eventCache.length)),window.testAnalytics.eventCache.push(e))}addSyntheticTag(e){this.shouldSetSyntheticFlag()&&(e.tags instanceof Array?e.tags.includes(sh)||e.tags.push(sh):e.tags=[sh])}shouldCacheEvent(){return this._enableTestingCache?this._enableTestingCache:this._isDebugCookieEnabled}shouldSetSyntheticFlag(){if(void 0!==this._syntheticFlagOverride)return this._syntheticFlagOverride;let e=rX.getSyntheticFlagOverride();return void 0!==e?e:this.shouldCacheEvent()}static getDebugCookie(){try{return!0===JSON.parse(rl().get(su)||"false")}catch{rl().remove(su)}return!1}}let sf=()=>"u">typeof document?document:null,sp=["embeddedProduct"];function sm(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function sy(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?sm(Object(r),!0).forEach(function(t){(0,w.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):sm(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}class sg{constructor(e,t,r,s={}){if((0,w.A)(this,"start",()=>{this._startInterval(),this._bindEventListeners()}),(0,w.A)(this,"stop",()=>{this._stopInterval(),this._unbindEventListeners()}),(0,w.A)(this,"resetTimers",()=>{this._intervalId&&(this.stop(),this.start())}),(0,w.A)(this,"_bindEventListeners",()=>{"u">typeof window&&(window.addEventListener("focus",this._focusListener),window.addEventListener("blur",this._blurListener))}),(0,w.A)(this,"_unbindEventListeners",()=>{"u">typeof window&&(window.removeEventListener("focus",this._focusListener),window.removeEventListener("blur",this._blurListener))}),(0,w.A)(this,"_startInterval",()=>{clearInterval(this._intervalId),this._intervalId=setInterval(this._handleInterval,this._delay)}),(0,w.A)(this,"_stopInterval",()=>{this._intervalId&&(clearInterval(this._intervalId),this._intervalId=null)}),(0,w.A)(this,"_getProductKey",(e,t)=>{let r=e;return t&&(r+=`-${t}`),r}),(0,w.A)(this,"_getLastSentTimestamp",(e,t,r)=>(((this._parseLocalStorageData(this._storageKey)||{})[r]||{})[t]||{})[e]||null),(0,w.A)(this,"_parseLocalStorageData",e=>{let t=this._safeLocalStorage.getItem(e);try{return JSON.parse(t||"")}catch{return this._safeLocalStorage.removeItem(e),null}}),(0,w.A)(this,"_getMalformedLastSentTimestamp",(e,t,r)=>(((this._parseLocalStorageData(this._malformedEventStorageKey)||{})[r||"NOT_SET"]||{})[t||"NOT_SET"]||{})[e]||null),(0,w.A)(this,"_setLastSentTimestamp",(e,t,r)=>{let s=this._parseLocalStorageData(this._storageKey)||{},i=s[r]||{},n=i[t]||{};n[e]=Date.now(),i[t]=n,s[r]=i,this._safeLocalStorage.setItem(this._storageKey,JSON.stringify(s))}),(0,w.A)(this,"_setMalformedLastSentTimestamp",(e,t,r)=>{let s=this._parseLocalStorageData(this._malformedEventStorageKey)||{},i=r||"NOT_SET",n=t||"NOT_SET",o=s[i]||{},a=o[n]||{};a[e]=Date.now(),o[n]=a,s[i]=o,this._safeLocalStorage.setItem(this._malformedEventStorageKey,JSON.stringify(s))}),(0,w.A)(this,"_shouldSendEvent",(e,t,r,s)=>{let i=sf();if(i&&!i.hasFocus())return"FocusLost";if(t!==_.v7.NONE&&!r||!s){let t=Date.now()-this._getMalformedLastSentTimestamp(e,r,s);return null===t||t>this._throttle?"UserOrTenantIncomplete":"MalformedUiViewedRateLimited"}let n=Date.now()-this._getLastSentTimestamp(e,r,s);return null===n||n>this._throttle?"EligibleToSend":"UiViewedRateLimited"}),(0,w.A)(this,"_handleInterval",()=>{let e=this._getContext(),{embeddedProduct:t}=e,r=(0,tb.A)(e,sp);this._sendEvent(this._product,r),t&&this._sendEvent(t,r,!0)}),(0,w.A)(this,"_sendEvent",(e,t,r=!1)=>{let{subproduct:s,tenantIdType:i,tenantId:n,userId:o,lastScreenEvent:a,attributes:c}=t,l=this._getProductKey(e,s);switch(this._shouldSendEvent(l,i,n,o)){case"EligibleToSend":this._setLastSentTimestamp(l,n,o),this._onEvent(this._createEvent(e,s,r,a,c,"ui","viewed"));break;case"UserOrTenantIncomplete":this._setMalformedLastSentTimestamp(l,n,o),this._onEvent(this._createEvent(e,s,r,a,c,"malformed","uiviewed"))}}),(0,w.A)(this,"_createEvent",(e,t,r,s,i,n,o)=>{let a={product:e,source:"ui",action:o,actionSubject:n,attributes:i};return r&&(a.subproduct=null,a.version=null,a.attributes=sy(sy({},a.attributes),{},{embeddedInEnv:this._productInfo.env,embeddedInProduct:this._productInfo.product,embeddedInSubproduct:t,embeddedInVersion:this._productInfo.version,embeddedInOrigin:this._productInfo.origin,embeddedInPlatform:this._productInfo.platform})),s&&(a.attributes=sy(sy({},a.attributes),{},{lastScreenEvent:{name:s.name,attributes:s.attributes}})),a}),!e)throw Error("Missing productInfo");if(!e.product)throw Error("Missing productInfo.product");if(!t)throw Error("Missing getContext callback");if("function"!=typeof t)throw Error("Invalid getContext, must be function");if(!r)throw Error("Missing onEvent callback");if("function"!=typeof r)throw Error("Invalid onEvent, must be function");this._productInfo=e,this._product=e.product,this._getContext=t,this._onEvent=r,this._delay=s.delay||2e3,this._throttle=s.throttle||36e5,this._storageKey=s.storageKey||"ui.viewed.last.sent",this._malformedEventStorageKey=s.malformedStorageKey||"malformed.uiviewed.last.sent",this._safeLocalStorage=new rb({envPrefix:this._productInfo.env}),this._focusListener=()=>{this._startInterval()},this._blurListener=()=>{this._stopInterval()}}}function sb(e,t){return e&&"function"==typeof e?()=>{e(t)}:null}let sv=((I={}).XC="xc",I.UID="uid",I);(E={}).NEW="NEW",E.CHANGED="CHANGED",E.EXISTING="EXISTING",E.TIMEOUT="TIMEOUT",E.ERROR="ERROR",E.UNAVAILABLE="UNAVAILABLE",E.MALFORMED="MALFORMED",E.UNKNOWN="UNKNOWN";let sI=()=>[{type:sv.XC,state:"TIMEOUT"},{type:sv.UID,state:"TIMEOUT"}],sE=()=>[{type:sv.XC,state:"UNKNOWN"},{type:sv.UID,state:"UNKNOWN"}],sw=(e,t)=>{if(e&&t&&"function"==typeof t)return Promise.race([t().catch(()=>()=>sE()),new Promise(e=>{setTimeout(()=>e(()=>sI()),5e3)})])};var s_=r(68731);function sA(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function sO(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?sA(Object(r),!0).forEach(function(t){(0,w.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):sA(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let sS="last.screen.event";class sT{static getCallback(e){return e=e||s_,t=>{sT.callback(t,e)}}static callback(e,t){let r=e.getStatusCode();r>=200&&r<=299?e.getEventResponseList().forEach(e=>{t.warn(`Validation report for event with message ID %s:
`,e.getMessageId(),e)}):400===r||404===r?(t.warn("GASv3 submission failed with HTTP Status Code %d: %s",e.getStatusCode(),e.getMessage()),e.getEventResponseList().forEach(e=>{t.warn(`Event with message ID %s:
`,e.getMessageId(),e)})):(t.log("GASv3 submission failed with HTTP Status Code %d: %s",e.getStatusCode(),e.getMessage()),e.eventResponseList.forEach(e=>{t.debug(`Event with message ID %s:
`,e.getMessageId(),e)}))}}class sP{constructor(e,t={}){if((0,w.A)(this,"_useStargate",e=>e??!0),(0,w.A)(this,"_changeInternalUserId",(e,t)=>{this._eventProcessor.getUser().setUserId(e),t&&t!==this._eventProcessor.getUser().getAnonymousId()&&this._eventProcessor.getUser().setAnonymousId(t)}),(0,w.A)(this,"_createSubproductGetter",e=>D(e,"Cannot get subproduct from the callback. Proceeding without it.")),(0,w.A)(this,"_createEmbeddedProductGetter",e=>D(e,"Cannot get embeddedProduct from the callback. Proceeding without it.")),(0,w.A)(this,"_getLastScreenEvent",()=>{try{return JSON.parse(this._safeSessionStorage.getItem(sS)||"")}catch{return this._safeSessionStorage.removeItem(sS),null}}),(0,w.A)(this,"_setLastScreenEvent",e=>{this._safeSessionStorage.setItem(sS,JSON.stringify({name:e.name,attributes:e.attributes}))}),(0,w.A)(this,"_shouldEventBeDelayed",e=>{if(!e.tags||-1===e.tags.indexOf("measurement"))return!1;let t=!1!==e.highPriority;return this._eventDelayQueue.isDelayingLowPriorityEvents()&&!t}),(0,w.A)(this,"_fireEvent",(e,t,r,s)=>{switch(t.eventType){case _.$q.UI:case _.$q.OPERATIONAL:case _.$q.TRACK:return this._eventProcessor.track(e,t,r,s);case _.$q.SCREEN:return this._eventProcessor.page(e,t,r,s);case _.$q.IDENTIFY:return this._eventProcessor.identify(e,t,r,s);default:throw Error(`No handler has been defined for events of type ${t.eventType}`)}}),(0,w.A)(this,"_fireDelayedEvent",(e,t,r,s)=>{try{this._changeInternalUserId(s.userId,s.anonymousId),t.tags=[...t.tags||[],"sentWithDelay"],this._fireEvent(e,t,r,void 0)}finally{this._changeInternalUserId(this._userInfo.userId,this._userInfo.anonymousId)}}),(0,w.A)(this,"_delayEvent",(e,t,r,s,i)=>{this._eventDelayQueue.push(e,t,r,s),i&&i()}),(0,w.A)(this,"_processEvent",(e,t,r,s)=>(this._testingCache.saveEvent(t),this._shouldEventBeDelayed(t)?(this._delayEvent(e,t,r,this._userInfo,s),Promise.resolve()):this._fireEvent(e,t,r,s))),(0,w.A)(this,"setEmbeddedProduct",e=>{this._internalProductInfo.embeddedProduct=this._createEmbeddedProductGetter(e),this.resetUIViewedTimers()}),(0,w.A)(this,"clearEmbeddedProduct",()=>{this._internalProductInfo.embeddedProduct=this._createEmbeddedProductGetter(null)}),(0,w.A)(this,"setSubproduct",e=>{this._internalProductInfo.subproduct=this._createSubproductGetter(e),this.resetUIViewedTimers()}),(0,w.A)(this,"setOriginTracingHandlers",e=>{let t=this._originTracing.handleOriginParameters(e,this._historyReplaceFn);Object.keys(t).forEach(e=>{"u">typeof t[e].taskSessionId&&this._task.createTaskSessionWithProvidedId(e,t[e].taskSessionId)});let r={};return Object.keys(t).forEach(e=>{t[e].originTracingAttributes?r[e]=t[e].originTracingAttributes:s_.warn(`Handling method for origin parameter ${e} has not returned any attributes`)}),Object.keys(t).length>0?this.sendOperationalEvent({action:"landed",actionSubject:"origin",source:"webClient",attributes:{originTracesLanded:r}},()=>{}):Promise.resolve()}),(0,w.A)(this,"setTenantInfo",(e,t)=>{if(!e)throw Error("Missing tenantIdType");if(e!==_.v7.NONE&&!t)throw Error("Missing tenantId");if(!(0,_.Xj)(_.v7,e))throw Error(`Invalid tenantIdType '${e}', must be an tenantType: [${(0,_.KQ)(_.v7)}]`);this._tenantInfo={tenantIdType:e,tenantId:t},this._eventProcessor.refreshMetadata(this._userInfo,this._tenantInfo)}),(0,w.A)(this,"clearTenantInfo",()=>{this._tenantInfo={},this._eventProcessor.refreshMetadata(this._userInfo,this._tenantInfo)}),(0,w.A)(this,"setOrgInfo",e=>{if(!e)throw Error("Missing orgId");this._orgInfo={orgId:e}}),(0,w.A)(this,"clearOrgInfo",()=>{this._orgInfo={}}),(0,w.A)(this,"setWorkspaceInfo",e=>{if(!e)throw Error("Missing workspaceId");this._workspaceInfo={workspaceId:e}}),(0,w.A)(this,"clearWorkspaceInfo",()=>{this._workspaceInfo={}}),(0,w.A)(this,"setUserInfo",(e,t)=>{(function(e,t){if(!e)throw Error("Missing userIdType");if(!t)throw Error("Missing userId");if(!(0,_.Xj)(_.Of,e))throw Error(`Invalid userIdType '${e}', must be an userType: [${(0,_.KQ)(_.Of)}]`)})(e,t),this._changeInternalUserId(t),this._userInfo={userIdType:e,userId:t,anonymousId:this._eventProcessor.getUser().getAnonymousId()},this._eventProcessor.refreshMetadata(this._userInfo,this._tenantInfo)}),(0,w.A)(this,"clearUserInfo",()=>{this._changeInternalUserId(void 0),this._userInfo={anonymousId:this._eventProcessor.getUser().getAnonymousId()},this._eventProcessor.refreshMetadata(this._userInfo,this._tenantInfo)}),(0,w.A)(this,"setAlias",(e,t)=>{if(!e)throw Error("Missing aliasType");if(!(0,_.Xj)(_.VD,e))throw Error(`Invalid aliasType '${e}', must be an aliasType: [${(0,_.KQ)(_.VD)}]`);this._aliases[e]=t}),(0,w.A)(this,"clearAlias",()=>{this._aliases={}}),(0,w.A)(this,"setGroup",(e,t)=>{if(!e)throw Error("Missing groupType");if(!(0,_.Xj)(_.iU,e))throw Error(`Invalid groupType '${e}', must be an groupType: [${(0,_.KQ)(_.iU)}]`);this._groups[e]=t}),(0,w.A)(this,"clearGroup",()=>{this._groups={}}),(0,w.A)(this,"getAnonymousId",()=>this._userInfo.anonymousId),(0,w.A)(this,"getCurrentSessionId",()=>this._sessionTracking.getCurrentSessionId()),(0,w.A)(this,"setUIViewedAttributes",e=>{if(!e)throw Error("Missing uiViewedAttributes");if("object"!=typeof e||Array.isArray(e))throw Error("Invalid uiViewedAttributes type, should be a non array object");this._uiViewedAttributes=sO({},e)}),(0,w.A)(this,"getUIViewedAttributes",()=>this._uiViewedAttributes),(0,w.A)(this,"clearUIViewedAttributes",()=>{this._uiViewedAttributes={}}),(0,w.A)(this,"appendUIViewedAttributes",e=>{this._uiViewedAttributes?this._uiViewedAttributes=sO(sO({},this._uiViewedAttributes),e):this._uiViewedAttributes=e}),(0,w.A)(this,"sendIdentifyEvent",(e,t,r)=>{this.setUserInfo(e,t);let s={userIdType:e,eventType:_.$q.IDENTIFY};return this._processEvent(t,s,this._context,r)}),(0,w.A)(this,"sendPageEvent",(e,t)=>this.sendScreenEvent(e,t)),(0,w.A)(this,"sendScreenEvent",(e,t,r)=>{let s,i,n,o;"object"==typeof e?(s=e.name,i=e.attributes,n=e.containers,o=e.tags):(s=e,i=r),function(e){if(!e)throw Error("Missing name")}(s),eK(n);let a=function(e,t,r,s,i,n,o,a,c,l,u,h,d,f,p,m,y){let g=ej(e),b=eA(t),v=eO(r),I=eS(u),E=eT(d),w={title:"",path:"",url:"",referrer:"",search:"",eventType:_.$q.SCREEN};return e_(e_(e_(e_(e_(e_(e_(e_(e_(e_(e_(e_(e_({},g),b),v),I),w),ex("attributes",s)),ex("nonPrivacySafeAttributes",i)),eL(p)),ek(f)),{},{tags:n,tabId:o,sessionId:a,taskSessions:c},eD(l)),{},{pageLoadId:h},E),eP(m)),eC(y))}(this._internalProductInfo,this._tenantInfo,this._userInfo,i,e.nonPrivacySafeAttributes,o,this._tabTracking.getCurrentTabId(),this._sessionTracking.getCurrentSessionId(),this._task.getAllTaskSessions(),this._crossProductInteractionTracking.getInteractionSession(),this._orgInfo,this._pageLoadId,this._workspaceInfo,e,n,this._aliases,this._groups),c=sO({name:s},a);return this._setLastScreenEvent(c),this._processEvent(s,c,this._context,sb(t,c))}),(0,w.A)(this,"sendTrackEvent",(e,t)=>{eG(e);let r=eB(this._internalProductInfo,this._tenantInfo,this._userInfo,e,_.$q.TRACK,this._tabTracking.getCurrentTabId(),this._sessionTracking.getCurrentSessionId(),this._task.getAllTaskSessions(),this._crossProductInteractionTracking.getInteractionSession(),this._orgInfo,this._pageLoadId,this._workspaceInfo,this._aliases,this._groups);return this._processEvent(eF(e),r,this._context,sb(t,r))}),(0,w.A)(this,"sendUIEvent",(e,t)=>{eG(e);let r=eB(this._internalProductInfo,this._tenantInfo,this._userInfo,e,_.$q.UI,this._tabTracking.getCurrentTabId(),this._sessionTracking.getCurrentSessionId(),this._task.getAllTaskSessions(),this._crossProductInteractionTracking.getInteractionSession(),this._orgInfo,this._pageLoadId,this._workspaceInfo,this._aliases,this._groups);return this._processEvent(eF(e),r,this._context,sb(t,r))}),(0,w.A)(this,"sendOperationalEvent",(e,t)=>{eG(e);let r=eB(this._internalProductInfo,this._tenantInfo,this._userInfo,e,_.$q.OPERATIONAL,this._tabTracking.getCurrentTabId(),this._sessionTracking.getCurrentSessionId(),this._task.getAllTaskSessions(),this._crossProductInteractionTracking.getInteractionSession(),this._orgInfo,this._pageLoadId,this._workspaceInfo,this._aliases,this._groups);return this._processEvent(eF(e),r,this._context,sb(t,r))}),(0,w.A)(this,"startUIViewedEvent",e=>{this.stopUIViewedEvent(),this._uiViewedEvent=new sg(this._internalProductInfo,()=>({embeddedProduct:this._internalProductInfo.embeddedProduct(),subproduct:this._internalProductInfo.subproduct(),tenantIdType:this._tenantInfo.tenantIdType,tenantId:this._tenantInfo.tenantId,userId:this._userInfo.userId,lastScreenEvent:this._getLastScreenEvent(),attributes:this._uiViewedAttributes}),t=>this.sendUIEvent(t,e)),this._uiViewedEvent.start()}),(0,w.A)(this,"stopUIViewedEvent",()=>{this._uiViewedEvent&&(this._uiViewedEvent.stop(),this._uiViewedEvent=null)}),(0,w.A)(this,"resetUIViewedTimers",()=>{this._uiViewedEvent&&this._uiViewedEvent.resetTimers()}),(0,w.A)(this,"startApdexEvent",e=>{this._apdexEvent.start(e)}),(0,w.A)(this,"getApdexStart",e=>this._apdexEvent.getStart(e)),(0,w.A)(this,"stopApdexEvent",(e,t)=>{this._apdexEvent.stop(e,t)}),(0,w.A)(this,"startLowPriorityEventDelay",(e,t)=>{this._eventDelayQueue.startLowPriorityEventDelay(e,t)}),(0,w.A)(this,"stopLowPriorityEventDelay",()=>{this._eventDelayQueue.stopLowPriorityEventDelay()}),(0,w.A)(this,"onEvent",(e,t)=>{if(!t)throw Error("Missing analyticsData");if(!t.eventType)throw Error("Missing analyticsData.eventType");if(t.eventType===_.$q.TRACK)return this.sendTrackEvent(t);if(t.eventType===_.$q.UI)return this.sendUIEvent(t);if(t.eventType===_.$q.OPERATIONAL)return this.sendOperationalEvent(t);if(t.eventType===_.$q.SCREEN)return this.sendScreenEvent(t.name,null,t.attributes);if(t.eventType===_.$q.IDENTIFY)return this.sendIdentifyEvent(t.userIdType,t.userId);throw Error(`Invalid analyticsData.eventType '${t.eventType}', must be an eventType: [${(0,_.KQ)(_.$q)}]`)}),(0,w.A)(this,"setResponseCallback",e=>{this._eventProcessor.setResponseCallback(e)}),!e)throw Error("Missing productInfo");if(!e.env)throw Error("Missing productInfo.env");if(!e.product)throw Error("Missing productInfo.product");if(!(0,_.Xj)(_.sR,e.env))throw Error(`Invalid productInfo.env '${e.env}', must be an envType: [${(0,_.KQ)(_.sR)}]`);if(e.perimeter&&!(0,_.Xj)(_.KW,e.perimeter))throw Error(`Invalid productInfo.perimeter '${e.perimeter}', must be an perimeterType: [${(0,_.KQ)(_.KW)}]`);if(e.origin){if(!(0,_.Xj)(_.VH,e.origin))throw Error(`Invalid productInfo.origin '${e.origin}', must be an originType: [${(0,_.KQ)(_.VH)}]`)}else e.origin=_.VH.WEB;e.platform?function(e){if(!(0,_.Xj)(_.AQ,e.platform))throw Error(`Invalid productInfo.platform '${e.platform}', must be a platformType: [${(0,_.KQ)(_.AQ)}]`);if(e.origin===_.VH.DESKTOP&&!(0,_.Xj)(_.vB,e.platform))throw Error(`Invalid productInfo.platform '${e.platform}', must be one of [mac, linux, windows]`);if(e.origin===_.VH.WEB&&!(0,_.Xj)(_.LK,e.platform))throw Error(`Invalid productInfo.platform '${e.platform}', must be one of [web, mobileWeb]`)}(e):e.platform=e.origin===_.VH.WEB?_.AQ.WEB:_.AQ.DESKTOP,this._logger=t.logger||s_,this._internalProductInfo=sO(sO({},e),{},{subproduct:this._createSubproductGetter(e.subproduct),embeddedProduct:this._createEmbeddedProductGetter(e.embeddedProduct)}),this._tenantInfo={},this._orgInfo={},this._uiViewedAttributes={},null!=e&&e.embeddedContext&&(this._embeddedContext=e.embeddedContext,eb(this._embeddedContext)&&this.setUIViewedAttributes({embeddedType:this._embeddedContext.embeddedType,embeddedFromProduct:this._embeddedContext.embeddedFromProduct,embeddedFromSubproduct:this._embeddedContext.embeddedFromSubproduct,embeddedFromTopLevelDomain:this._embeddedContext.embeddedFromTopLevelDomain}),ev(this._embeddedContext)&&this.setUIViewedAttributes({embeddedType:this._embeddedContext.embeddedType,embeddedFromTopLevelDomain:this._embeddedContext.embeddedFromTopLevelDomain})),this._context=function(e){let t=window.screen||{};return{context:{locale:e.locale,screen:{width:t.width,height:t.height,density:window.devicePixelRatio},library:{name:"analytics.js",version:"0.0.0-development"},validationMode:function(e){let t=e.env;return void 0===t||t.includes("prod")?eU.QUIET:eU.COMPLETE}(e)}}}(this._internalProductInfo),this._safeSessionStorage=new st;let r=this._useStargate(t.useStargate),s=t.apiHost||function({useStargate:e,env:t,useLegacyUrl:r,perimeter:s,ic:i,envOverride:n}){if(i)throw Error(r?"IC is set but useLegacyUrl is true.":"IC is set but no apiHost provided.");return s===_.KW.FEDRAMP_MODERATE?rJ({useStargate:e,env:t,useLegacyUrl:r,envOverride:n}):rY({useStargate:e,env:t,useLegacyUrl:r})}({useStargate:r,env:e.env,useLegacyUrl:t.useLegacyUrl,perimeter:e.perimeter,ic:e.ic,envOverride:e.envOverride}),i=t.apiHostProtocol||"https",n=t.minRetryDelay||1e3,o=void 0!==t.maxRetryAttempts&&Number.isInteger(t.maxRetryAttempts)&&t.maxRetryAttempts>=0?t.maxRetryAttempts+1:void 0,a={maxRetryDelay:6e4,minRetryDelay:n,backoffFactor:2,flushWaitMs:t.flushWaitInterval,flushBeforeUnload:t.flushBeforeUnload,maxAttempts:o},c=`awc-${e.env}`,l=t.disableCookiePersistence||!1,u=(t.metadataClientFactory||r3.Factory)(i,s,e.product);this._eventProcessor=new rV({apiHost:s,apiHostProtocol:i,product:e.product,retryQueuePrefix:c,retryQueueOptions:a,xidPromiseGetter:()=>sw(t.xidConsent,t.xidPromiseFn),logger:this._logger,metadataClient:u,disableCookiePersistence:l,responseCallback:sT.getCallback(this._logger),env:e.env,perimeter:e.perimeter,enableMetadataCalls:this.metadataCallsEnabled(t),enableEventCalls:this.eventCallsEnabled(t)}),this._userInfo={anonymousId:this._eventProcessor.getUser().getAnonymousId(t?.customAnonymousIdGenerator)},this._pageVisibility=new A,this._tabTracking=new ss,this._sessionTracking=new se({sessionExpiryTime:t.sessionExpiryTime,onNewSessionStarted:t.onNewSessionStarted}),this._task=new sl,this._originTracing=new r5,this._apdexEvent=new P(this.sendOperationalEvent,this._pageVisibility),this._historyReplaceFn="function"==typeof t.historyReplaceFn?t.historyReplaceFn:ep,this._eventDelayQueue=new eZ(this._fireDelayedEvent,t.delayQueueCompressors||[]),this._testingCache=new sd(t.isSynthetic,t.enableTestingCache),this._pageLoadId=crypto.randomUUID(),this._workspaceInfo={},this._aliases={},this._groups={},this._crossProductInteractionTracking=new eg({perimeter:e.perimeter,product:e.product,sendEventCallback:this.sendOperationalEvent}),this._crossProductInteractionTracking.validateInteractionSession()}metadataCallsEnabled(e){return"boolean"==typeof e.disableMetadataCalls?!e.disableMetadataCalls:!rX.isGeminiVREnvironment()&&!rX.areFetchCallsDisabled()}eventCallsEnabled(e){return"boolean"==typeof e.disableEventCalls?!e.disableEventCalls:!rX.isGeminiVREnvironment()&&!rX.areFetchCallsDisabled()}setEventValidationMode(e){this._context.context.validationMode=e}get task(){return this._task}get _productInfo(){return this._internalProductInfo}}},84802:function(e,t,r){"use strict";var s,i,n,o,a,c,l,u,h,d,f;r.d(t,{$q:()=>m,AQ:()=>y,D0:()=>A,KQ:()=>O,KW:()=>T,LK:()=>_,LR:()=>E,Of:()=>I,VD:()=>P,VH:()=>g,Xj:()=>S,iU:()=>C,sR:()=>p,v7:()=>b,vB:()=>w,vH:()=>v});let p=((s={}).LOCAL="local",s.DEV="dev",s.STAGING="staging",s.PROD="prod",s),m=((i={}).TRACK="track",i.UI="ui",i.OPERATIONAL="operational",i.SCREEN="screen",i.IDENTIFY="identify",i),y=((n={}).MAC="mac",n.LINUX="linux",n.WINDOWS="windows",n.DESKTOP="desktop",n.WEB="web",n.MOBILE_WEB="mobileWeb",n),g=((o={}).DESKTOP="desktop",o.WEB="web",o),b=((a={}).CLOUD_ID="cloudId",a.ORG_ID="orgId",a.OPSGENIE_CUSTOMER_ID="opsgenieCustomerId",a.HALP_TEAM_ID="halpTeamId",a.LOOM_ORG_ID="loomOrgId",a.TRANSACTION_ACCOUNT_ID="transactionAccountId",a.TRELLO_WORKSPACE_ID="trelloWorkspaceId",a.JA_WORKSPACE_ID="jiraAlignWorkspaceId",a.STUDIO_WORKSPACE_ID="studioWorkspaceId",a.NONE="none",a),v=((c={}).FIRST_PARTY="FIRST_PARTY",c.THIRD_PARTY="THIRD_PARTY",c),I=((l={}).ATLASSIAN_ACCOUNT="atlassianAccount",l.HASHED_EMAIL="hashedEmail",l.LOOM="loom",l.TRELLO="trello",l.OPSGENIE="opsgenie",l.JA_USER_ID="jiraAlign",l.HALP="halp",l),E=((u={}).TRANSITION="transition",u.INITIAL_LOAD="initialLoad",u),w=Object.freeze([y.DESKTOP,y.MAC,y.LINUX,y.WINDOWS]),_=Object.freeze([y.WEB,y.MOBILE_WEB]),A=((h={}).ATL_ORIGIN="atlOrigin",h);function O(e){return Object.values(e)}function S(e,t){return Object.values(e).indexOf(t)>-1}let T=((d={}).C5="c5",d.COMMERCIAL="commercial",d.FEDRAMP_MODERATE="fedramp-moderate",d.FEDRAMP_HIGH="fedramp-high",d),P={},C=((f={}).TRANSACTION_ACCOUNT_ID="transactionAccountId",f)},15221:function(e,t,r){"use strict";r.d(t,{Ay:()=>se});var s,i,n,o,a,c,l,u,h,d,f,p,m,y,g,b,v,I,E=r(55564),w=r(66369),_=r.n(w),A=r(86068);class O{constructor(){(0,E.A)(this,"_bindEventListeners",()=>{document.addEventListener(this._visibilityChange,this._handleVisibilityChange,!1)}),(0,E.A)(this,"_handleVisibilityChange",()=>{let e=document[this._hidden];this._isHidden=e,this._callbacks.forEach(t=>t(e))}),this._isHidden=!1,this._callbacks=new Map,this._hidden=void 0,this._visibilityChange=void 0,"u">typeof document&&("u">typeof document.hidden?(this._isHidden=document.hidden,this._hidden="hidden",this._visibilityChange="visibilitychange"):"u">typeof document.msHidden?(this._isHidden=document.msHidden,this._hidden="msHidden",this._visibilityChange="msvisibilitychange"):"u">typeof document.webkitHidden&&(this._isHidden=document.webkitHidden,this._hidden="webkitHidden",this._visibilityChange="webkitvisibilitychange"),"u">typeof document.addEventListener&&void 0!==this._hidden&&this._bindEventListeners())}addCallback(e,t){if("string"!=typeof e)throw Error("Invalid name, must be string");if("function"!=typeof t)throw Error("Invalid callback, must be function");this._callbacks.set(e,t)}removeCallback(e){this._callbacks.has(e)&&this._callbacks.delete(e)}getIsHidden(){return this._isHidden}}class S{constructor(){this._performance=window.performance}clearMarks(...e){this._performance&&this._performance.clearMarks&&this._performance.clearMarks(...e)}mark(...e){this._performance&&this._performance.mark&&this._performance.mark(...e)}getEntriesByName(...e){return this._performance&&this._performance.getEntriesByName?this._performance.getEntriesByName(...e):[]}getTimeOrigin(){return this._performance&&(this._performance.timeOrigin||this._performance.timing)?this._performance.timeOrigin||this._performance.timing.navigationStart:0}now(){return this._performance&&this._performance.now?this._performance.now():Date.now?Date.now():+new Date}isAvailable(){return!!this._performance&&!!this._performance.clearMarks&&!!this._performance.mark&&!!this._performance.getEntriesByName&&!!this._performance.timing}}function T(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function P(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?T(Object(r),!0).forEach(function(t){(0,E.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):T(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}class C{constructor(e,t){if((0,E.A)(this,"_getEventKey",({task:e,taskId:t})=>t?`${e}.${t}`:e),(0,E.A)(this,"_getEventTimingByName",e=>{let t=this._performance.getEntriesByName(e);return t[t.length-1]}),(0,E.A)(this,"_getApdexFields",e=>{let t=this._getApdexTimings(e),r=this._calculateApdex({duration:t.duration,threshold:e.threshold});return P(P({},t),{},{apdex:r})}),(0,E.A)(this,"_getApdexTimings",e=>{let t=this._getEventKey(e),r=`${t}-start`,s=e.startTime||this._getStartTime(e,r),i=e.stopTime||this._getStopTime();return this._cleanApdexState(t),{startTime:s,stopTime:i,duration:i-s}}),(0,E.A)(this,"_getStartTime",(e,t)=>{let r;let s=this._performance.getTimeOrigin();if(e.type===A.LR.INITIAL_LOAD)r=s;else{let e=this._getEventTimingByName(t);r=s+e.startTime}return r}),(0,E.A)(this,"_getStopTime",()=>this._performance.getTimeOrigin()+this._performance.now()),(0,E.A)(this,"_cleanApdexState",e=>{this._performance.clearMarks(`${e}-start`),this._performance.clearMarks(`${e}-stop`),this._startedEvents.delete(e)}),(0,E.A)(this,"_getVisibilityFields",e=>{let t;if(e.type===A.LR.INITIAL_LOAD)t=!this._wasPreviouslyHidden;else if(e.type===A.LR.TRANSITION){let r=this._getEventKey(e);t=this._isActiveEvents.get(r)}return(e.startTime||e.stopTime)&&(t=!this._pageVisibility.getIsHidden()),{isActiveTab:t}}),(0,E.A)(this,"_calculateApdex",({duration:e,threshold:t=this._threshold})=>e<=t?1:e<=4*t?.5:0),(0,E.A)(this,"_validateStartEvent",e=>{if(!e)throw Error('Missing "event" in Apdex start event');if(!e.task)throw Error('Missing "task" in Apdex start event');if("string"!=typeof e.task)throw Error('Invalid "task" in Apdex start event');if(e.taskId&&"string"!=typeof e.taskId)throw Error('Invalid "taskId" in Apdex start event')}),(0,E.A)(this,"_validateStopEvent",e=>{if(!e)throw Error('Missing "event" in Apdex stop event');if(!e.task)throw Error('Missing "task" in Apdex stop event');if("string"!=typeof e.task)throw Error('Invalid "task" in Apdex stop event');if(e.taskId&&"string"!=typeof e.taskId)throw Error('Invalid "taskId" in Apdex stop event');if(!e.type)throw Error('Missing "type" in Apdex stop event');if(e.type&&!(0,A.Xj)(A.LR,e.type))throw Error('Invalid "type" in Apdex stop event');if(e.threshold&&"number"!=typeof e.threshold)throw Error('Invalid "threshold" in Apdex stop event');if(!e.startTime&&e.type===A.LR.TRANSITION){let t=this._getEventKey(e);if(!this._startedEvents.has(t))throw Error(`Apdex event transition "${t}" was not started`)}if(e.startTime&&!("number"==typeof e.startTime&&e.startTime>=0))throw Error('Invalid "startTime" in Apdex stop event');if(e.stopTime&&"number"!=typeof e.stopTime)throw Error('Invalid "stopTime" in Apdex stop event');if(e.stopTime<=e.startTime)throw Error('"stopTime" should be greater than "startTime" in Apdex stop event')}),(0,E.A)(this,"_shouldSendEvent",e=>!(!e||"number"!=typeof e.apdex)),(0,E.A)(this,"_sendEvent",(e,t)=>{this._shouldSendEvent(e)&&this._onEvent({source:"ui",action:"readyForUser",actionSubject:"ui",attributes:P(P({},e.additionalAttributes),{},{task:e.task,taskId:e.taskId,type:e.type,threshold:e.threshold||this._threshold,apdex:e.apdex,startTime:e.startTime,stopTime:e.stopTime,duration:e.duration,isActiveTab:e.isActiveTab})},t)}),!e)throw Error("Missing onEvent callback");if("function"!=typeof e)throw Error("Invalid onEvent, must be function");if(!(t instanceof O))throw Error("Invalid pageVisibility, must be PageVisibility class");this._startedEvents=new Map,this._performance=new S,this._onEvent=e,this._threshold=1e3,this._wasPreviouslyHidden=t.getIsHidden(),this._isActiveEvents=new Map,this._pageVisibility=t,this._pageVisibility.addCallback("apdexEvent",e=>{this.onVisibilityChange(!e)})}start(e){if(this._validateStartEvent(e),!this._performance.isAvailable())return;let t=this._getEventKey(e),r=`${t}-start`;this._startedEvents.set(t,!0),this._isActiveEvents.set(t,!this._pageVisibility.getIsHidden()),this._performance.clearMarks(r),this._performance.mark(r)}getStart(e){if(this._validateStartEvent(e),!this._performance.isAvailable())return;let t=`${this._getEventKey(e)}-start`;return this._getEventTimingByName(t)}stop(e,t){if(this._validateStopEvent(e),!this._performance.isAvailable())return;let r=this._getApdexFields(e),s=this._getVisibilityFields(e);this._sendEvent(P(P(P({},e),r),s),t)}onVisibilityChange(e){e||(this._wasPreviouslyHidden=!0,Array.from(this._isActiveEvents.keys()).forEach(e=>this._isActiveEvents.set(e,!1)))}}var k=r(68731);let D=e=>"function"==typeof e,R=(e,t)=>()=>{if(D(e))try{return e()}catch(e){k.error(`${t} - ${e instanceof Error?e.message:String(e)}`);return}return e},j=e=>e.embeddedType===A.vH.FIRST_PARTY&&void 0!==e.embeddedFromProduct,N=e=>e.embeddedType===A.vH.THIRD_PARTY&&void 0!==e.embeddedFromTopLevelDomain;function x(e){return!0==(null!==e&&"object"==typeof e&&!1===Array.isArray(e))&&"[object Object]"===Object.prototype.toString.call(e)}function L(e){if(!1===x(e))return!1;let t=e.constructor;if("function"!=typeof t)return!1;let r=t.prototype;return!(!1===x(r)||!("isPrototypeOf"in r))}function M(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function F(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?M(Object(r),!0).forEach(function(t){(0,E.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):M(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function U(e){return{tenantIdType:e.tenantIdType,tenantId:e.tenantId}}function B(e){return{userIdType:e.userIdType}}function $(e){return{orgId:e.orgId}}function H(e){return{workspaceId:e.workspaceId}}function K(e){if(Q(e))return{aliases:e}}function W(e){if(Q(e))return{groups:e}}function G(e){return e.anonymousId?{anonymousId:e.anonymousId}:{}}function V(e,t){return void 0===t?e:t}function q(e,t){let r=t||{},s=V(e.env,r.env),i=V(e.product,r.product),n=V(e.subproduct(),r.subproduct),o=V(e.version,r.version),a=V(e.origin,r.origin),c=V(e.platform,r.platform);return{env:s,product:i,subproduct:n,version:o,origin:a,platform:c}}function Q(e){return L(e)&&Object.keys(e).length>0}function J(e,t){return Q(t)?{[e]:t}:void 0}function Y(e){if(Q(e)){let t=function(e){let t={};return Object.keys(e).forEach(r=>{let s=e[r];t[r]={id:s.id,type:s.type}}),t}(e);return J("containers",t)}}function X(e,t){return F({containerType:e.containerType,containerId:e.containerId,source:e.source,objectType:e.objectType,objectId:e.objectId,actionSubject:e.actionSubject,action:e.action,actionSubjectId:e.actionSubjectId,attributes:e.attributes,nonPrivacySafeAttributes:e.nonPrivacySafeAttributes,tags:e.tags,highPriority:e.highPriority,eventType:t},Y(e.containers))}function z(e){return`${e.actionSubject} ${e.action}`}let Z=((s={}).QUIET="quiet",s.STANDARD="standard",s.COMPLETE="complete",s);function ee(e,t,r,s,i,n,o,a,c,l,u,h,d){let f=q(e,function(e){let{env:t,product:r,subproduct:s,version:i,origin:n,platform:o}=e;return{env:t,product:r,subproduct:s,version:i,origin:n,platform:o}}(s)),p=U(t),m=$(c),y=H(u),g=B(r),b=X(s,i);return F(F(F(F(F(F(F(F(F({},f),p),m),g),b),G(s)),{},{tabId:n,sessionId:o,taskSessions:a,pageLoadId:l},y),K(h)),W(d))}let et=1e4,er=(e,t)=>Object.keys(e).reduce((r,s)=>{let i=t(e[s],s,e);return r[i]=e[s],r},{}),es=(e,t)=>t.reduce((t,r)=>(r in e&&(t[r]=e[r]),t),{}),ei=(e,t)=>Object.keys(e).filter(r=>!t(e[r],r)).reduce((t,r)=>(t[r]=e[r],t),{}),en=(e,t)=>Object.keys(e).filter(r=>t(e[r],r)).reduce((t,r)=>(t[r]=e[r],t),{}),eo=(e,t)=>Object.keys(e).filter(e=>0>t.indexOf(e)).reduce((t,r)=>(t[r]=e[r],t),{}),ea=(e,t)=>{if(e===t)return!0;if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(!e||!t||"object"!=typeof e&&"object"!=typeof t)return e===t;if(e.prototype!==t.prototype)return!1;let r=Object.keys(e);return r.length===Object.keys(t).length&&r.every(r=>ea(e[r],t[r]))},ec=(e,t)=>e.reduce((e,r,s,i)=>(e[t(r,s,i)?0:1].push(r),e),[[],[]]),el=Object.freeze([A.$q.OPERATIONAL,A.$q.TRACK,A.$q.UI]);function eu(e){if(e){if(e&&e.constructor!==Object)throw Error("properties.containers must be an Object");Object.values(e).forEach(e=>(function(e){if(!L(e))throw Error("properties.containers must be an Object");if(!("id"in e))throw Error("properties.containers is missing field 'id'");if("string"!=typeof e.id)throw Error("properties.containers.id must be of type String");if("type"in e&&"string"!=typeof e.type)throw Error("properties.containers.type must be of type String")})(e))}}function eh(e){switch(e){case A.$q.OPERATIONAL:case A.$q.TRACK:case A.$q.UI:return!0;default:return!1}}function ed(e){if(!e)throw Error("Missing event");if(!e.source)throw Error("Missing event.source");if(!e.actionSubject)throw Error("Missing event.actionSubject");if(!e.action)throw Error("Missing event.action");eu(e.containers)}class ef{constructor(e,t){if((0,E.A)(this,"canCompress",e=>{try{return e&&eh(e.eventType)&&this.predicate(e)}catch{return!1}}),(0,E.A)(this,"compress",e=>{let[t,r]=ec(e,e=>this.canCompress(e)),s=this.compressFn(t);if(!s)throw Error("No events were returned from the compression function");return s.forEach(e=>{(function(e){if(!eh(e))throw Error(`Invalid action event type: ${e}, must be one of: [${el}]`)})(e.eventType),ed(e)}),s.concat(r)}),"function"!=typeof e)throw Error("Invalid predicate, must be a function that accepts an event and returns a boolean");if("function"!=typeof t)throw Error("Invalid compressFn, must be a function that both accepts and returns an array of events");this.predicate=e,this.compressFn=t}}function ep(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function em(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ep(Object(r),!0).forEach(function(t){(0,E.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ep(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}class ey{constructor(e=[]){if((0,E.A)(this,"canCompress",e=>this.compressionRules.some(t=>t.canCompress(e))),(0,E.A)(this,"compress",e=>this.createGroups(e).reduce((e,t)=>{let r=this.compressGroup(t);return e.concat(r)},[])),(0,E.A)(this,"createGroups",e=>e.reduce((e,t)=>{let r;let s=this.compressionRules.find(e=>e.canCompress(t));if(s){let e=X(t,t.eventType);r=eo(t,Object.keys(e))}let i=e.find(e=>s===e.compressor&&ea(r,e.contextFields));return i?i.events.push(t):e.push({contextFields:r,compressor:s,events:[t]}),e},[])),(0,E.A)(this,"compressGroup",e=>{if(!e.compressor)return e.events;try{return e.compressor.compress(e.events).map(t=>em(em({},t),e.contextFields))}catch{return e.events}}),!Array.isArray(e))throw Error("Event compressors must be constructed with an array of CompressionRules");if(!e.every(e=>e instanceof ef))throw Error("Event compressors can only be constructed with instances of CompressionRule");this.compressionRules=e}}var eg=r(68731);class eb{constructor(e,t){(0,E.A)(this,"push",(e,t,r,s)=>{this.eventArgs.push({identifier:e,builtEvent:t,context:r,userInfo:s})}),(0,E.A)(this,"size",()=>this.eventArgs.length),(0,E.A)(this,"startFlush",()=>{try{this.eventArgs=this.compressEventArgs(this.eventArgs)}catch(e){eg.warn(`Failed to perform compression on the delayed analytics events. Error: ${e.message}. Sending ${this.eventArgs.length} uncompressed events instead`)}this.flushNextBatch()}),(0,E.A)(this,"cancelFlush",()=>{this.flushBatchTimeout&&(clearTimeout(this.flushBatchTimeout),this.flushBatchTimeout=null)}),(0,E.A)(this,"flushNextBatch",()=>{this.eventArgs.splice(0,7).forEach(e=>this.processFn(e.identifier,e.builtEvent,e.context,e.userInfo)),this.eventArgs.length>0?this.flushBatchTimeout=setTimeout(()=>this.flushNextBatch(),100):this.flushBatchTimeout=null}),(0,E.A)(this,"compressEventArgs",e=>{let[t,r]=ec(e,e=>this.compressor.canCompress(e.builtEvent)),s=t.reduce((e,t)=>{let r=e.find(e=>ea(e.userInfo,t.userInfo)&&ea(e.context,t.context));return r?r.eventArgs.push(t):e.push({userInfo:t.userInfo,context:t.context,eventArgs:[t]}),e},[]).reduce((e,t)=>{try{let r=t.eventArgs.map(e=>e.builtEvent),s=this.compressor.compress(r).map(e=>({identifier:z(e),builtEvent:e,userInfo:t.userInfo,context:t.context}));return e.concat(s)}catch(e){return eg.warn(`Failed to compress some analytics events. Error: ${e.message}. Sending ${t.eventArgs.length} uncompressed events instead`),t.eventArgs}},[]);return r.forEach(e=>s.push(e)),s}),this.processFn=e,this.flushBatchTimeout=null,this.eventArgs=[],this.compressor=new ey(t)}}let ev=((i={}).TIMEOUT="timeout",i.MANUAL="manual",i);class eI{constructor(e,t){(0,E.A)(this,"push",(e,t,r,s)=>{this.delayQueue.push(e,t,r,s)}),(0,E.A)(this,"startLowPriorityEventDelay",(e=et,t)=>{if(Number.isNaN(e)||e<=0)throw Error(`Invalid timeout period: ${e}, must be a number greater than 0`);this.delayTimeout&&clearTimeout(this.delayTimeout),this.delayCallback=t,this.delayTimeout=setTimeout(()=>this.stopLowPriorityEventDelay(ev.TIMEOUT),e?Math.min(e,3e4):3e4),this.delayQueue.cancelFlush(),this.isDelaying=!0}),(0,E.A)(this,"stopLowPriorityEventDelay",(e=ev.MANUAL)=>{var t;this.delayTimeout&&(clearTimeout(this.delayTimeout),this.delayTimeout=void 0),this.delayQueue.startFlush(),this.isDelaying=!1,null===(t=this.delayCallback)||void 0===t||t.call(this,e),this.delayCallback=void 0}),(0,E.A)(this,"isDelayingLowPriorityEvents",()=>this.isDelaying),this.isDelaying=!1,this.delayQueue=new eb(e,t)}}let eE=((n={}).IN_PROGRESS="inProgress",n.QUEUE="queue",n.RECLAIM_START="reclaimStart",n.RECLAIM_END="reclaimEnd",n.ACK="ack",n),ew=((o={})[o.RECLAIM_TIMEOUT=1e4]="RECLAIM_TIMEOUT",o[o.RECLAIM_WAIT=500]="RECLAIM_WAIT",o[o.RECLAIM_WAIT_THRESHOLD=2e3]="RECLAIM_WAIT_THRESHOLD",o),e_=(e,t)=>({[eE.ACK]:`${e}.${t}.${eE.ACK}`,[eE.QUEUE]:`${e}.${t}.${eE.QUEUE}`,[eE.IN_PROGRESS]:`${e}.${t}.${eE.IN_PROGRESS}`,[eE.RECLAIM_START]:`${e}.${t}.${eE.RECLAIM_START}`,[eE.RECLAIM_END]:`${e}.${t}.${eE.RECLAIM_END}`}),eA=Object.values(eE),eO=e=>{if("string"!=typeof e||0===e.length)return 0;try{let t=Object.keys(localStorage).filter(t=>t&&t.startsWith(`${e}.`)||!1).map(e=>e.split(".")).filter(e=>3===e.length&&eA.includes(e[2])).reduce((e,t)=>{let[,r,s]=t;return void 0===e[r]&&(e[r]={}),e[r][s]=!0,e},{}),r=Object.keys(t).filter(e=>!0!==t[e][eE.ACK]);return r.forEach(t=>{let{queue:r,inProgress:s,reclaimStart:i,reclaimEnd:n}=e_(e,t);localStorage.removeItem(s),localStorage.removeItem(r),localStorage.removeItem(i),localStorage.removeItem(n)}),r.length}catch{}return 0};function eS(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function eT(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?eS(Object(r),!0).forEach(function(t){(0,E.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):eS(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let eP=e=>new Promise(t=>{setTimeout(t,e)}),eC=e=>{try{return Object.keys(localStorage).filter(t=>t.startsWith(e)).map(e=>e.split(".")).filter(t=>{if(3===t.length&&t[0]===e&&t[2]===eE.ACK)try{let e=localStorage.getItem(t.join("."));if(e){let t=parseInt(e);return ew.RECLAIM_TIMEOUT+t<Date.now()}}catch{}return!1}).map(e=>e[1])}catch{}return[]},ek=async(e,t)=>{let{ack:r,reclaimStart:s,reclaimEnd:i}=e.storageKeys,n=Date.now();if(localStorage.setItem(s,e.reclaimProcessId),localStorage.setItem(r,n.toString()),await eP(ew.RECLAIM_WAIT),Date.now()>n+ew.RECLAIM_WAIT_THRESHOLD||localStorage.getItem(s)!==e.reclaimProcessId)throw Error("Took to long to callback, reclaim abandonded. After reclaimStart.");if(localStorage.setItem(i,e.reclaimProcessId),await eP(ew.RECLAIM_WAIT),Date.now()>n+ew.RECLAIM_WAIT_THRESHOLD||localStorage.getItem(s)!==e.reclaimProcessId||localStorage.getItem(i)!==e.reclaimProcessId)throw Error("Took to long to callback, reclaim abandonded. After reclaimEnd.");return eD(e,t)},eD=async(e,t)=>{let{queue:r,inProgress:s}=e.storageKeys,i=JSON.parse(localStorage.getItem(r)||"[]"),n=JSON.parse(localStorage.getItem(s)||"{}"),o=Object.entries(n).map(([e,t])=>eT(eT({},t),{},{attemptNumber:t.attemptNumber+1,id:e})),a=[...i,...o];if(a.length>0){let i=await t(a);if("successful"===i.status)eR(e.storageKeys);else if("partial"===i.status){let e=a.filter(e=>!i.acceptedItemIds.includes(e.id));return localStorage.removeItem(s),localStorage.setItem(r,JSON.stringify(e)),{fullReclaim:!1}}}else eR(e.storageKeys);return{fullReclaim:!0}},eR=e=>{localStorage.removeItem(e.queue),localStorage.removeItem(e.inProgress),localStorage.removeItem(e.reclaimEnd),localStorage.removeItem(e.reclaimStart),localStorage.removeItem(e.ack)},ej=async(e,t)=>{if("string"!=typeof e||0===e.length)return{fullReclaims:0,partialReclaims:0,failedReclaims:0};let r=_()(),s=eC(e).map(s=>ek({queuePrefix:e,reclaimProcessId:r,storageKeys:e_(e,s)},t)),i=await Promise.allSettled(s),n=i.filter(e=>"rejected"===e.status),o=i.filter(e=>"fulfilled"===e.status).map(e=>e.value),a=o.filter(e=>e.fullReclaim),c=o.filter(e=>!e.fullReclaim);return{failedReclaims:n.length,partialReclaims:c.length,fullReclaims:a.length}},eN="namespace-timeAdded",ex="analytics-resilience",eL="timeToBeProcessedAfter",eM="timeAdded",eF="retryAttempts",eU=((a={}).INDEXEDDB="indexeddb",a.MEMORY="memory",a),eB=((c={}).IGNORE="ignore",c.ABANDON="abandon",c.EVICT="evict",c);class e$ extends Error{constructor(){super("window.indexeddb is undefined."),Object.setPrototypeOf(this,e$.prototype),this.name="NoIndexedDbError"}}let eH="AbandonWriteError";class eK extends Error{constructor(e){super(`Event Limit reached. Abandoning write to: ${e}`),Object.setPrototypeOf(this,eK.prototype),this.name=eH}}let eW="CallbackProcessingError";class eG extends Error{constructor(e){let t=e&&"object"==typeof e&&"toString"in e&&"function"==typeof e.toString&&e.toString()||"string"==typeof e&&e||"Argument passed to CallbackProcessingError was not an Error or string.";super(`Error thrown while processing events in callback: ${t}`),Object.setPrototypeOf(this,eG.prototype),this.name=eW}}let eV="InvalidPolicyError";class eq extends Error{constructor(e,t){super(`Method '${t}' cannot be called with policy '${e}'.`),this.name=eV}}let eQ=e=>!!e&&"object"==typeof e&&"name"in e&&"string"==typeof e.name&&(e.name===eH||e.name===eW||e.name===eV);var eJ=r(68036);let eY=7;var eX=r(68731);let ez=(e,t,{id:r,retryAttempts:s,timeToProcessOffset:i})=>({item:e,id:r||_()(),retryAttempts:s||0,timeToBeProcessedAfter:Date.now()+(i||0),namespace:t,timeAdded:Date.now()}),eZ=e=>({logger:e.logger||eX,useMemory:e.useMemory||!1,maxAttempts:e.maxAttempts||10,maxEventLimit:e.maxEventLimit||5e3}),e0=e=>new Promise((t,r)=>{e.onsuccess=e=>{t(e)},e.onerror=e=>{r(e)}}),e1=e=>new Promise((t,r)=>{e.oncomplete=()=>{t()},e.onerror=e=>{r(e)},e.onabort=e=>{r(e)}}),e4=(e,t)=>{try{"function"==typeof e.commit&&e.commit()}catch(e){throw t.error("Failed to force commit transaction:",e),e}return e1(e)},e2=(e,t)=>{e.onerror=e=>{t.warn("Error thrown from request:",e)}};class e3{constructor(e,t,r,s){if((0,E.A)(this,"deleteOldestNEvents",async(e,t)=>{var r;let s=e.index(eN),i=IDBKeyRange.bound([this.namespace,0],[this.namespace,Date.now()]),n=s.getAllKeys(i,t),o=await e0(n),a=null==o||null===(r=o.target)||void 0===r?void 0:r.result;if(a&&Array.isArray(a)&&a.length>0)try{let t=a.map(t=>this.deleteItemHandler(e,t));await Promise.all(t)}catch(e){throw this.logger.warn("Failed to delete items from indexeddb.",e),e}}),e>0)this.eventLimit=e;else throw Error("Event Limit has to be set higher than 1");this.namespace=t,this.logger=r,this.deleteItemHandler=s}async insertItems(e,t,r=eB.ABANDON){let s=[...t],i=0;switch(r){case eB.ABANDON:await this.throwIfNotEnoughSpace(e,t.length);break;case eB.EVICT:i=await this.evictIfNotEnoughSpace(e,t.length);break;case eB.IGNORE:await this.calculateHowManyEventsWeCanAdd(e,s)}let n=s.map(t=>e0(e.add(t)));return await Promise.all(n),await e4(e.transaction,this.logger),{items:s,numberOfEvictedItems:i}}async throwIfNotEnoughSpace(e,t){let r=await this.calculateFreeSpace(e);if(r<t)throw new eK(`Not enough space in IndexedDb. Needed ${t} but only had ${r}`)}async evictIfNotEnoughSpace(e,t){let r=await this.calculateFreeSpace(e);if(r<t){let s=t-r;return await this.deleteOldestNEvents(e,s),s}return 0}async calculateHowManyEventsWeCanAdd(e,t){let r=await this.calculateFreeSpace(e);if(r<t.length){let e=t.length-r,s=t.length-e;t.splice(s,e)}}async calculateFreeSpace(e){let t=await this.getCountofEventsInObjectStore(e);return this.eventLimit-t}async getCountofEventsInObjectStore(e){let t=e.index(eN),r=IDBKeyRange.bound([this.namespace,0],[this.namespace,Date.now()]),s=t.count(r);return(await e0(s)).target.result}}let e5=["item"],e6=["items"];function e7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}class e8{constructor(e,t={}){if((0,E.A)(this,"startDB",async()=>new Promise(async(e,t)=>{if("u">typeof window){let r=window.setTimeout(()=>{this.logger.warn("IndexedDB timed out."),t(new e$)},15e3),s=window.indexedDB.open("analytics-web-client",1);s.onupgradeneeded=e=>{if(0!==e.oldVersion)throw Error("We cannot upgrade the database. Do not do this.");let t=s.result.createObjectStore(ex,{keyPath:"id"});t.createIndex(eL,eL,{unique:!1}),t.createIndex(eF,eF,{unique:!1}),t.createIndex(eM,eM,{unique:!1}),t.createIndex(eN,["namespace","timeAdded"],{unique:!1})},s.onerror=function(){t(new e$)};try{return await e0(s),e(s.result)}catch(e){this.logger.warn("IndexedDB failed to initialise.",e),t(new e$)}finally{window.clearTimeout(r)}}else this.logger.warn("IndexedDB failed to initialise. No 'window' object."),t(new e$)})),(0,E.A)(this,"addItem",async(e,t={},r=eB.ABANDON)=>{let{logger:s,namespace:i}=this,n=ez(e,i,t),{objectStore:o}=await this.getObjectStoreAndTransaction("readwrite");if(r===eB.IGNORE)throw new eq(r,"IndexedDbConnector#addItem");try{if(!n.namespace||0===n.namespace.length||"string"!=typeof n.namespace)throw Error("Namespace not specified");let e=await this.globalEventLimitGuard.insertItems(o,[n],r);if(1===e.items.length)return{item:e.items[0],numberOfEvictedItems:e.numberOfEvictedItems};throw Error(`Incorrect number of items added. Expected: 1, got: ${e.items.length}`)}catch(e){throw eQ(e)?e:(s.log("Failed to add item to table",e),Error("Request to add item to table failed"))}}),(0,E.A)(this,"bulkAddItem",async(e,t=eB.ABANDON)=>{let{logger:r,namespace:s}=this,i=e.map(e=>{let{item:t}=e;return ez(t,s,(0,eJ.A)(e,e5))}),{objectStore:n}=await this.getObjectStoreAndTransaction("readwrite");try{return await this.globalEventLimitGuard.insertItems(n,i,t)}catch(e){throw eQ(e)?e:(r.log("Failed to add item to table",e),Error("Request to add item to table failed"))}}),(0,E.A)(this,"getItems",async(e=eY)=>{let t=e>0?e:eY,{logger:r}=this,s=this.options.maxAttempts,{transaction:i,objectStore:n}=await this.getObjectStoreAndTransaction("readwrite"),o=n.index(eL),a=IDBKeyRange.upperBound(Date.now()),c=o.openCursor(a),l=await new Promise(async(e,i)=>{let n=[],o=0;c.onerror=e=>{r.error("Failed to open cursor:",e),i("Failed to open cursor")},c.onsuccess=i=>{let a=i.target.result;if(a){let i=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?e7(Object(r),!0).forEach(function(t){(0,E.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):e7(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({},a.value);n.push(i);let c=a.value;if(c.retryAttempts+=1,c.timeToBeProcessedAfter=Date.now()+6e4,c.retryAttempts>=s){++o;let e=a.delete();e2(e,r)}else{let e=a.update(c);e2(e,r)}n.length<t?a.continue():e({items:n,numberOfDeletedItems:o})}else e({items:n,numberOfDeletedItems:o})}});return await e4(i,this.logger),l}),(0,E.A)(this,"deleteItems",async e=>{let{transaction:t,objectStore:r}=await this.getObjectStoreAndTransaction("readwrite");try{let s=e.map(e=>this.deleteItem(r,e));await e4(t,this.logger),await Promise.all(s)}catch(e){throw this.logger.warn("Failed to delete items from indexeddb.",e),e}}),(0,E.A)(this,"getItemCount",async()=>{let{transaction:e,objectStore:t}=await this.getObjectStoreAndTransaction("readonly"),r=t.index(eL),s=IDBKeyRange.upperBound(Date.now()),i=r.count(s),n=await e0(i);return await e4(e,this.logger),n.target.result}),(0,E.A)(this,"processItems",async(e,t=eY)=>{let r=await this.getItems(t),{items:s}=r,i=(0,eJ.A)(r,e6);try{let t=await e(s,i),r=s.map(e=>e.id);return await this.deleteItems(r),t}catch(e){throw new eG(e)}}),(0,E.A)(this,"deleteItem",async(e,t)=>{let{logger:r}=this;try{await e0(e.delete(t))}catch(e){throw r.error("Failed to delete item:",t,e),e}}),(0,E.A)(this,"getObjectStoreAndTransaction",async e=>{let t=(await this.db).transaction(ex,e),r=t.objectStore(ex);return{transaction:t,objectStore:r}}),this.options=eZ(t),this.namespace=e,this.logger=this.options.logger,!window.indexedDB)throw new e$;this.db=this.startDB(),this.db.catch(()=>{}),this.globalEventLimitGuard=new e3(this.options.maxEventLimit,this.namespace,this.logger,this.deleteItem)}storeType(){return eU.INDEXEDDB}}class e9{constructor(e,t){if((0,E.A)(this,"insertItemsToMemoryStore",(e,t)=>{switch(t){case eB.ABANDON:return this.handleAbandonIfLimitWillExceedPolicy(e);case eB.EVICT:return Promise.resolve(this.handleEvictOldestIfLimitExceededPolicy(e));case eB.IGNORE:return this.handleAddAsManyAsPossible(e)}}),e>0)this.eventLimit=e;else throw Error("Event Limit has to be set higher than 1");this.memoryItemHandlers=t}async handleAbandonIfLimitWillExceedPolicy(e){if(await this.memoryItemHandlers.getItemCount()+e.length>this.eventLimit)throw new eK(eU.MEMORY);return this.memoryItemHandlers.addItems(e),{items:e,numberOfEvictedItems:0}}handleEvictOldestIfLimitExceededPolicy(e){this.memoryItemHandlers.addItems(e);let t=this.memoryItemHandlers.evictEventsIfNeeded(this.eventLimit);return{items:e,numberOfEvictedItems:t}}async handleAddAsManyAsPossible(e){let t=this.eventLimit-await this.memoryItemHandlers.getItemCount(),r=t>e.length?e:e.slice(0,t);return this.memoryItemHandlers.addItems(r),{items:r,numberOfEvictedItems:0}}}let te=["item"],tt=["items"];function tr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}class ts{constructor(e,t={}){this.namespace=e,this.memoryStore=[],this.options=eZ(t),this.globalEventLimitGuard=new e9(this.options.maxEventLimit,{addItems:this.addItems.bind(this),getItemCount:this.getItemCount.bind(this),evictEventsIfNeeded:this.evictEventsIfNeeded.bind(this)})}async addItem(e,t={},r=eB.ABANDON){if(r===eB.IGNORE)throw new eq(r,"IndexedDbConnector#addItem");let s=ez(e,this.namespace,t),i=await this.globalEventLimitGuard.insertItemsToMemoryStore([s],r);return Promise.resolve({item:i.items[0],numberOfEvictedItems:i.numberOfEvictedItems})}bulkAddItem(e,t=eB.ABANDON){let r=e.map(e=>{let{item:t}=e,r=(0,eJ.A)(e,te);return ez(t,this.namespace,r)});return this.bulkAddItemWrapperType(r,t)}bulkAddItemWrapperType(e,t=eB.ABANDON){return Promise.resolve(this.globalEventLimitGuard.insertItemsToMemoryStore(e,t))}getItems(e=eY){return Promise.resolve(this.synchronousGetItems(e))}synchronousGetItems(e=eY){let t=e>0?e:eY,r=Date.now(),s=[],i=[];for(let e of this.memoryStore)if(e.timeToBeProcessedAfter<=r&&(s.push(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?tr(Object(r),!0).forEach(function(t){(0,E.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tr(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({},e)),e.timeToBeProcessedAfter+=6e4,e.retryAttempts+=1,e.retryAttempts>=this.options.maxAttempts&&i.push(e)),s.length>=t)break;return i.forEach(e=>{let t=this.memoryStore.indexOf(e);this.memoryStore.splice(t,1)}),{items:s,numberOfDeletedItems:i.length}}deleteItems(e){return this.memoryStore=this.memoryStore.filter(t=>!e.includes(t.id)),Promise.resolve(void 0)}getItemCount(){let e=Date.now(),t=this.memoryStore.filter(t=>t.timeToBeProcessedAfter<=e).length;return Promise.resolve(t)}async processItems(e,t){let r=this.synchronousGetItems(t),{items:s}=r,i=(0,eJ.A)(r,tt),n=s.map(e=>e.id);try{let t=await e(s,i);return await this.deleteItems(n),t}catch(e){throw new eG(e)}}storeType(){return eU.MEMORY}addItems(e){this.memoryStore.push(...e),this.memoryStore.sort(function(e,t){return e.timeAdded-t.timeAdded})}evictEventsIfNeeded(e){let t=this.memoryStore.length;if(t>e){let r=t-e;return this.memoryStore.splice(0,r),r}return 0}}let ti=class{constructor(e,t={}){if(this.namespace=e,this.options=eZ(t),!e||0===e.length||"string"!=typeof e)throw Error("Invalid namespace provided");this.resilience=this.getResilienceMechanism(e,t)}getResilienceMechanism(e,t){if(!t.useMemory)try{return new e8(e,t)}catch(e){if(!(e instanceof e$)){var r;null===(r=t.logger)||void 0===r||r.warn("Attempted to create IndexedDbResilience but failed. Using memory instead.")}}return new ts(this.namespace,t)}addItem(e,t,r=eB.ABANDON){return this.runOrFailOver(()=>this.resilience.addItem(e,t,r))}bulkAddItem(e,t=eB.ABANDON){return this.runOrFailOver(()=>this.resilience.bulkAddItem(e,t))}getItems(e){return this.runOrFailOver(()=>this.resilience.getItems(e))}deleteItems(e){return this.runOrFailOver(()=>this.resilience.deleteItems(e))}getItemCount(){return this.runOrFailOver(()=>this.resilience.getItemCount())}processItems(e,t){return this.runOrFailOver(()=>this.resilience.processItems(e,t))}storeType(){return this.resilience.storeType()}async runOrFailOver(e){try{return await e()}catch(t){if(eQ(t))throw t;return this.resilience.storeType()===eU.INDEXEDDB&&await this.failOver(),e()}}async failOver(){let e=this.resilience,t=new ts(this.namespace,this.options);this.resilience=t;try{let{items:r}=await e.getItems(this.options.maxEventLimit);if(r.length>0){let s=(await t.bulkAddItemWrapperType(r,eB.IGNORE)).items.map(e=>e.id);await e.deleteItems(s)}}catch{this.options.logger.warn("Unexpected error from ResilienceDb, switching to MemoryDb")}}},tn=((l={}).INDEXEDDB="indexeddb",l.MEMORY="memory",l),to=((u={})[u.ONLINE=0]="ONLINE",u[u.OFFLINE=1]="OFFLINE",u);class ta{constructor(){(0,E.A)(this,"itemsDiscardedByRetry",0),(0,E.A)(this,"eventCount",0),(0,E.A)(this,"itemsDiscardedByOverflow",0),(0,E.A)(this,"resilienceMechanism",tn.INDEXEDDB),(0,E.A)(this,"localstorageNumberOfQueuesPurged",0),(0,E.A)(this,"localstorageNumberOfFullReclaims",0),(0,E.A)(this,"localstorageNumberOfPartialReclaims",0),(0,E.A)(this,"localstorageNumberOfFailedReclaims",0)}addToItemsDiscardedByRetryCounter(e=1){this.itemsDiscardedByRetry+=e}addToEventCount(){this.eventCount++}addToItemsDiscardedByOverflowCounter(e=1){this.itemsDiscardedByOverflow+=e}setResilienceMechanism(e){this.resilienceMechanism=e}addToReclaimMetrics(e){this.localstorageNumberOfFullReclaims+=e.fullReclaims,this.localstorageNumberOfPartialReclaims+=e.partialReclaims,this.localstorageNumberOfFailedReclaims+=e.failedReclaims}addToPurgedQueuesMetrics(e){this.localstorageNumberOfQueuesPurged+=e}subtractFromMetrics(e){this.itemsDiscardedByRetry=this.subtractFromCount(this.itemsDiscardedByRetry,e.itemsDiscardedByRetry),this.eventCount=this.subtractFromCount(this.eventCount,e.eventCount),this.itemsDiscardedByOverflow=this.subtractFromCount(this.itemsDiscardedByOverflow,e.itemsDiscardedByOverflow),this.localstorageNumberOfFullReclaims=this.subtractFromCount(this.localstorageNumberOfFullReclaims,e.fullReclaims),this.localstorageNumberOfPartialReclaims=this.subtractFromCount(this.localstorageNumberOfPartialReclaims,e.partialReclaims),this.localstorageNumberOfFailedReclaims=this.subtractFromCount(this.localstorageNumberOfFailedReclaims,e.failedReclaims),this.localstorageNumberOfQueuesPurged=this.subtractFromCount(this.localstorageNumberOfQueuesPurged,e.localstorageQueuesPurged)}subtractFromCount(e,t){return Math.max(e-(t||0),0)}getMetricsPayload(){return{itemsDiscardedByRetry:this.itemsDiscardedByRetry,eventCount:this.eventCount,itemsDiscardedByOverflow:this.itemsDiscardedByOverflow,resilienceMechanism:this.resilienceMechanism,localstorageQueuesPurged:this.localstorageNumberOfQueuesPurged,fullReclaims:this.localstorageNumberOfFullReclaims,partialReclaims:this.localstorageNumberOfPartialReclaims,failedReclaims:this.localstorageNumberOfFailedReclaims}}}let tc=null,tl=()=>(tc||(tc=new ta),tc);class tu{constructor(e){this._networkChangeCallback=e,"u">typeof window&&(window.addEventListener("offline",()=>this._networkChangeCallback(to.OFFLINE)),window.addEventListener("online",()=>this._networkChangeCallback(to.ONLINE)))}removeListeners(){"u">typeof window&&(window.addEventListener("offline",()=>this._networkChangeCallback(to.OFFLINE)),window.addEventListener("online",()=>this._networkChangeCallback(to.ONLINE)))}getNetworkStatus(){return window.navigator.onLine?to.ONLINE:to.OFFLINE}}let th=((h={}).IDLE="idle",h.RUNNING="running",h.COMPLETED="completed",h.TIMED_OUT="timedOut",h),td=((d={}).EXECUTE="execute",d.COMPLETE="complete",d.TIMEOUT="timeout",d);class tf{constructor(e){if((0,E.A)(this,"timeoutHandle",void 0),(0,E.A)(this,"callbackStatus",th.IDLE),e>0){this.timeoutPeriod=e;return}throw Error("CallbackWithTimeout requires timeout period higher than 0")}transitionCallbackStatus(e,t){switch(e){case th.IDLE:case th.TIMED_OUT:case th.COMPLETED:t===td.EXECUTE&&(this.callbackStatus=th.RUNNING);break;case th.RUNNING:switch(t){case td.COMPLETE:this.callbackStatus=th.COMPLETED;break;case td.TIMEOUT:this.callbackStatus=th.TIMED_OUT}break;default:this.callbackStatus=e}}executeCallbackWithTimeout(e,t,r){typeof window>"u"||(this.transitionCallbackStatus(this.callbackStatus,td.EXECUTE),this.timeoutHandle=window.setTimeout(()=>{this.transitionCallbackStatus(this.callbackStatus,td.TIMEOUT),r()},this.timeoutPeriod),e(e=>{this.cancelTimeout(),this.getCallbackStatus()!==th.TIMED_OUT&&(this.transitionCallbackStatus(this.callbackStatus,td.COMPLETE),t(e))}))}getCallbackStatus(){return this.callbackStatus}cancelTimeout(){"u">typeof window&&this.timeoutPeriod>0&&this.timeoutHandle&&(window.clearTimeout(this.timeoutHandle),this.timeoutHandle=void 0)}}let tp=((f={})[f.NOOP=0]="NOOP",f[f.SUCCESS=1]="SUCCESS",f[f.ERROR=2]="ERROR",f),tm={minRetryDelay:1e3,maxRetryDelay:3e4,backoffFactor:2,backoffJitterPercentage:0,waitInterval:500,callbackTimeoutPeriod:5e3},ty=((p={})[p.NONE=0]="NONE",p[p.IMMEDIATE=1]="IMMEDIATE",p[p.WAIT=2]="WAIT",p);class tg{constructor(e,t){(0,E.A)(this,"schedule",({immediate:e}={})=>{typeof window>"u"||(this.operationInFlight?e?this.queuedSchedule=ty.IMMEDIATE:this.queuedSchedule!==ty.IMMEDIATE&&(this.queuedSchedule=ty.WAIT):(e||this.options.waitInterval<=0)&&0===this.failureCount?(this.clearTimeout(),this.run()):this.failureCount>0&&null===this.scheduledTimeout?this.scheduledTimeout=window.setTimeout(this.run,this.calculateBackoff()):null===this.scheduledTimeout&&(this.scheduledTimeout=window.setTimeout(this.run,this.options.waitInterval)))}),(0,E.A)(this,"stop",()=>{this.clearTimeout(),this.queuedSchedule=ty.NONE}),(0,E.A)(this,"getFailureCount",()=>this.failureCount),(0,E.A)(this,"getCallbackStatus",()=>this.callbackTimer.getCallbackStatus()),(0,E.A)(this,"clearTimeout",()=>{"u">typeof window&&null!==this.scheduledTimeout&&(window.clearTimeout(this.scheduledTimeout),this.scheduledTimeout=null)}),(0,E.A)(this,"run",()=>{this.operationInFlight=!0,this.clearTimeout();try{this.callbackTimer.executeCallbackWithTimeout(this.callback,this.done,()=>this.done(tp.ERROR))}catch(e){this.done(e)}}),(0,E.A)(this,"done",e=>{this.operationInFlight=!1,e===tp.ERROR||this.callbackTimer.getCallbackStatus()===th.TIMED_OUT?(this.failureCount++,this.clearTimeout()):e===tp.SUCCESS&&(this.failureCount=0),this.processQueuedSchedule()}),(0,E.A)(this,"processQueuedSchedule",()=>{if(this.queuedSchedule!==ty.NONE){let e=this.queuedSchedule===ty.IMMEDIATE;this.queuedSchedule=ty.NONE,this.schedule({immediate:e})}else this.failureCount>0&&this.schedule()}),(0,E.A)(this,"calculateBackoff",()=>{let{minRetryDelay:e,maxRetryDelay:t,backoffFactor:r,backoffJitterPercentage:s}=this.options,i=e*r**this.failureCount;if(s){let e=Math.random(),t=Math.floor(e*s*i);5>Math.floor(10*e)?i-=t:i+=t}return Number(Math.min(i,t).toPrecision(1))}),this.options={minRetryDelay:e.minRetryDelay||tm.minRetryDelay,maxRetryDelay:e.maxRetryDelay||tm.maxRetryDelay,backoffFactor:e.backoffFactor||tm.backoffFactor,backoffJitterPercentage:e.backoffJitterPercentage||tm.backoffJitterPercentage,waitInterval:void 0!==e.waitInterval?e.waitInterval:tm.waitInterval,callbackTimeoutPeriod:e.callbackTimeoutPeriod||tm.callbackTimeoutPeriod},this.scheduledTimeout=null,this.failureCount=0,this.callback=t,this.operationInFlight=!1,this.queuedSchedule=ty.NONE,this.callbackTimer=new tf(this.options.callbackTimeoutPeriod)}}function tb(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function tv(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?tb(Object(r),!0).forEach(function(t){(0,E.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tb(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let tI={backoffFactor:0,backoffJitterPercentage:0,flushWaitMs:6e4,minRetryDelay:6e4,maxRetryDelay:6e4},tE={backoffFactor:2,backoffJitterPercentage:.2,batchFlushSize:7,flushBeforeUnload:!1,flushWaitMs:500,maxAttempts:10,maxItems:1e3,maxRetryDelay:3e4,minRetryDelay:1e3};class tw{constructor(e,t,r,s){this.queuePrefix=e,this.resilience=new ti(t,{logger:s,maxAttempts:r?.maxAttempts,maxEventLimit:r?.maxItems}),this.options=this.buildOptions(r),this.scheduler=new tg(tv(tv({},this.options),{},{waitInterval:null!=r&&r.flushBeforeUnload?0:this.options.flushWaitMs}),this.scheduleCallback.bind(this)),this.longPollingScheduler=new tg(tv(tv({},tI),{},{waitInterval:tI.flushWaitMs}),this.scheduleLongCallBack.bind(this)),this.metricsCollector=tl(),this.networkStatus=new tu(e=>{e===to.OFFLINE?this.scheduler.stop():this.checkEventCountAndReschedule()})}start(e){this.batchFlushCallback=e,this.longPollingScheduler.schedule()}stop(){this.scheduler.stop(),this.longPollingScheduler.stop()}async addItem(e){let t=JSON.parse(JSON.stringify(e)),{numberOfEvictedItems:r}=await this.resilience.addItem(t,{},eB.EVICT);this.scheduler.schedule(),this.metricsCollector.addToEventCount(),r>0&&this.metricsCollector.addToItemsDiscardedByOverflowCounter(r)}getGlobalRetryCount(){return this.scheduler.getFailureCount()}async scheduleCallback(e){if(this.networkStatus.getNetworkStatus()===to.OFFLINE){e(tp.NOOP);return}try{let t=await this.resilience.processItems(this.flush.bind(this),this.options.batchFlushSize);e(t)}catch(t){if(t.name===eW){e(tp.ERROR);return}}finally{await this.checkEventCountAndReschedule()}}async checkEventCountAndReschedule(){let e=await this.resilience.getItemCount();e>0&&this.scheduler.schedule({immediate:e>=this.options.batchFlushSize})}async scheduleLongCallBack(e){let t=eO(this.queuePrefix);this.metricsCollector.addToPurgedQueuesMetrics(t);let r=await ej(this.queuePrefix,async e=>{let t=e.map(e=>({item:e.item,retryAttempts:e.attemptNumber,id:e.id})),{items:r}=await this.resilience.bulkAddItem(t,eB.IGNORE);return r.length===t.length?{status:"successful"}:{status:"partial",acceptedItemIds:r.map(e=>e.id)}});this.metricsCollector.addToReclaimMetrics(r),await this.checkEventCountAndReschedule(),e(tp.SUCCESS),this.longPollingScheduler.schedule()}flush(e,t){this.metricsCollector.setResilienceMechanism(this.resilience.storeType());let{batchFlushCallback:r}=this;if(!r)throw Error("batchFlushCallback has not been set. Call PullBatchableQueue#start first.");return new Promise((s,i)=>{if(e.length<=0){s(tp.NOOP);return}let n=e.map(e=>{let t=e.item;return e.retryAttempts>0&&t.msg&&(t.msg._metadata||(t.msg._metadata={}),t.msg._metadata.failedAttempts=e.retryAttempts),t});r(n,e=>{e?(t.numberOfDeletedItems>0&&this.metricsCollector.addToItemsDiscardedByRetryCounter(t.numberOfDeletedItems),i(e)):s(tp.SUCCESS)})})}buildOptions(e){return{backoffFactor:e?.backoffFactor||tE.backoffFactor,backoffJitterPercentage:e?.backoffJitterPercentage!==void 0?e.backoffJitterPercentage:tE.backoffJitterPercentage,batchFlushSize:e?.batchFlushSize||tE.batchFlushSize,flushBeforeUnload:e?.flushBeforeUnload||tE.flushBeforeUnload,flushWaitMs:e?.flushWaitMs||tE.flushWaitMs,maxItems:e?.maxItems||tE.maxItems,maxAttempts:e?.maxAttempts||tE.maxAttempts,maxRetryDelay:e?.maxRetryDelay||tE.maxRetryDelay,minRetryDelay:e?.minRetryDelay||tE.minRetryDelay}}}let t_=(e,t,r,s)=>new tw(e,t,r||{},s),tA=((m={}).IDENTIFY="identify",m.PAGE="page",m.TRACK="track",m);(y={}).XC="xc",y.UID="uid",(g={}).NEW="NEW",g.CHANGED="CHANGED",g.EXISTING="EXISTING",g.TIMEOUT="TIMEOUT",g.ERROR="ERROR",g.UNAVAILABLE="UNAVAILABLE",g.MALFORMED="MALFORMED",g.UNKNOWN="UNKNOWN";class tO{constructor(e,t){this.props=e,this.url=t}static fromJson(e){var t;let r="string"==typeof(t=e?.url)||t instanceof String?e.url.trim():"";return new tO(e?.props||null,r.startsWith("http")?r:null)}}class tS extends Error{constructor(e,t,r){super(e),this.statusCode=t,this.statusText=r}}let tT=["FetchError","AbortError","TypeError"];function tP(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function tC(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?tP(Object(r),!0).forEach(function(t){(0,E.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tP(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}async function tk(e,t){try{let r=await t;return e.map(e=>(function(e,t){if(!(t&&t instanceof Function))return e;if(e.msg.type===tA.PAGE||e.msg.type===tA.TRACK){let r=t();r&&Array.isArray(r)&&(e.msg.properties=tC(tC({},e.msg.properties),{},{xid:r}))}else if(e.msg.traits&&e.msg.type===tA.IDENTIFY){let r=t();r&&Array.isArray(r)&&(e.msg.traits=tC(tC({},e.msg.traits),{},{xid:r}))}return e})(e,r))}catch{return e}}let tD=new Map([[200,"OK"],[400,"Bad Request"],[401,"Unauthorized"],[402,"Payment Required"],[403,"Forbidden"],[404,"Not Found"],[405,"Method Not Allowed"],[406,"Not Acceptable"],[407,"Proxy Authentication Required"],[408,"Request Timeout"],[409,"Conflict"],[410,"Gone"],[411,"Length Required"],[412,"Precondition Failed"],[413,"Payload Too Large"],[414,"URI Too Long"],[415,"Unsupported Media Type"],[416,"Requested range not satisfiable"],[417,"Expectation Failed"],[418,"I'm a teapot"],[422,"Unprocessable Entity"],[423,"Locked"],[424,"Failed Dependency"],[425,"Too Early"],[426,"Upgrade Required"],[428,"Precondition Required"],[429,"Too Many Requests"],[431,"Request Header Fields Too Large"],[451,"Unavailable For Legal Reasons"],[500,"Internal Server Error"],[501,"Not Implemented"],[502,"Bad Gateway"],[503,"Service Unavailable"],[504,"Gateway Timeout"],[505,"HTTP Version not supported"],[506,"Variant Also Negotiates"],[507,"Insufficient Storage"],[508,"Loop Detected"],[509,"Bandwidth Limit Exceeded"],[510,"Not Extended"],[511,"Network Authentication Required"],[-1,"Unknown Status"]]);var tR=r(11771);function tj(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}let tN=async e=>{var t;let r=null===(t=tx(e))||void 0===t?void 0:t.signal,s=tL(e.url),i=await fetch(e.url,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?tj(Object(r),!0).forEach(function(t){(0,E.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tj(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({method:"POST",headers:{"Content-Type":"text/plain"},body:JSON.stringify(e.batch),signal:r},s));if(429===i.status||i.status>=500&&i.status<600)throw new tS(`HTTP Error ${i.status} (${i.statusText})`,i.status,i.statusText);return i},tx=e=>{if(e.abortController)return e.abortController;if(e.timeout){let t=new AbortController;return setTimeout(()=>{t.abort()},e.timeout),t}},tL=(0,tR.A)(e=>new URL(e).origin===location.origin?{}:{mode:"cors",credentials:"include"});var tM=r(67793),tF=r(43363),tU=r.n(tF);let tB=((b={}).AWC_TLD_TEST="AWC_TLD_TEST",b.AWC_ANALYTICS_DEBUG="AWC_ANALYTICS_DEBUG",b.AJS_ANONYMOUS_ID="AJS_ANONYMOUS_ID",b);class t${constructor(e,t){this.key=e,this.options=t}getAttributes(){return this.options}getKey(){return this.key}}let tH=()=>{try{return window&&window.location&&"https:"===window.location.protocol}catch{return!1}},tK={[tB.AWC_TLD_TEST]:new t$("__awc_tld_test__",{expires:365,secure:tH(),path:"/"}),[tB.AWC_ANALYTICS_DEBUG]:new t$("atlassian_analytics_debug",{expires:365,secure:tH(),path:"/"}),[tB.AJS_ANONYMOUS_ID]:new t$("ajs_anonymous_id",{expires:365,secure:tH(),path:"/"})},tW=new class{constructor(){(0,E.A)(this,"_data",{}),(0,E.A)(this,"length",0),(0,E.A)(this,"setItem",(e,t)=>(this._data[e]=t,this.length=Object.keys(this._data).length,t)),(0,E.A)(this,"getItem",e=>e in this._data?this._data[e]:null),(0,E.A)(this,"removeItem",e=>(e in this._data&&delete this._data[e],this.length=Object.keys(this._data).length,null)),(0,E.A)(this,"clear",()=>{this._data={},this.length=0}),(0,E.A)(this,"key",e=>Object.keys(this._data)[e])}},tG="awcInMemoryStorageFallback";function tV(e){let t="test_value";if(!e)return!1;try{let r="awc.storage.support";e.setItem(r,t);let s=e.getItem(r);return e.removeItem(r),s===t}catch{return!1}}class tq{constructor(e,t={}){(0,E.A)(this,"getStore",()=>this._store),(0,E.A)(this,"getItem",e=>this._store.getItem(this.createKey(e))),(0,E.A)(this,"removeItem",e=>this._store.removeItem(this.createKey(e))),(0,E.A)(this,"setItem",(e,t)=>{try{this._store.setItem(this.createKey(e),t)}catch(r){(function(e){let t=!1;if(e.code)switch(e.code){case 22:t=!0;break;case 1014:"NS_ERROR_DOM_QUOTA_REACHED"===e.name&&(t=!0)}else -2147024882===e.number&&(t=!0);return t})(r)&&(this.swapToInMemory(),this._store.setItem(this.createKey(e),t))}}),(0,E.A)(this,"swapToInMemory",()=>{let e;if(this._store===tW||typeof window>"u")return;let t=Object.keys(this._store||{});tV(window[tG])?e=window[tG]:(e=tW,window[tG]||(window[tG]=tW)),t.forEach(t=>{if(0===t.indexOf(this.getPrefix())){let r=this._store.getItem(t);r&&e.setItem(t,r)}}),this._store=e}),(0,E.A)(this,"clear",()=>this._store.clear()),(0,E.A)(this,"key",e=>this._store.key(e)),(0,E.A)(this,"getPrefix",()=>this._prefix),(0,E.A)(this,"createKey",e=>this._prefix?`${this.getPrefix()}.${e}`:e),this.options=t;let r=[];(void 0===t.useStoragePrefix||t.useStoragePrefix)&&r.push("awc"),t.envPrefix&&t.envPrefix!==A.sR.PROD&&r.push(t.envPrefix),this._prefix=r.join("-"),tV(e)?this._store=e:this.swapToInMemory()}}let tQ=class extends tq{constructor(e){let t;try{t=window.localStorage||tW}catch{t=tW}super(t,e)}};class tJ{constructor(){this.safeStorage=new tQ({useStoragePrefix:!1})}set(e,t){return this.safeStorage.setItem(e,t),t}get(e){return this.safeStorage.getItem(e)||void 0}remove(e){this.safeStorage.removeItem(e)}}let tY=(e=!1)=>!e&&!("file:"===location.protocol||"chrome-extension:"===location.protocol),tX=tK.AWC_TLD_TEST.getKey(),tz="tld_test",tZ=(0,tR.A)(()=>{if(typeof location>"u")return"";let{hostname:e}=location,t=e.split(".");for(let e=1;e<=t.length;e++){let r=`.${t.slice(-1*e).join(".")}`;if(tU().set(tX,tz,{domain:r}),tU().get(tX)===tz)return tU().remove(tX,{domain:r}),r}return e});var t0=r(68731);function t1(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function t4(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?t1(Object(r),!0).forEach(function(t){(0,E.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):t1(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}class t2{constructor(e){this.cookieLike=tY(e)?tU():new tJ}set(e,t,r){if(!tK[e]){t0.warn(`Unknown cookie key ${e} provided, not set.`);return}return this.cookieLike.set(tK[e].getKey(),t,t4(t4({},tK[e].getAttributes()),{},{domain:tZ()},r))}get(e){if(!tK[e]){t0.warn(`Unknown cookie key ${e} provided, not fetched.`);return}return this.cookieLike.get(tK[e].getKey())}remove(e,t){if(!tK[e]){t0.warn(`Unknown cookie key ${e} provided, not removed.`);return}this.cookieLike.remove(tK[e].getKey(),t4({},t))}}let t3="SAFE",t5="UNSAFE",t6="LOCAL_STORAGE";class t7{constructor(e){this.store=new tQ({useStoragePrefix:!1}),this.cookie=new t2(e)}getUserId(){return this.userId||null}setUserId(e){this.userId=e}getAnonymousId(e){return this.getAnonymousIdFromLocalStorageAndUpdateCookieIfStale()||this.getAnonymousIdFromCookieAndUpdateLocalStorage()||this.generateNewAnonymousId(e)}setAnonymousId(e){let t=JSON.stringify(e);return this.cookie.set(tB.AJS_ANONYMOUS_ID,t),this.lastAnonymousIdCookieUpdate=Date.now(),this.store.setItem(tK.AJS_ANONYMOUS_ID.getKey(),t)}getAnonymousIdFromStorage(e){let t=e===t6?this.store.getItem(tK.AJS_ANONYMOUS_ID.getKey()):this.cookie.get(tB.AJS_ANONYMOUS_ID);if(t){let e={type:t5,anonymousId:t};try{let r=JSON.parse(t);return r&&"string"==typeof r?{type:t3,anonymousId:r}:e}catch{return e}}return{type:"NOT_FOUND"}}getAnonymousIdFromLocalStorageAndUpdateCookieIfStale(){let e=this.getAnonymousIdFromStorage(t6),t=!1;switch((!this.lastAnonymousIdCookieUpdate||(0,tM.A)(new Date,new Date(this.lastAnonymousIdCookieUpdate))>=7)&&(t=!0),e.type){case t3:return t&&this.setAnonymousId(e.anonymousId),e.anonymousId;case t5:return e.anonymousId;default:return null}}getAnonymousIdFromCookieAndUpdateLocalStorage(){let e=this.getAnonymousIdFromStorage("COOKIE");switch(e.type){case t3:case t5:return this.store.setItem(tK.AJS_ANONYMOUS_ID.getKey(),JSON.stringify(e.anonymousId)),e.anonymousId;default:return null}}generateNewAnonymousId(e=_()){let t=e();return this.setAnonymousId(t),t}}var t8=r(85651),t9=r.n(t8);function re(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function rt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?re(Object(r),!0).forEach(function(t){(0,E.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):re(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let rr=e=>rt(rt({},e.context),{},{userAgent:navigator.userAgent}),rs=e=>{let t=ri(e);return t9()(t)},ri=e=>{if(null===e||"object"!=typeof e)return e;let t={};return Object.keys(e).forEach(r=>{let s=rn(e,r);void 0!==s&&(Array.isArray(s)?t[r]=s.map(e=>ri(e)):"object"==typeof s&&null!==s?t[r]=ri(s):t[r]=s)}),t},rn=(e,t)=>e[t];var ro=r(68731);function ra(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function rc(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ra(Object(r),!0).forEach(function(t){(0,E.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ra(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}class rl{constructor(e,t,r,s,i){this.success=e,this.validationErrors=t,this.message=r,this.code=s,this.validationReports=i}isSuccess(){return this.success}getValidationErrors(){return this.validationErrors}getMessage(){return this.message}getCode(){return this.code}getValidationReports(){return void 0===this.validationReports?null:this.validationReports}}class ru{constructor(e){this.error=e}}class rh{constructor(e,t,r,s){this.success=e,this.statusCode=t,this.message=r,this.eventResponseList=s}isSuccess(){return this.success}getStatusCode(){return this.statusCode}getMessage(){return this.message}getEventResponseList(){return this.eventResponseList}}class rd{constructor(e,t,r){this.messageId=e,this.results=t,this.segmentEvent=r}getMessageId(){return this.messageId}getResults(){return this.results}getSegmentEvent(){return this.segmentEvent}}class rf{constructor(e){var t;(0,E.A)(this,"sendEvents",async(e,t)=>{var r;if(!1===this.options.enableEventCalls)return;let s=this.resilienceQueue.getGlobalRetryCount(),i=this.metrics.getMetricsPayload(),n=await this.attachXIDs(e),o=new Date().toISOString(),a=await this.metadataClient.getMetadataAsync(),c=null!=a&&a.url?a.url:this.gasv3BatchUrl,l=this.useUrlFromMetadata?c:this.gasv3BatchUrl,u=c===this.gasv3BatchUrl?null:l!==c,h=rc(rc({},i),{},{httpRetryCount:s,lastSendEventsErrorReason:this.sendEventsLastErrorReason,isUsingFallbackUrl:u,props:a?.props||null,metadataClientMetrics:(null===(r=this.metadataClient)||void 0===r?void 0:r.metrics)||null});this.cleanLibraryMetadata(h);let d={batch:n.map(e=>(e.msg.sentAt=o,e.msg)),sentAt:o,metadata:h};try{this.sendEventsLastErrorReason=null;let r=await tN({url:l,batch:d,timeout:this.options.requestTimeout});this.metrics.subtractFromMetrics(i),t(null,r),await this.invokeLocalResponseCallbackAsync(e,r,null)}catch(r){r instanceof tS&&[429,503].includes(r.statusCode)?this.sendEventsLastErrorReason="ServerBusyError":(this.useUrlFromMetadata=!1,this.sendEventsLastErrorReason=r instanceof Error&&tT.includes(r.name)?r.name:"Unknown"),t(r,null),await this.invokeLocalResponseCallbackAsync(e,null,r)}}),this.options=rc(rc({},e),{},{requestTimeout:e.requestTimeout||1e4,retryQueueOptions:e.retryQueueOptions||{},logger:e.logger||ro,disableCookiePersistence:e.disableCookiePersistence||!1,env:e.env,perimeter:e.perimeter||"",enableMetadataCalls:"boolean"!=typeof e.enableMetadataCalls||e.enableMetadataCalls,enableEventCalls:"boolean"!=typeof e.enableEventCalls||e.enableEventCalls}),this.user=new t7(null===(t=this.options)||void 0===t?void 0:t.disableCookiePersistence),this.xidPromiseCallback=e.xidPromiseGetter(),this.gasv3BatchUrl=`${e.apiHostProtocol}://${e.apiHost}/batch`,this.metrics=tl(),this.responseCallback=e.responseCallback,this.resilienceQueue=t_(e.retryQueuePrefix,e.product,this.options.retryQueueOptions,this.options.logger),this.metadataClient=e.metadataClient,this.useUrlFromMetadata=!0,this.sendEventsLastErrorReason=null,setInterval(()=>{this.useUrlFromMetadata=!0},6e5),this.resilienceQueue.start(this.sendEvents)}getUser(){return this.user}async track(e,t,r,s){let i=this.buildBaseEvent(r,tA.TRACK,t),n=rc(rc({},i),{},{type:tA.TRACK,properties:rs(t),event:e}),o=rc(rc({},n),{},{messageId:this.createMessageId()}),a=this.packageEvent(o);await this.enqueueEvent(a),s&&s()}async page(e,t,r,s){let i=this.buildBaseEvent(r,tA.PAGE,t),n=rc(rc({},i),{},{type:tA.PAGE,properties:rs(t),name:e}),o=rc(rc({},n),{},{messageId:this.createMessageId()}),a=this.packageEvent(o);await this.enqueueEvent(a),s&&s()}async identify(e,t,r,s){let i=this.buildBaseEvent(r,tA.IDENTIFY,t),n=rc(rc({},i),{},{type:tA.IDENTIFY,traits:rs(t)}),o=rc(rc({},n),{},{messageId:this.createMessageId()}),a=this.packageEvent(o);await this.enqueueEvent(a),s&&s()}async enqueueEvent(e){this.options.enableMetadataCalls&&this.metadataClient.start(!1),await this.resilienceQueue.addItem(e)}buildBaseEvent(e,t,r){let s=rs(e);return{context:rr(s),timestamp:new Date().toISOString(),type:t,userId:this.user.getUserId(),anonymousId:r.anonymousId||this.user.getAnonymousId()}}createMessageId(){return`ajs-${_()()}`}packageEvent(e){let{apiHost:t,apiHostProtocol:r}=this.options;return{headers:{"Content-Type":"text/plain"},msg:e,url:`${r}://${t}/${e.type.charAt(0)}`}}cleanLibraryMetadata(e){if(!(null===e||"object"!=typeof e))for(let t in e){let r=e[t];null==r||"number"==typeof r&&0===r?delete e[t]:Array.isArray(r)?0===r.length?delete e[t]:r.forEach(e=>{this.cleanLibraryMetadata(e)}):"object"==typeof r&&this.cleanLibraryMetadata(e[t])}}async invokeLocalResponseCallbackAsync(e,t,r){let s=this.responseCallback;if(s){let n=null;if(t){var i;let e;try{e=await t.clone().json()}catch{}(e=e||{}).code=Number.parseInt(e.code)>0?Number.parseInt(e.code):t.status,e.success=e.success||e.code>=200&&e.code<=299,n=new rl(e.success,e.validationErrors||new Map,new ru((null===(i=e.message)||void 0===i?void 0:i.error)||""),e.code,e.validationReports||null)}!r||r instanceof Error||(r=Error(String(r)));let o=rp.toAnalyticsResponse(e||[],r||null,n);s(o)}}async attachXIDs(e){return this.xidPromiseCallback?tk(e,this.xidPromiseCallback):Promise.resolve(e)}setResponseCallback(e){this.responseCallback=e}refreshMetadata(e,t){this.metadataClient.userInfo=e,this.metadataClient.tenantInfo=t}}class rp{static toAnalyticsResponse(e,t,r){let s=[];if(null!==r){var i,n;let[t,o]=[r.code,r.success];if(t>=200&&t<=299)return null===(i=r.validationReports)||void 0===i||i.forEach(t=>{let r=e.find(e=>e.msg.messageId===t.messageId);r&&s.push(new rd(r.msg.messageId,t.results,r.msg))}),new rh(o,t,tD.get(t),s);if(t>=400&&t<=499){let i=(null===(n=r.message)||void 0===n?void 0:n.error)!==null?r.message.error:tD.has(t)?tD.get(t):tD.get(-1);return e.forEach(e=>{s.push(new rd(e.msg.messageId,[],e.msg))}),new rh(o,t,i,s)}}else if(null!=t&&t.message){let r=t.message.match(rp.http_error_regex);if(r)return e.forEach(e=>{s.push(new rd(e.msg.messageId,[],e.msg))}),new rh(!1,Number(r[1]),r[2],s)}return e.forEach(e=>{s.push(new rd(e.msg.messageId,[],e.msg))}),new rh(!1,-1,tD.get(-1),s)}}(0,E.A)(rp,"http_error_regex",/HTTP Error\s([0-9]{3})\s\((.+)\)/);let rm="/gateway/api/gasv3/api/v1",ry=()=>"as.staging.atl-paas-us-gov-mod.net/api/v1",rg=()=>"api.stg.atlassian-us-gov-mod.com/gasv3/api/v1",rb=({useStargate:e,env:t,useLegacyUrl:r,envOverride:s})=>{if(t===A.sR.LOCAL||t===A.sR.DEV)throw Error("No LOCAL or DEV environments for FedRAMP.");if(t===A.sR.PROD&&s)throw Error("Cannot override to FedRAMP Sandbox for Prod.");return e?r?t===A.sR.PROD?"api.atlassian-us-gov-mod.com/gasv3/api/v1":rg():window.location.host+rm:t===A.sR.PROD?"as.atlassian-us-gov-mod.com/api/v1":ry()},rv=({useStargate:e,env:t,useLegacyUrl:r})=>e?r?t===A.sR.PROD?"api-private.atlassian.com/gasv3/api/v1":"api-private.stg.atlassian.com/gasv3/api/v1":window.location.host+rm:t===A.sR.PROD?"as.atlassian.com/api/v1":"as.staging.atl-paas.net/api/v1";class rI{static isGeminiVREnvironment(){try{for(let e in r.g)if(e.startsWith("__gemini_")&&e.endsWith("__"))return!0}catch{}return!1}static areMetadataCallsDisabled(){return this.areFetchCallsDisabled()||this.getGlobalBooleanProperty(rI.DISABLE_METADATA_CALLS_PROPERTY)}static areEventCallsDisabled(){return this.areFetchCallsDisabled()||this.getGlobalBooleanProperty(rI.DISABLE_EVENT_CALLS_PROPERTY)}static areFetchCallsDisabled(){return this.getGlobalBooleanProperty(rI.DISABLE_FETCH_CALLS_PROPERTY)}static getGlobalBooleanProperty(e){return!!(r.g&&r.g.hasOwnProperty(e))&&!0===r.g[e]}}function rE(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}(0,E.A)(rI,"DISABLE_METADATA_CALLS_PROPERTY","__awc_disable_metadata_calls__"),(0,E.A)(rI,"DISABLE_EVENT_CALLS_PROPERTY","__awc_disable_event_calls__"),(0,E.A)(rI,"DISABLE_FETCH_CALLS_PROPERTY","__awc_disable_fetch_calls__");let rw=async(e,t,r,s)=>{var i,n,o,a;let c=r_(r,s),l=rA(e),u=e+"?"+new URLSearchParams({product:`${t.product}`,userId:`${(null===(i=t.userInfo)||void 0===i?void 0:i.userId)||""}`,userIdType:`${(null===(n=t.userInfo)||void 0===n?void 0:n.userIdType)||""}`,tenantId:`${(null===(o=t.tenantInfo)||void 0===o?void 0:o.tenantId)||""}`,tenantIdType:`${(null===(a=t.tenantInfo)||void 0===a?void 0:a.tenantIdType)||""}`}).toString(),h=await fetch(u,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?rE(Object(r),!0).forEach(function(t){(0,E.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rE(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({method:"GET",signal:c.signal},l));if(200!==h.status)throw new tS(`Metadata: HTTP Error ${h.status} (${h.statusText})`,h.status,h.statusText);return h},r_=(e,t)=>{let r=new AbortController;return setTimeout(()=>{r.abort()},e||3e4),t?.addEventListener("abort",()=>{r.abort()}),r},rA=(0,tR.A)(e=>new URL(e).origin===location.origin?{}:{mode:"cors",credentials:"include"});function rO(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function rS(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?rO(Object(r),!0).forEach(function(t){(0,E.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rO(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}class rT{constructor(e,t,r){this._userInfo={anonymousId:""},this._tenantInfo={},this._url=`${e}://${t}/metadata`,this._product=r,this._metadataInfo=null,this._requestStatus="PENDING",this._lastFetchRequestCount=0,this._lastErrorReason=null,this._fetchAbortController=null,this._hasBeenStopped=!1,this._isEnabled=!1,this._propertyChangeRefreshTimeout=null;let s=function({apiHost:e}){return e===window.location.host+rm}({apiHost:t});this._metadataHost=s?"PRODUCT_HOST":t,this._options=this.buildOptions({backoffFactor:2,backoffJitterPercentage:.2,batchFlushSize:7,flushBeforeUnload:!1,flushWaitMs:500,maxAttempts:10,maxItems:1e3,maxRetryDelay:3e4,minRetryDelay:1e3}),this._scheduler=new tg(rS(rS({},this._options),{},{waitInterval:6e5}),this.scheduleCallback.bind(this)),this._networkStatus=null}start(e){this._isEnabled||this._hasBeenStopped&&!e||(this._isEnabled=!0,this.startNetworkStatusMonitor(),setTimeout(()=>{this._scheduler.schedule({immediate:!0})},rT.INITIAL_REFRESH_DELAY))}stop(){var e;this._isEnabled&&(this._hasBeenStopped=!0,this._isEnabled=!1,this.stopNetworkStatusMonitor(),this._scheduler.stop(),null===(e=this._fetchAbortController)||void 0===e||e.abort(),this.resetPropertyChangeRefresh())}startNetworkStatusMonitor(){this._networkStatus||(this._networkStatus=new tu(e=>{e===to.OFFLINE?this._scheduler.stop():this._isEnabled&&this._scheduler.schedule({immediate:null===this._metadataInfo})}))}stopNetworkStatusMonitor(){this._networkStatus&&(this._networkStatus.removeListeners(),this._networkStatus=null)}async refreshMetadataAsync(){var e;if(rI.areFetchCallsDisabled()||!this._isEnabled)return Promise.resolve();null===(e=this._fetchAbortController)||void 0===e||e.abort(),this._fetchAbortController=new AbortController;let t=this._fetchAbortController.signal;this._lastFetchRequestCount=this._scheduler.getFailureCount(),await rw(this._url,{product:this._product,userInfo:this._userInfo,tenantInfo:this._tenantInfo},6e4,t).then(async e=>{let t=await e.json();this._metadataInfo=tO.fromJson(t),this._lastFetchRequestCount++,this._requestStatus="FETCHED",this._lastErrorReason=null}).catch(e=>{if(!t.aborted)throw this._requestStatus="FAILED",e instanceof tS&&[429,503].includes(e.statusCode)?this._lastErrorReason="ServerBusyError":this._lastErrorReason=e instanceof Error&&tT.includes(e.name)?e.name:"Unknown",e})}getMetadataAsync(){return Promise.resolve(this._metadataInfo)}get status(){return this._requestStatus}get lastErrorReason(){return this._lastErrorReason}get lastFetchRequestCount(){return this._lastFetchRequestCount}get userInfo(){return this._userInfo}set userInfo(e){var t,r;(null===(t=this._userInfo)||void 0===t?void 0:t.userId)===e?.userId&&(null===(r=this._userInfo)||void 0===r?void 0:r.userIdType)===e?.userIdType||(this._userInfo=e,this.schedulePropertyChangeRefresh())}get tenantInfo(){return this._tenantInfo}set tenantInfo(e){var t,r;(null===(t=this._tenantInfo)||void 0===t?void 0:t.tenantId)===e?.tenantId&&(null===(r=this._tenantInfo)||void 0===r?void 0:r.tenantIdType)===e?.tenantIdType||(this._tenantInfo=e,this.schedulePropertyChangeRefresh())}get metrics(){return{host:this._metadataHost,status:this.status,lastErrorReason:this.lastErrorReason,lastRefreshRequestCount:this.lastFetchRequestCount}}async scheduleCallback(e){var t;if((null===(t=this._networkStatus)||void 0===t?void 0:t.getNetworkStatus())===to.OFFLINE){e(tp.NOOP);return}try{await this.refreshMetadataAsync(),e(tp.SUCCESS),this._scheduler.schedule()}catch{e(tp.ERROR)}}schedulePropertyChangeRefresh(){this._isEnabled&&(this.resetPropertyChangeRefresh(),this._propertyChangeRefreshTimeout=setTimeout(()=>{this.resetPropertyChangeRefresh(),this._scheduler.schedule({immediate:!0})},10))}resetPropertyChangeRefresh(){this._propertyChangeRefreshTimeout&&(clearTimeout(this._propertyChangeRefreshTimeout),this._propertyChangeRefreshTimeout=null)}buildOptions(e){return{backoffFactor:e?.backoffFactor||tE.backoffFactor,backoffJitterPercentage:e?.backoffJitterPercentage!==void 0?e.backoffJitterPercentage:tE.backoffJitterPercentage,batchFlushSize:e?.batchFlushSize||tE.batchFlushSize,flushBeforeUnload:e?.flushBeforeUnload||tE.flushBeforeUnload,flushWaitMs:e?.flushWaitMs||tE.flushWaitMs,maxItems:e?.maxItems||tE.maxItems,maxAttempts:e?.maxAttempts||tE.maxAttempts,maxRetryDelay:e?.maxRetryDelay||tE.maxRetryDelay,minRetryDelay:e?.minRetryDelay||tE.minRetryDelay}}}(0,E.A)(rT,"INITIAL_REFRESH_DELAY",1),(0,E.A)(rT,"Factory",(e,t,r)=>new rT(e,t,r));var rP=r(42433);let rC=e=>window.history.replaceState({},"",e),rk=(e,t=rC)=>{let r=window.location.href,s=window.location.hash,i=""!==s?r.replace(s,""):r,{url:n,query:o}=(0,rP.parseUrl)(i),a=en(o,e);if(Object.keys(a).length>0){let r=ei(o,e);if(Object.keys(r).length>0){let e=`${n}?${(0,rP.stringify)(r)}${s}`;t(e)}else t(`${n}${s}`)}return a};class rD{constructor(){(0,E.A)(this,"handleOriginParameters",(e,t)=>{let r=Object.keys(e);if(!(r.length>0))throw Error("Empty parameter mapping provided");let s=r.filter(e=>0>Object.values(A.D0).indexOf(e));if(s.length>0)throw Error(`Invalid Origin Tracing Parameter(s) supplied: ${s.join()}!`);let i=rk((e,t)=>r.indexOf(t)>=0,t);return Object.keys(i).map(t=>{let r=e[t](i[t]);return{[t]:r}}).reduce((e,t)=>Object.assign(e,t),{})}),this._originStore={}}}let rR="session.id",rj="session.expiry",rN=/^\d+$/,rx=()=>{};class rL{constructor(e={}){(0,E.A)(this,"_generateNewSessionId",()=>{let e=Date.now().toString();return this._safeLocalStorage.setItem(rR,e),this._onNewSessionStarted&&this._onNewSessionStarted(),e}),(0,E.A)(this,"_updateSessionExpiry",()=>{let e=Date.now()+this._sessionExpiryTime;return this._safeLocalStorage.setItem(rj,e.toString()),e}),(0,E.A)(this,"_debouncedUpdateSessionExpiry",e=>{let{_updateSessionExpiry:t}=this;if(e<Date.now()+this._sessionExpiryDebounceThresholdPercentage*this._sessionExpiryTime)return t();this._sessionExpiryDebounceTimer&&clearTimeout(this._sessionExpiryDebounceTimer),this._sessionExpiryDebounceTimer=setTimeout(()=>{t()},this._sessionExpiryDebounce)}),this._sessionExpiryTime=e.sessionExpiryTime||18e5,this._sessionExpiryDebounce=e.sessionExpiryDebounce||5e3,this._sessionExpiryDebounceThresholdPercentage=e.sessionExpiryDebounceThresholdPercentage||.9,this._onNewSessionStarted=e.onNewSessionStarted?e.onNewSessionStarted:rx,this._safeLocalStorage=new tQ}getCurrentSessionId(){let e=this._safeLocalStorage.getItem(rR),t=parseInt(this._safeLocalStorage.getItem(rj)||"0",10)||0;return this._debouncedUpdateSessionExpiry(t),!e||t<=Date.now()||Number.isNaN(t)?this._generateNewSessionId():rN.test(e)?e:this._generateNewSessionId()}}let rM=class extends tq{constructor(e){let t;try{t=window.sessionStorage||tW}catch{t=tW}super(t,e)}},rF="tab.id";class rU{constructor(){(0,E.A)(this,"_generateNewTabId",()=>{let e=_()();return this._safeSessionStorage.setItem(rF,e),e}),this._safeSessionStorage=new rM}getCurrentTabId(){let e=this._safeSessionStorage.getItem(rF);return e||(e=this._generateNewTabId()),e}}function rB(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function r$(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?rB(Object(r),!0).forEach(function(t){(0,E.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rB(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let rH="taskSessions",rK="taskSessionsInit",rW="awc.";class rG{constructor(){(0,E.A)(this,"_taskSessionsNotRecentlyInitialised",e=>null===this._safeSessionStorage.getItem(rH)||null===this._safeSessionStorage.getItem(rK)||parseInt(this._safeSessionStorage.getItem(rK)||"0",10)<e-3e3),(0,E.A)(this,"_removeTaskSessionPrefix",(e,t)=>t.split(rW)[1]),(0,E.A)(this,"_isTaskSessionQueryParam",(e,t)=>t.startsWith(rW)),(0,E.A)(this,"getAllTaskSessions",()=>{try{return JSON.parse(this._safeSessionStorage.getItem(rH)||"")}catch{return{}}}),(0,E.A)(this,"_writeToSessionStorage",e=>{try{this._safeSessionStorage.setItem(rH,JSON.stringify(e))}catch{}}),(0,E.A)(this,"_appendTaskSessions",e=>{let t=this.getAllTaskSessions(),r=null===t?e:Object.assign(t,e);this._writeToSessionStorage(r)}),(0,E.A)(this,"_safelyRemoveKey",(e,t)=>null===e?{}:(delete e[t],e)),(0,E.A)(this,"createTaskSession",e=>{let t=_()(),r={};return r[e]=t,this._appendTaskSessions(r),t}),(0,E.A)(this,"createTaskSessionWithProvidedId",(e,t)=>{if("string"!=typeof t)throw TypeError("invalid taskSessionId, must be string");let r={};r[e]=t,this._appendTaskSessions(r)}),(0,E.A)(this,"completeTaskSession",e=>{let t=this.getAllTaskSessions(),r=this._safelyRemoveKey(t,e);this._writeToSessionStorage(r)}),(0,E.A)(this,"formatTaskSessionQueryString",({uri:e,includedTaskSessions:t})=>{let{url:r,query:s}=(0,rP.parseUrl)(e),i=this.getAllTaskSessions(),n=t?es(i,t):eo(i,Object.values(A.D0));if(0===Object.keys(n).length)return e;let o=r$(r$({},er(n,(e,t)=>rW+t)),s);return`${r}?${(0,rP.stringify)(o)}`}),(0,E.A)(this,"stripQueryParameters",()=>{let e=er(rk(this._isTaskSessionQueryParam),this._removeTaskSessionPrefix);this._appendTaskSessions(e)});let e=Date.now();this._safeSessionStorage=new rM;try{this._taskSessionsNotRecentlyInitialised(e)&&(this._writeToSessionStorage({}),this._safeSessionStorage.setItem(rK,e.toString()))}catch{}}}let rV=tK.AWC_ANALYTICS_DEBUG.getKey(),rq="synthetic",rQ=()=>{try{return JSON.parse(tU().get(rV)||"false")}catch{tU().remove(rV)}return!1},rJ=class{constructor(){(0,E.A)(this,"_bind",()=>{typeof window>"u"||window.testAnalytics||(window.testAnalytics={eventCache:[],events:()=>window.testAnalytics.eventCache,clear:()=>{window.testAnalytics.eventCache=[];try{localStorage.removeItem("awc.ui.viewed.last.sent"),localStorage.removeItem("awc-staging.ui.viewed.last.sent"),localStorage.removeItem("awc-dev.ui.viewed.last.sent"),localStorage.removeItem("awc-local.ui.viewed.last.sent")}catch{}}})}),(0,E.A)(this,"_cache",e=>{typeof window>"u"||(window.testAnalytics.eventCache.length>=100&&(window.testAnalytics.eventCache=window.testAnalytics.eventCache.slice(1,window.testAnalytics.eventCache.length)),window.testAnalytics.eventCache.push(e))}),(0,E.A)(this,"_shouldCacheEvent",()=>this._isDebugCookieEnabled),(0,E.A)(this,"saveEvent",e=>{e&&this._shouldCacheEvent()&&(window.testAnalytics||this._bind(),e.tags instanceof Array?e.tags.push(rq):e.tags=[rq],this._cache(e))}),this._isDebugCookieEnabled=rQ(),this._isDebugCookieEnabled&&this._bind()}},rY=["embeddedProduct"];function rX(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function rz(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?rX(Object(r),!0).forEach(function(t){(0,E.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rX(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}class rZ{constructor(e,t,r,s={}){if((0,E.A)(this,"start",()=>{this._startInterval(),this._bindEventListeners()}),(0,E.A)(this,"stop",()=>{this._stopInterval(),this._unbindEventListeners()}),(0,E.A)(this,"resetTimers",()=>{this._intervalId&&(this.stop(),this.start())}),(0,E.A)(this,"_bindEventListeners",()=>{"u">typeof window&&(window.addEventListener("focus",this._focusListener),window.addEventListener("blur",this._blurListener))}),(0,E.A)(this,"_unbindEventListeners",()=>{"u">typeof window&&(window.removeEventListener("focus",this._focusListener),window.removeEventListener("blur",this._blurListener))}),(0,E.A)(this,"_startInterval",()=>{clearInterval(this._intervalId),this._intervalId=setInterval(this._handleInterval,this._delay)}),(0,E.A)(this,"_stopInterval",()=>{this._intervalId&&(clearInterval(this._intervalId),this._intervalId=null)}),(0,E.A)(this,"_getProductKey",(e,t)=>{let r=e;return t&&(r+=`-${t}`),r}),(0,E.A)(this,"_getLastSentTimestamp",(e,t,r)=>(((this._parseLocalStorageData(this._storageKey)||{})[r]||{})[t]||{})[e]||null),(0,E.A)(this,"_parseLocalStorageData",e=>{let t=this._safeLocalStorage.getItem(e);try{return JSON.parse(t||"")}catch{return this._safeLocalStorage.removeItem(e),null}}),(0,E.A)(this,"_getMalformedLastSentTimestamp",(e,t,r)=>(((this._parseLocalStorageData(this._malformedEventStorageKey)||{})[r||"NOT_SET"]||{})[t||"NOT_SET"]||{})[e]||null),(0,E.A)(this,"_setLastSentTimestamp",(e,t,r)=>{let s=this._parseLocalStorageData(this._storageKey)||{},i=s[r]||{},n=i[t]||{};n[e]=Date.now(),i[t]=n,s[r]=i,this._safeLocalStorage.setItem(this._storageKey,JSON.stringify(s))}),(0,E.A)(this,"_setMalformedLastSentTimestamp",(e,t,r)=>{let s=this._parseLocalStorageData(this._malformedEventStorageKey)||{},i=r||"NOT_SET",n=t||"NOT_SET",o=s[i]||{},a=o[n]||{};a[e]=Date.now(),o[n]=a,s[i]=o,this._safeLocalStorage.setItem(this._malformedEventStorageKey,JSON.stringify(s))}),(0,E.A)(this,"_shouldSendEvent",(e,t,r,s)=>{if(!document.hasFocus())return"FocusLost";if(t!==A.v7.NONE&&!r||!s){let t=Date.now()-this._getMalformedLastSentTimestamp(e,r,s);return null===t||t>this._throttle?"UserOrTenantIncomplete":"MalformedUiViewedRateLimited"}let i=Date.now()-this._getLastSentTimestamp(e,r,s);return null===i||i>this._throttle?"EligibleToSend":"UiViewedRateLimited"}),(0,E.A)(this,"_handleInterval",()=>{let e=this._getContext(),{embeddedProduct:t}=e,r=(0,eJ.A)(e,rY);this._sendEvent(this._product,r),t&&this._sendEvent(t,r,!0)}),(0,E.A)(this,"_sendEvent",(e,t,r=!1)=>{let{subproduct:s,tenantIdType:i,tenantId:n,userId:o,lastScreenEvent:a,attributes:c}=t,l=this._getProductKey(e,s);switch(this._shouldSendEvent(l,i,n,o)){case"EligibleToSend":this._setLastSentTimestamp(l,n,o),this._onEvent(this._createEvent(e,s,r,a,c,"ui","viewed"));break;case"UserOrTenantIncomplete":this._setMalformedLastSentTimestamp(l,n,o),this._onEvent(this._createEvent(e,s,r,a,c,"malformed","uiviewed"))}}),(0,E.A)(this,"_createEvent",(e,t,r,s,i,n,o)=>{let a={product:e,source:"ui",action:o,actionSubject:n,attributes:i};return r&&(a.subproduct=null,a.version=null,a.attributes=rz(rz({},a.attributes),{},{embeddedInEnv:this._productInfo.env,embeddedInProduct:this._productInfo.product,embeddedInSubproduct:t,embeddedInVersion:this._productInfo.version,embeddedInOrigin:this._productInfo.origin,embeddedInPlatform:this._productInfo.platform})),s&&(a.attributes=rz(rz({},a.attributes),{},{lastScreenEvent:{name:s.name,attributes:s.attributes}})),a}),!e)throw Error("Missing productInfo");if(!e.product)throw Error("Missing productInfo.product");if(!t)throw Error("Missing getContext callback");if("function"!=typeof t)throw Error("Invalid getContext, must be function");if(!r)throw Error("Missing onEvent callback");if("function"!=typeof r)throw Error("Invalid onEvent, must be function");this._productInfo=e,this._product=e.product,this._getContext=t,this._onEvent=r,this._delay=s.delay||2e3,this._throttle=s.throttle||36e5,this._storageKey=s.storageKey||"ui.viewed.last.sent",this._malformedEventStorageKey=s.malformedStorageKey||"malformed.uiviewed.last.sent",this._safeLocalStorage=new tQ({envPrefix:this._productInfo.env}),this._focusListener=()=>{this._startInterval()},this._blurListener=()=>{this._stopInterval()}}}function r0(e,t){return e&&"function"==typeof e?()=>{e(t)}:null}let r1=((v={}).XC="xc",v.UID="uid",v);(I={}).NEW="NEW",I.CHANGED="CHANGED",I.EXISTING="EXISTING",I.TIMEOUT="TIMEOUT",I.ERROR="ERROR",I.UNAVAILABLE="UNAVAILABLE",I.MALFORMED="MALFORMED",I.UNKNOWN="UNKNOWN";let r4=()=>[{type:r1.XC,state:"TIMEOUT"},{type:r1.UID,state:"TIMEOUT"}],r2=()=>[{type:r1.XC,state:"UNKNOWN"},{type:r1.UID,state:"UNKNOWN"}],r3=(e,t)=>{if(e&&t&&"function"==typeof t)return Promise.race([t().catch(()=>()=>r2()),new Promise(e=>{setTimeout(()=>e(()=>r4()),5e3)})])};var r5=r(68731);function r6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function r7(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?r6(Object(r),!0).forEach(function(t){(0,E.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):r6(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let r8="last.screen.event";class r9{static getCallback(e){return e=e||r5,t=>{r9.callback(t,e)}}static callback(e,t){let r=e.getStatusCode();r>=200&&r<=299?e.getEventResponseList().forEach(e=>{t.warn(`Validation report for event with message ID %s:
`,e.getMessageId(),e)}):400===r||404===r?(t.warn("GASv3 submission failed with HTTP Status Code %d: %s",e.getStatusCode(),e.getMessage()),e.getEventResponseList().forEach(e=>{t.warn(`Event with message ID %s:
`,e.getMessageId(),e)})):(t.log("GASv3 submission failed with HTTP Status Code %d: %s",e.getStatusCode(),e.getMessage()),e.eventResponseList.forEach(e=>{t.debug(`Event with message ID %s:
`,e.getMessageId(),e)}))}}class se{constructor(e,t={}){if((0,E.A)(this,"_useStargate",e=>e??!0),(0,E.A)(this,"_changeInternalUserId",(e,t)=>{this._eventProcessor.getUser().setUserId(e),t&&t!==this._eventProcessor.getUser().getAnonymousId()&&this._eventProcessor.getUser().setAnonymousId(t)}),(0,E.A)(this,"_createSubproductGetter",e=>R(e,"Cannot get subproduct from the callback. Proceeding without it.")),(0,E.A)(this,"_createEmbeddedProductGetter",e=>R(e,"Cannot get embeddedProduct from the callback. Proceeding without it.")),(0,E.A)(this,"_getLastScreenEvent",()=>{try{return JSON.parse(this._safeSessionStorage.getItem(r8)||"")}catch{return this._safeSessionStorage.removeItem(r8),null}}),(0,E.A)(this,"_setLastScreenEvent",e=>{this._safeSessionStorage.setItem(r8,JSON.stringify({name:e.name,attributes:e.attributes}))}),(0,E.A)(this,"_shouldEventBeDelayed",e=>{if(!e.tags||-1===e.tags.indexOf("measurement"))return!1;let t=!1!==e.highPriority;return this._eventDelayQueue.isDelayingLowPriorityEvents()&&!t}),(0,E.A)(this,"_fireEvent",(e,t,r,s)=>{switch(t.eventType){case A.$q.UI:case A.$q.OPERATIONAL:case A.$q.TRACK:return this._eventProcessor.track(e,t,r,s);case A.$q.SCREEN:return this._eventProcessor.page(e,t,r,s);case A.$q.IDENTIFY:return this._eventProcessor.identify(e,t,r,s);default:throw Error(`No handler has been defined for events of type ${t.eventType}`)}}),(0,E.A)(this,"_fireDelayedEvent",(e,t,r,s)=>{try{this._changeInternalUserId(s.userId,s.anonymousId),t.tags=[...t.tags||[],"sentWithDelay"],this._fireEvent(e,t,r,void 0)}finally{this._changeInternalUserId(this._userInfo.userId,this._userInfo.anonymousId)}}),(0,E.A)(this,"_delayEvent",(e,t,r,s,i)=>{this._eventDelayQueue.push(e,t,r,s),i&&i()}),(0,E.A)(this,"_processEvent",(e,t,r,s)=>(this._testingCache.saveEvent(t),this._shouldEventBeDelayed(t)?(this._delayEvent(e,t,r,this._userInfo,s),Promise.resolve()):this._fireEvent(e,t,r,s))),(0,E.A)(this,"setEmbeddedProduct",e=>{this._internalProductInfo.embeddedProduct=this._createEmbeddedProductGetter(e),this.resetUIViewedTimers()}),(0,E.A)(this,"clearEmbeddedProduct",()=>{this._internalProductInfo.embeddedProduct=this._createEmbeddedProductGetter(null)}),(0,E.A)(this,"setSubproduct",e=>{this._internalProductInfo.subproduct=this._createSubproductGetter(e),this.resetUIViewedTimers()}),(0,E.A)(this,"setOriginTracingHandlers",e=>{let t=this._originTracing.handleOriginParameters(e,this._historyReplaceFn);Object.keys(t).forEach(e=>{"u">typeof t[e].taskSessionId&&this._task.createTaskSessionWithProvidedId(e,t[e].taskSessionId)});let r={};return Object.keys(t).forEach(e=>{t[e].originTracingAttributes?r[e]=t[e].originTracingAttributes:r5.warn(`Handling method for origin parameter ${e} has not returned any attributes`)}),Object.keys(t).length>0?this.sendOperationalEvent({action:"landed",actionSubject:"origin",source:"webClient",attributes:{originTracesLanded:r}},()=>{}):Promise.resolve()}),(0,E.A)(this,"setTenantInfo",(e,t)=>{if(!e)throw Error("Missing tenantIdType");if(e!==A.v7.NONE&&!t)throw Error("Missing tenantId");if(!(0,A.Xj)(A.v7,e))throw Error(`Invalid tenantIdType '${e}', must be an tenantType: [${(0,A.KQ)(A.v7)}]`);this._tenantInfo={tenantIdType:e,tenantId:t},this._eventProcessor.refreshMetadata(this._userInfo,this._tenantInfo)}),(0,E.A)(this,"clearTenantInfo",()=>{this._tenantInfo={},this._eventProcessor.refreshMetadata(this._userInfo,this._tenantInfo)}),(0,E.A)(this,"setOrgInfo",e=>{if(!e)throw Error("Missing orgId");this._orgInfo={orgId:e}}),(0,E.A)(this,"clearOrgInfo",()=>{this._orgInfo={}}),(0,E.A)(this,"setWorkspaceInfo",e=>{if(!e)throw Error("Missing workspaceId");this._workspaceInfo={workspaceId:e}}),(0,E.A)(this,"clearWorkspaceInfo",()=>{this._workspaceInfo={}}),(0,E.A)(this,"setUserInfo",(e,t)=>{(function(e,t){if(!e)throw Error("Missing userIdType");if(!t)throw Error("Missing userId");if(!(0,A.Xj)(A.Of,e))throw Error(`Invalid userIdType '${e}', must be an userType: [${(0,A.KQ)(A.Of)}]`)})(e,t),this._changeInternalUserId(t),this._userInfo={userIdType:e,userId:t,anonymousId:this._eventProcessor.getUser().getAnonymousId()},this._eventProcessor.refreshMetadata(this._userInfo,this._tenantInfo)}),(0,E.A)(this,"clearUserInfo",()=>{this._changeInternalUserId(void 0),this._userInfo={anonymousId:this._eventProcessor.getUser().getAnonymousId()},this._eventProcessor.refreshMetadata(this._userInfo,this._tenantInfo)}),(0,E.A)(this,"setAlias",(e,t)=>{if(!e)throw Error("Missing aliasType");if(!(0,A.Xj)(A.VD,e))throw Error(`Invalid aliasType '${e}', must be an aliasType: [${(0,A.KQ)(A.VD)}]`);this._aliases[e]=t}),(0,E.A)(this,"clearAlias",()=>{this._aliases={}}),(0,E.A)(this,"setGroup",(e,t)=>{if(!e)throw Error("Missing groupType");if(!(0,A.Xj)(A.iU,e))throw Error(`Invalid groupType '${e}', must be an groupType: [${(0,A.KQ)(A.iU)}]`);this._groups[e]=t}),(0,E.A)(this,"clearGroup",()=>{this._groups={}}),(0,E.A)(this,"getAnonymousId",()=>this._userInfo.anonymousId),(0,E.A)(this,"setUIViewedAttributes",e=>{if(!e)throw Error("Missing uiViewedAttributes");if("object"!=typeof e||Array.isArray(e))throw Error("Invalid uiViewedAttributes type, should be a non array object");this._uiViewedAttributes=r7({},e)}),(0,E.A)(this,"getUIViewedAttributes",()=>this._uiViewedAttributes),(0,E.A)(this,"clearUIViewedAttributes",()=>{this._uiViewedAttributes={}}),(0,E.A)(this,"sendIdentifyEvent",(e,t,r)=>{this.setUserInfo(e,t);let s={userIdType:e,eventType:A.$q.IDENTIFY};return this._processEvent(t,s,this._context,r)}),(0,E.A)(this,"sendPageEvent",(e,t)=>this.sendScreenEvent(e,t)),(0,E.A)(this,"sendScreenEvent",(e,t,r)=>{let s,i,n,o;"object"==typeof e?(s=e.name,i=e.attributes,n=e.containers,o=e.tags):(s=e,i=r),function(e){if(!e)throw Error("Missing name")}(s),eu(n);let a=function(e,t,r,s,i,n,o,a,c,l,u,h,d,f,p,m){let y=q(e),g=U(t),b=B(r),v=$(l),I=H(h),E={title:"",path:"",url:"",referrer:"",search:"",eventType:A.$q.SCREEN};return F(F(F(F(F(F(F(F(F(F(F(F({},y),g),b),v),E),J("attributes",s)),J("nonPrivacySafeAttributes",i)),Y(f)),G(d)),{},{tags:n,tabId:o,sessionId:a,taskSessions:c,pageLoadId:u},I),K(p)),W(m))}(this._internalProductInfo,this._tenantInfo,this._userInfo,i,e.nonPrivacySafeAttributes,o,this._tabTracking.getCurrentTabId(),this._sessionTracking.getCurrentSessionId(),this._task.getAllTaskSessions(),this._orgInfo,this._pageLoadId,this._workspaceInfo,e,n,this._aliases,this._groups),c=r7({name:s},a);return this._setLastScreenEvent(c),this._processEvent(s,c,this._context,r0(t,c))}),(0,E.A)(this,"sendTrackEvent",(e,t)=>{ed(e);let r=ee(this._internalProductInfo,this._tenantInfo,this._userInfo,e,A.$q.TRACK,this._tabTracking.getCurrentTabId(),this._sessionTracking.getCurrentSessionId(),this._task.getAllTaskSessions(),this._orgInfo,this._pageLoadId,this._workspaceInfo,this._aliases,this._groups);return this._processEvent(z(e),r,this._context,r0(t,r))}),(0,E.A)(this,"sendUIEvent",(e,t)=>{ed(e);let r=ee(this._internalProductInfo,this._tenantInfo,this._userInfo,e,A.$q.UI,this._tabTracking.getCurrentTabId(),this._sessionTracking.getCurrentSessionId(),this._task.getAllTaskSessions(),this._orgInfo,this._pageLoadId,this._workspaceInfo,this._aliases,this._groups);return this._processEvent(z(e),r,this._context,r0(t,r))}),(0,E.A)(this,"sendOperationalEvent",(e,t)=>{ed(e);let r=ee(this._internalProductInfo,this._tenantInfo,this._userInfo,e,A.$q.OPERATIONAL,this._tabTracking.getCurrentTabId(),this._sessionTracking.getCurrentSessionId(),this._task.getAllTaskSessions(),this._orgInfo,this._pageLoadId,this._workspaceInfo,this._aliases,this._groups);return this._processEvent(z(e),r,this._context,r0(t,r))}),(0,E.A)(this,"startUIViewedEvent",e=>{this.stopUIViewedEvent(),this._uiViewedEvent=new rZ(this._internalProductInfo,()=>({embeddedProduct:this._internalProductInfo.embeddedProduct(),subproduct:this._internalProductInfo.subproduct(),tenantIdType:this._tenantInfo.tenantIdType,tenantId:this._tenantInfo.tenantId,userId:this._userInfo.userId,lastScreenEvent:this._getLastScreenEvent(),attributes:this._uiViewedAttributes}),t=>this.sendUIEvent(t,e)),this._uiViewedEvent.start()}),(0,E.A)(this,"stopUIViewedEvent",()=>{this._uiViewedEvent&&(this._uiViewedEvent.stop(),this._uiViewedEvent=null)}),(0,E.A)(this,"resetUIViewedTimers",()=>{this._uiViewedEvent&&this._uiViewedEvent.resetTimers()}),(0,E.A)(this,"startApdexEvent",e=>{this._apdexEvent.start(e)}),(0,E.A)(this,"getApdexStart",e=>this._apdexEvent.getStart(e)),(0,E.A)(this,"stopApdexEvent",(e,t)=>{this._apdexEvent.stop(e,t)}),(0,E.A)(this,"startLowPriorityEventDelay",(e,t)=>{this._eventDelayQueue.startLowPriorityEventDelay(e,t)}),(0,E.A)(this,"stopLowPriorityEventDelay",()=>{this._eventDelayQueue.stopLowPriorityEventDelay()}),(0,E.A)(this,"onEvent",(e,t)=>{if(!t)throw Error("Missing analyticsData");if(!t.eventType)throw Error("Missing analyticsData.eventType");if(t.eventType===A.$q.TRACK)return this.sendTrackEvent(t);if(t.eventType===A.$q.UI)return this.sendUIEvent(t);if(t.eventType===A.$q.OPERATIONAL)return this.sendOperationalEvent(t);if(t.eventType===A.$q.SCREEN)return this.sendScreenEvent(t.name,null,t.attributes);if(t.eventType===A.$q.IDENTIFY)return this.sendIdentifyEvent(t.userIdType,t.userId);throw Error(`Invalid analyticsData.eventType '${t.eventType}', must be an eventType: [${(0,A.KQ)(A.$q)}]`)}),(0,E.A)(this,"setResponseCallback",e=>{this._eventProcessor.setResponseCallback(e)}),!e)throw Error("Missing productInfo");if(!e.env)throw Error("Missing productInfo.env");if(!e.product)throw Error("Missing productInfo.product");if(!(0,A.Xj)(A.sR,e.env))throw Error(`Invalid productInfo.env '${e.env}', must be an envType: [${(0,A.KQ)(A.sR)}]`);if(e.perimeter&&!(0,A.Xj)(A.KW,e.perimeter))throw Error(`Invalid productInfo.perimeter '${e.perimeter}', must be an perimeterType: [${(0,A.KQ)(A.KW)}]`);if(e.origin){if(!(0,A.Xj)(A.VH,e.origin))throw Error(`Invalid productInfo.origin '${e.origin}', must be an originType: [${(0,A.KQ)(A.VH)}]`)}else e.origin=A.VH.WEB;e.platform?function(e){if(!(0,A.Xj)(A.AQ,e.platform))throw Error(`Invalid productInfo.platform '${e.platform}', must be a platformType: [${(0,A.KQ)(A.AQ)}]`);if(e.origin===A.VH.DESKTOP&&!(0,A.Xj)(A.vB,e.platform))throw Error(`Invalid productInfo.platform '${e.platform}', must be one of [mac, linux, windows]`);if(e.origin===A.VH.WEB&&!(0,A.Xj)(A.LK,e.platform))throw Error(`Invalid productInfo.platform '${e.platform}', must be one of [web, mobileWeb]`)}(e):e.platform=e.origin===A.VH.WEB?A.AQ.WEB:A.AQ.DESKTOP,this._logger=t.logger||r5,this._internalProductInfo=r7(r7({},e),{},{subproduct:this._createSubproductGetter(e.subproduct),embeddedProduct:this._createEmbeddedProductGetter(e.embeddedProduct)}),this._tenantInfo={},this._orgInfo={},this._uiViewedAttributes={},null!=e&&e.embeddedContext&&(this._embeddedContext=e.embeddedContext,j(this._embeddedContext)&&this.setUIViewedAttributes({embeddedType:this._embeddedContext.embeddedType,embeddedFromProduct:this._embeddedContext.embeddedFromProduct,embeddedFromSubproduct:this._embeddedContext.embeddedFromSubproduct,embeddedFromTopLevelDomain:this._embeddedContext.embeddedFromTopLevelDomain}),N(this._embeddedContext)&&this.setUIViewedAttributes({embeddedType:this._embeddedContext.embeddedType,embeddedFromTopLevelDomain:this._embeddedContext.embeddedFromTopLevelDomain})),this._context=function(e){let t=window.screen||{};return{context:{locale:e.locale,screen:{width:t.width,height:t.height,density:window.devicePixelRatio},library:{name:"analytics.js",version:"5.4.0"},validationMode:function(e){let t=e.env;return void 0===t||t.includes("prod")?Z.QUIET:Z.COMPLETE}(e)}}}(this._internalProductInfo),this._safeSessionStorage=new rM;let r=this._useStargate(t.useStargate),s=t.apiHost||function({useStargate:e,env:t,useLegacyUrl:r,perimeter:s,envOverride:i}){return s===A.KW.FEDRAMP_MODERATE?rb({useStargate:e,env:t,useLegacyUrl:r,envOverride:i}):rv({useStargate:e,env:t,useLegacyUrl:r})}({useStargate:r,env:e.env,useLegacyUrl:t.useLegacyUrl,perimeter:e.perimeter,envOverride:e.envOverride}),i=t.apiHostProtocol||"https",n=t.minRetryDelay||1e3,o=void 0!==t.maxRetryAttempts&&Number.isInteger(t.maxRetryAttempts)&&t.maxRetryAttempts>=0?t.maxRetryAttempts+1:void 0,a={maxRetryDelay:6e4,minRetryDelay:n,backoffFactor:2,flushWaitMs:t.flushWaitInterval,flushBeforeUnload:t.flushBeforeUnload,maxAttempts:o},c=`awc-${e.env}`,l=t.disableCookiePersistence||!1,u=(t.metadataClientFactory||rT.Factory)(i,s,e.product);this._eventProcessor=new rf({apiHost:s,apiHostProtocol:i,product:e.product,retryQueuePrefix:c,retryQueueOptions:a,xidPromiseGetter:()=>r3(t.xidConsent,t.xidPromiseFn),logger:this._logger,metadataClient:u,disableCookiePersistence:l,responseCallback:r9.getCallback(this._logger),env:e.env,perimeter:e.perimeter,enableMetadataCalls:this.metadataCallsEnabled(t),enableEventCalls:this.eventCallsEnabled(t)}),this._userInfo={anonymousId:this._eventProcessor.getUser().getAnonymousId(t?.customAnonymousIdGenerator)},this._pageVisibility=new O,this._tabTracking=new rU,this._sessionTracking=new rL({sessionExpiryTime:t.sessionExpiryTime,onNewSessionStarted:t.onNewSessionStarted}),this._task=new rG,this._originTracing=new rD,this._apdexEvent=new C(this.sendOperationalEvent,this._pageVisibility),this._historyReplaceFn="function"==typeof t.historyReplaceFn?t.historyReplaceFn:rC,this._eventDelayQueue=new eI(this._fireDelayedEvent,t.delayQueueCompressors||[]),this._testingCache=new rJ,this._pageLoadId=_()(),this._workspaceInfo={},this._aliases={},this._groups={}}metadataCallsEnabled(e){return"boolean"==typeof e.disableMetadataCalls?!e.disableMetadataCalls:!rI.isGeminiVREnvironment()&&!rI.areFetchCallsDisabled()}eventCallsEnabled(e){return"boolean"==typeof e.disableEventCalls?!e.disableEventCalls:!rI.isGeminiVREnvironment()&&!rI.areFetchCallsDisabled()}setEventValidationMode(e){this._context.context.validationMode=e}get task(){return this._task}get _productInfo(){return this._internalProductInfo}}},86068:function(e,t,r){"use strict";var s,i,n,o,a,c,l,u,h,d,f;r.d(t,{$q:()=>m,AQ:()=>y,D0:()=>A,KQ:()=>O,KW:()=>T,LK:()=>_,LR:()=>E,Of:()=>I,VD:()=>P,VH:()=>g,Xj:()=>S,iU:()=>C,sR:()=>p,v7:()=>b,vB:()=>w,vH:()=>v});let p=((s={}).LOCAL="local",s.DEV="dev",s.STAGING="staging",s.PROD="prod",s),m=((i={}).TRACK="track",i.UI="ui",i.OPERATIONAL="operational",i.SCREEN="screen",i.IDENTIFY="identify",i),y=((n={}).MAC="mac",n.LINUX="linux",n.WINDOWS="windows",n.DESKTOP="desktop",n.WEB="web",n.MOBILE_WEB="mobileWeb",n),g=((o={}).DESKTOP="desktop",o.WEB="web",o),b=((a={}).CLOUD_ID="cloudId",a.ORG_ID="orgId",a.OPSGENIE_CUSTOMER_ID="opsgenieCustomerId",a.HALP_TEAM_ID="halpTeamId",a.LOOM_ORG_ID="loomOrgId",a.TRANSACTION_ACCOUNT_ID="transactionAccountId",a.TRELLO_WORKSPACE_ID="trelloWorkspaceId",a.JA_WORKSPACE_ID="jiraAlignWorkspaceId",a.NONE="none",a),v=((c={}).FIRST_PARTY="FIRST_PARTY",c.THIRD_PARTY="THIRD_PARTY",c),I=((l={}).ATLASSIAN_ACCOUNT="atlassianAccount",l.HASHED_EMAIL="hashedEmail",l.LOOM="loom",l.TRELLO="trello",l.OPSGENIE="opsgenie",l.JA_USER_ID="jiraAlign",l.HALP="halp",l),E=((u={}).TRANSITION="transition",u.INITIAL_LOAD="initialLoad",u),w=Object.freeze([y.DESKTOP,y.MAC,y.LINUX,y.WINDOWS]),_=Object.freeze([y.WEB,y.MOBILE_WEB]),A=((h={}).ATL_ORIGIN="atlOrigin",h);function O(e){return Object.values(e)}function S(e,t){return Object.values(e).indexOf(t)>-1}let T=((d={}).C5="c5",d.COMMERCIAL="commercial",d.FEDRAMP_MODERATE="fedramp-moderate",d.FEDRAMP_HIGH="fedramp-high",d),P={},C=((f={}).TRANSACTION_ACCOUNT_ID="transactionAccountId",f)},41114:function(e,t,r){"use strict";r.r(t),r.d(t,{Journeys:()=>n,Targets:()=>d,CrossFlowConsumer:()=>b,useCrossFlow:()=>c,withCrossFlow:()=>l,Reasons:()=>o});var s=r(53847),i=r(89263),n={GET_STARTED:"get-started",DECIDE:"decide",DISCOVER:"discover"},o={NO_API_SUPPORT:"Could not provide requested API version",NO_PROVIDER:"Provider not found"},a=(0,i.createContext)(function(){return{isEnabled:!1,reason:o.NO_PROVIDER}}),c=function(){var e=(0,i.useContext)(a);return(0,i.useMemo)(function(){return e(1)},[e])};function l(e){var t=function(t){var r=c();return i.createElement(e,(0,s.A)({},t,{crossFlow:r}))};return t.displayName="withCrossFlow(".concat(e.displayName||e.name||"Component",")"),t}var u=r(12958),h=r(77408);(0,u.A)(function e(t){(0,h.A)(this,e),Object.assign(this,t),Object.freeze(this)});var d={CONFLUENCE:"confluence.ondemand",JIRA_CORE:"jira-core.ondemand",JIRA_SERVICE_DESK:"jira-servicedesk.ondemand",JIRA_SOFTWARE:"jira-software.ondemand",JIRA_PRODUCT_DISCOVERY:"jira-product-discovery",BITBUCKET:"bitbucket.ondemand",TRELLO:"trello",OPSGENIE:"opsgenie",STATUSPAGE:"statuspage",TEAM_CENTRAL:"townsquare",ATLAS:"townsquare",AVOCADO:"avocado",ANALYTICS:"atlassian-analytics-free",COMPASS:"compass",LOOM:"loom"},f=r(50938),p=r(20298),m=r(88215),y=r.n(m),g=["onComplete","onError"],b=function(e){var t=(0,i.useRef)(e),r=(0,i.useRef)(c());return(0,i.useEffect)(function(){var e=r.current;(0,p.A)(y().mark(function r(){var s,i,n,o,a,c;return y().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(i=(s=t.current).onComplete,n=s.onError,o=(0,f.A)(s,g),!e.isEnabled){r.next=13;break}return a="v1"in o?e.apiV1:e.api,r.prev=3,r.next=6,a.open(o);case 6:c=r.sent,i?.(c),r.next=13;break;case 10:r.prev=10,r.t0=r.catch(3),n?.(r.t0);case 13:case"end":return r.stop()}},r,null,[[3,10]])}))()},[]),null}},16518:function(e,t,r){"use strict";r.d(t,{A:()=>w});var s,i=r(69874),n=r(69691),o=r(97009),a=r(55564),c=r(17330),l=r(16932),u=r(66369),h=r.n(u),d=r(67417),f=function(){return s||(s=p({atob:"function"==typeof atob&&atob.bind(void 0)||"u">typeof d.Buffer&&function(e){return d.Buffer.from(e,"base64").toString()},btoa:"function"==typeof btoa&&btoa.bind(void 0)||"u">typeof d.Buffer&&function(e){return d.Buffer.from(e).toString("base64")},URLSearchParams:"function"==typeof URLSearchParams&&URLSearchParams||r(30601).URLSearchParams}))},p=function(e){if(!(e.atob&&e.btoa&&e.URLSearchParams))throw TypeError("Origin-Tracing: missing environment APIs. Required: btoa(), atob(), URLSearchParams() (or in Node: Buffer, require('url').URLSearchParams).");return e},m={confluence:"c",jira:"j",stride:"s",bitbucket:"b",trello:"t"};function y(e){var t=g();return function(){var r,s=(0,o.A)(e);if(t){var i=(0,o.A)(this).constructor;r=Reflect.construct(s,arguments,i)}else r=s.apply(this,arguments);return(0,n.A)(this,r)}}function g(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(g=function(){return!!e})()}function b(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function v(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?b(Object(r),!0).forEach(function(t){(0,a.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var I="atlOrigin",E={originLibrary:"origin-tracing.js@".concat("6.1.5")},w=function(){function e(t){var r=t.id,s=void 0===r?e.generateId():r,i=t.product,n=t.dangerouslySkipValidation;(0,c.A)(this,e),this.id=s,this.product=i,void 0!==n&&n||this.validate()}return(0,l.A)(e,[{key:"encode",value:function(){var e,t,r,s;return e=JSON.stringify({i:(r={id:this.id,product:this.product}).id,p:(s=r.product)&&s in m?m[s]:s}),null==(t=f().btoa(e))?"":String(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}},{key:"addToUrl",value:function(e){var t=this;return O(e,function(e){var r=new(f()).URLSearchParams(e);return r.set(I,t.encode()),r.toString()})}},{key:"isEmpty",value:function(){return!1}},{key:"isMalformed",value:function(){return!this.isEmpty()&&!this.isValid()}},{key:"isValid",value:function(){return!0}},{key:"toAnalyticsAttributes",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.transformValue,s=void 0===r?function(e){return null===e?void 0:e}:r,i=t.hasGeneratedId;return v((e={},(0,a.A)(e,void 0!==i&&i?"originIdGenerated":"originId",s(this.id)),(0,a.A)(e,"originProduct",s(this.product)),e),E)}},{key:"validate",value:function(){if(!e.isValidId(this.id))throw TypeError("Invalid Origin id");if(!e.isValidProduct(this.product))throw TypeError("Missing/invalid Origin product")}}],[{key:"isValidId",value:function(e){return"string"==typeof e&&/^[-_a-zA-Z0-9]{1,36}$/.test(e)}},{key:"isValidProduct",value:function(e){return"string"==typeof e&&/^[-_a-zA-Z0-9]{1,20}$/.test(e)}},{key:"generateId",value:function(){return h()().replace(/-/g,"")}},{key:"createEmpty",value:function(){return new _}},{key:"createMalformed",value:function(){return new A}},{key:"fromUrl",value:function(t){var r=new(f()).URLSearchParams;return O(t,function(e){r=new(f()).URLSearchParams(e)}),e.fromEncoded(r.get(I))}},{key:"fromEncoded",value:function(t){if(!t)return e.createEmpty();try{return e.decode(t)}catch{return e.createMalformed()}}},{key:"removeFromUrl",value:function(e){return O(e,function(e){var t=new(f()).URLSearchParams(e);return t.delete(I),t.toString()})}},{key:"decode",value:function(t){var r,s,i,n=(i=function(e){if(null==e)return"";var t=String(e).replace(/-/g,"+").replace(/_/g,"/"),r=(4-e.length%4)%4;return t+"===".slice(0,r)}(t),r=JSON.parse(f().atob(i)),s={},r.i&&(s.id=r.i),r.p&&(s.product=function(e){for(var t=Object.keys(m),r=0;r<t.length;r++){var s=t[r];if(e===m[s])return s}return e}(r.p)),s);return new e(n)}}]),e}(),_=function(e){(0,i.A)(r,e);var t=y(r);function r(){return(0,c.A)(this,r),t.call(this,{id:null,product:null,dangerouslySkipValidation:!0})}return(0,l.A)(r,[{key:"isValid",value:function(){return!1}},{key:"isEmpty",value:function(){return!0}},{key:"toAnalyticsAttributes",value:function(){return v({},E)}}]),r}(w),A=function(e){(0,i.A)(r,e);var t=y(r);function r(){return(0,c.A)(this,r),t.call(this,{id:null,product:null,dangerouslySkipValidation:!0})}return(0,l.A)(r,[{key:"isValid",value:function(){return!1}},{key:"isEmpty",value:function(){return!1}},{key:"toAnalyticsAttributes",value:function(){return v({originMalformed:!0},E)}}]),r}(w);function O(e,t){return String(e).replace(/(^[^?#]*)(?:\?)?([^#]*?)(#.*|$)$/,function(e,r,s,i){var n=t(s);return n&&(n="?".concat(n)),"".concat(r).concat(n).concat(i)})}},28922:function(e,t,r){"use strict";function s(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}r.d(t,{A:()=>s})},18272:function(e,t,r){"use strict";function s(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}r.d(t,{A:()=>s})},65534:function(e,t,r){"use strict";function s(e,t){for(var r=0;r<t.length;r++){var s=t[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function i(e,t,r){return t&&s(e.prototype,t),r&&s(e,r),e}r.d(t,{A:()=>i})},35226:function(e,t,r){"use strict";function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}r.d(t,{A:()=>s})},55:function(e,t,r){"use strict";function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e}).apply(this,arguments)}r.d(t,{A:()=>s})},77851:function(e,t,r){"use strict";function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}r.d(t,{A:()=>s})},56826:function(e,t,r){"use strict";function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function i(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}r.d(t,{A:()=>i})},62952:function(e,t,r){"use strict";function s(e,t){if(null==e)return{};var r,s,i=function(e,t){if(null==e)return{};var r,s,i={},n=Object.keys(e);for(s=0;s<n.length;s++)r=n[s],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(s=0;s<n.length;s++)r=n[s],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}r.d(t,{A:()=>s})},96644:function(e,t,r){"use strict";function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e){return(i="function"==typeof Symbol&&"symbol"===s(Symbol.iterator)?function(e){return s(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":s(e)})(e)}r.d(t,{A:()=>o});var n=r(28922);function o(e,t){return t&&("object"===i(t)||"function"==typeof t)?t:(0,n.A)(e)}},15277:function(e,t,r){"use strict";function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=[],s=!0,i=!1,n=void 0;try{for(var o,a=e[Symbol.iterator]();!(s=(o=a.next()).done)&&(r.push(o.value),!(t&&r.length===t));s=!0);}catch(e){i=!0,n=e}finally{try{s||null==a.return||a.return()}finally{if(i)throw n}}return r}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance")}()}r.d(t,{A:()=>s})},23365:function(e,t,r){"use strict";function s(e){return function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance")}()}r.d(t,{A:()=>s})},66682:function(e){e.exports=function(e){function t(s){if(r[s])return r[s].exports;var i=r[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,s){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:s})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=13)}([function(e,t){var r=e.exports="u">typeof window&&window.Math==Math?window:"u">typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t){var r=e.exports={version:"2.5.0"};"number"==typeof __e&&(__e=r)},function(e,t,r){e.exports=!r(4)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t){e.exports=function(e){try{return!!e()}catch{return!0}}},function(e,t){var r={}.toString;e.exports=function(e){return r.call(e).slice(8,-1)}},function(e,t,r){var s=r(32)("wks"),i=r(9),n=r(0).Symbol,o="function"==typeof n;(e.exports=function(e){return s[e]||(s[e]=o&&n[e]||(o?n:i)("Symbol."+e))}).store=s},function(e,t,r){var s=r(0),i=r(2),n=r(8),o=r(22),a=r(10),c=function(e,t,r){var l,u,h,d,f=e&c.F,p=e&c.G,m=e&c.S,y=e&c.P,g=e&c.B,b=p?s:m?s[t]||(s[t]={}):(s[t]||{}).prototype,v=p?i:i[t]||(i[t]={}),I=v.prototype||(v.prototype={});for(l in p&&(r=t),r)h=((u=!f&&b&&void 0!==b[l])?b:r)[l],d=g&&u?a(h,s):y&&"function"==typeof h?a(Function.call,h):h,b&&o(b,l,h,e&c.U),v[l]!=h&&n(v,l,d),y&&I[l]!=h&&(I[l]=h)};s.core=i,c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,e.exports=c},function(e,t,r){var s=r(16),i=r(21);e.exports=r(3)?function(e,t,r){return s.f(e,t,i(1,r))}:function(e,t,r){return e[t]=r,e}},function(e,t){var r=0,s=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++r+s).toString(36))}},function(e,t,r){var s=r(24);e.exports=function(e,t,r){if(s(e),void 0===t)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,s){return e.call(t,r,s)};case 3:return function(r,s,i){return e.call(t,r,s,i)}}return function(){return e.apply(t,arguments)}}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,r){var s=r(28),i=Math.min;e.exports=function(e){return e>0?i(s(e),9007199254740991):0}},function(e,t,r){"use strict";t.__esModule=!0,t.default=function(e,t){if(e&&t){var r=Array.isArray(t)?t:t.split(","),s=e.name||"",i=e.type||"",n=i.replace(/\/.*$/,"");return r.some(function(e){var t=e.trim();return"."===t.charAt(0)?s.toLowerCase().endsWith(t.toLowerCase()):t.endsWith("/*")?n===t.replace(/\/.*$/,""):i===t})}return!0},r(14),r(34)},function(e,t,r){r(15),e.exports=r(2).Array.some},function(e,t,r){"use strict";var s=r(7),i=r(25)(3);s(s.P+!r(33)([].some,!0)*s.F,"Array",{some:function(e){return i(this,e,arguments[1])}})},function(e,t,r){var s=r(17),i=r(18),n=r(20),o=Object.defineProperty;t.f=r(3)?Object.defineProperty:function(e,t,r){if(s(e),t=n(t,!0),s(r),i)try{return o(e,t,r)}catch{}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(e[t]=r.value),e}},function(e,t,r){var s=r(1);e.exports=function(e){if(!s(e))throw TypeError(e+" is not an object!");return e}},function(e,t,r){e.exports=!r(3)&&!r(4)(function(){return 7!=Object.defineProperty(r(19)("div"),"a",{get:function(){return 7}}).a})},function(e,t,r){var s=r(1),i=r(0).document,n=s(i)&&s(i.createElement);e.exports=function(e){return n?i.createElement(e):{}}},function(e,t,r){var s=r(1);e.exports=function(e,t){var r,i;if(!s(e))return e;if(t&&"function"==typeof(r=e.toString)&&!s(i=r.call(e))||"function"==typeof(r=e.valueOf)&&!s(i=r.call(e))||!t&&"function"==typeof(r=e.toString)&&!s(i=r.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,r){var s=r(0),i=r(8),n=r(23),o=r(9)("src"),a=Function.toString,c=(""+a).split("toString");r(2).inspectSource=function(e){return a.call(e)},(e.exports=function(e,t,r,a){var l="function"==typeof r;l&&(n(r,"name")||i(r,"name",t)),e[t]!==r&&(l&&(n(r,o)||i(r,o,e[t]?""+e[t]:c.join(String(t)))),e===s?e[t]=r:a?e[t]?e[t]=r:i(e,t,r):(delete e[t],i(e,t,r)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[o]||a.call(this)})},function(e,t){var r={}.hasOwnProperty;e.exports=function(e,t){return r.call(e,t)}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,r){var s=r(10),i=r(26),n=r(27),o=r(12),a=r(29);e.exports=function(e,t){var r=1==e,c=2==e,l=3==e,u=4==e,h=6==e,d=5==e||h,f=t||a;return function(t,a,p){for(var m,y,g=n(t),b=i(g),v=s(a,p,3),I=o(b.length),E=0,w=r?f(t,I):c?f(t,0):void 0;I>E;E++)if((d||E in b)&&(y=v(m=b[E],E,g),e)){if(r)w[E]=y;else if(y)switch(e){case 3:return!0;case 5:return m;case 6:return E;case 2:w.push(m)}else if(u)return!1}return h?-1:l||u?u:w}}},function(e,t,r){var s=r(5);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==s(e)?e.split(""):Object(e)}},function(e,t,r){var s=r(11);e.exports=function(e){return Object(s(e))}},function(e,t){var r=Math.ceil,s=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?s:r)(e)}},function(e,t,r){var s=r(30);e.exports=function(e,t){return new(s(e))(t)}},function(e,t,r){var s=r(1),i=r(31),n=r(6)("species");e.exports=function(e){var t;return i(e)&&("function"==typeof(t=e.constructor)&&(t===Array||i(t.prototype))&&(t=void 0),s(t)&&null===(t=t[n])&&(t=void 0)),void 0===t?Array:t}},function(e,t,r){var s=r(5);e.exports=Array.isArray||function(e){return"Array"==s(e)}},function(e,t,r){var s=r(0),i=s["__core-js_shared__"]||(s["__core-js_shared__"]={});e.exports=function(e){return i[e]||(i[e]={})}},function(e,t,r){"use strict";var s=r(4);e.exports=function(e,t){return!!e&&s(function(){t?e.call(null,function(){},1):e.call(null)})}},function(e,t,r){r(35),e.exports=r(2).String.endsWith},function(e,t,r){"use strict";var s=r(7),i=r(12),n=r(36),o="".endsWith;s(s.P+s.F*r(38)("endsWith"),"String",{endsWith:function(e){var t=n(this,e,"endsWith"),r=arguments.length>1?arguments[1]:void 0,s=i(t.length),a=void 0===r?s:Math.min(i(r),s),c=String(e);return o?o.call(t,c,a):t.slice(a-c.length,a)===c}})},function(e,t,r){var s=r(37),i=r(11);e.exports=function(e,t,r){if(s(t))throw TypeError("String#"+r+" doesn't accept regex!");return String(i(e))}},function(e,t,r){var s=r(1),i=r(5),n=r(6)("match");e.exports=function(e){var t;return s(e)&&(void 0!==(t=e[n])?!!t:"RegExp"==i(e))}},function(e,t,r){var s=r(6)("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[s]=!1,!"/./"[e](t)}catch{}}return!0}}])},61450:function(e,t,r){var s=r(86553).default;function i(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */e.exports=i=function(){return r},e.exports.__esModule=!0,e.exports.default=e.exports;var t,r={},n=Object.prototype,o=n.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},c=a.iterator||"@@iterator",l=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function h(e,t,r,s){return Object.defineProperty(e,t,{value:r,enumerable:!s,configurable:!s,writable:!s})}try{h({},"")}catch{h=function(e,t,r){return e[t]=r}}function d(e,r,s,i){var n,o,a=Object.create((r&&r.prototype instanceof m?r:m).prototype);return h(a,"_invoke",(n=new S(i||[]),o=1,function(r,i){if(3===o)throw Error("Generator is already running");if(4===o){if("throw"===r)throw i;return{value:t,done:!0}}for(n.method=r,n.arg=i;;){var a=n.delegate;if(a){var c=function e(r,s){var i=s.method,n=r.i[i];if(n===t)return s.delegate=null,"throw"===i&&r.i.return&&(s.method="return",s.arg=t,e(r,s),"throw"===s.method)||"return"!==i&&(s.method="throw",s.arg=TypeError("The iterator does not provide a '"+i+"' method")),p;var o=f(n,r.i,s.arg);if("throw"===o.type)return s.method="throw",s.arg=o.arg,s.delegate=null,p;var a=o.arg;return a?a.done?(s[r.r]=a.value,s.next=r.n,"return"!==s.method&&(s.method="next",s.arg=t),s.delegate=null,p):a:(s.method="throw",s.arg=TypeError("iterator result is not an object"),s.delegate=null,p)}(a,n);if(c){if(c===p)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===o)throw o=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=3;var l=f(e,s,n);if("normal"===l.type){if(o=n.done?4:2,l.arg===p)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=4,n.method="throw",n.arg=l.arg)}}),!0),a}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}r.wrap=d;var p={};function m(){}function y(){}function g(){}var b={};h(b,c,function(){return this});var v=Object.getPrototypeOf,I=v&&v(v(T([])));I&&I!==n&&o.call(I,c)&&(b=I);var E=g.prototype=m.prototype=Object.create(b);function w(e){["next","throw","return"].forEach(function(t){h(e,t,function(e){return this._invoke(t,e)})})}function _(e,t){var r;h(this,"_invoke",function(i,n){function a(){return new t(function(r,a){!function r(i,n,a,c){var l=f(e[i],e,n);if("throw"!==l.type){var u=l.arg,h=u.value;return h&&"object"==s(h)&&o.call(h,"__await")?t.resolve(h.__await).then(function(e){r("next",e,a,c)},function(e){r("throw",e,a,c)}):t.resolve(h).then(function(e){u.value=e,a(u)},function(e){return r("throw",e,a,c)})}c(l.arg)}(i,n,r,a)})}return r=r?r.then(a,a):a()},!0)}function A(e){this.tryEntries.push(e)}function O(e){var r=e[4]||{};r.type="normal",r.arg=t,e[4]=r}function S(e){this.tryEntries=[[-1]],e.forEach(A,this),this.reset(!0)}function T(e){if(null!=e){var r=e[c];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,n=function r(){for(;++i<e.length;)if(o.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return n.next=n}}throw TypeError(s(e)+" is not iterable")}return y.prototype=g,h(E,"constructor",g),h(g,"constructor",y),y.displayName=h(g,u,"GeneratorFunction"),r.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},r.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,h(e,u,"GeneratorFunction")),e.prototype=Object.create(E),e},r.awrap=function(e){return{__await:e}},w(_.prototype),h(_.prototype,l,function(){return this}),r.AsyncIterator=_,r.async=function(e,t,s,i,n){void 0===n&&(n=Promise);var o=new _(d(e,t,s,i),n);return r.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},w(E),h(E,u,"Generator"),h(E,c,function(){return this}),h(E,"toString",function(){return"[object Generator]"}),r.keys=function(e){var t=Object(e),r=[];for(var s in t)r.unshift(s);return function e(){for(;r.length;)if((s=r.pop())in t)return e.value=s,e.done=!1,e;return e.done=!0,e}},r.values=T,S.prototype={constructor:S,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(O),!e)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0][4];if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function s(t){o.type="throw",o.arg=e,r.next=t}for(var i=r.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i],o=n[4],a=this.prev,c=n[1],l=n[2];if(-1===n[0])return s("end"),!1;if(!c&&!l)throw Error("try statement without catch or finally");if(null!=n[0]&&n[0]<=a){if(a<c)return this.method="next",this.arg=t,s(c),!0;if(a<l)return s(l),!1}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var s=this.tryEntries[r];if(s[0]>-1&&s[0]<=this.prev&&this.prev<s[2]){var i=s;break}}i&&("break"===e||"continue"===e)&&i[0]<=t&&t<=i[2]&&(i=null);var n=i?i[4]:{};return n.type=e,n.arg=t,i?(this.method="next",this.next=i[2],p):this.complete(n)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r[2]===e)return this.complete(r[4],r[3]),O(r),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r[0]===e){var s=r[4];if("throw"===s.type){var i=s.arg;O(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,r,s){return this.delegate={i:T(e),r:r,n:s},"next"===this.method&&(this.arg=t),p}},r}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},86553:function(e){function t(r){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},50297:function(e,t,r){var s=r(61450)();e.exports=s;try{regeneratorRuntime=s}catch{"object"==typeof globalThis?globalThis.regeneratorRuntime=s:Function("r","regeneratorRuntime = r")(s)}},75544:function(e,t,r){var s=r(79).default;function i(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */e.exports=i=function(){return r},e.exports.__esModule=!0,e.exports.default=e.exports;var t,r={},n=Object.prototype,o=n.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},c=a.iterator||"@@iterator",l=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function h(e,t,r,s){Object.defineProperty(e,t,{value:r,enumerable:!s,configurable:!s,writable:!s})}try{h({},"")}catch{h=function(e,t,r){return e[t]=r}}function d(e,r,s,i){var n,o,a=Object.create((r&&r.prototype instanceof m?r:m).prototype);return h(a,"_invoke",(n=new S(i||[]),o=1,function(r,i){if(3===o)throw Error("Generator is already running");if(4===o){if("throw"===r)throw i;return{value:t,done:!0}}for(n.method=r,n.arg=i;;){var a=n.delegate;if(a){var c=function e(r,s){var i=s.method,n=r.i[i];if(n===t)return s.delegate=null,"throw"===i&&r.i.return&&(s.method="return",s.arg=t,e(r,s),"throw"===s.method)||"return"!==i&&(s.method="throw",s.arg=TypeError("The iterator does not provide a '"+i+"' method")),p;var o=f(n,r.i,s.arg);if("throw"===o.type)return s.method="throw",s.arg=o.arg,s.delegate=null,p;var a=o.arg;return a?a.done?(s[r.r]=a.value,s.next=r.n,"return"!==s.method&&(s.method="next",s.arg=t),s.delegate=null,p):a:(s.method="throw",s.arg=TypeError("iterator result is not an object"),s.delegate=null,p)}(a,n);if(c){if(c===p)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===o)throw o=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=3;var l=f(e,s,n);if("normal"===l.type){if(o=n.done?4:2,l.arg===p)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=4,n.method="throw",n.arg=l.arg)}}),!0),a}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}r.wrap=d;var p={};function m(){}function y(){}function g(){}var b={};h(b,c,function(){return this});var v=Object.getPrototypeOf,I=v&&v(v(T([])));I&&I!==n&&o.call(I,c)&&(b=I);var E=g.prototype=m.prototype=Object.create(b);function w(e){["next","throw","return"].forEach(function(t){h(e,t,function(e){return this._invoke(t,e)})})}function _(e,t){var r;h(this,"_invoke",function(i,n){function a(){return new t(function(r,a){!function r(i,n,a,c){var l=f(e[i],e,n);if("throw"!==l.type){var u=l.arg,h=u.value;return h&&"object"==s(h)&&o.call(h,"__await")?t.resolve(h.__await).then(function(e){r("next",e,a,c)},function(e){r("throw",e,a,c)}):t.resolve(h).then(function(e){u.value=e,a(u)},function(e){return r("throw",e,a,c)})}c(l.arg)}(i,n,r,a)})}return r=r?r.then(a,a):a()},!0)}function A(e){this.tryEntries.push(e)}function O(e){var r=e[4]||{};r.type="normal",r.arg=t,e[4]=r}function S(e){this.tryEntries=[[-1]],e.forEach(A,this),this.reset(!0)}function T(e){if(null!=e){var r=e[c];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,n=function r(){for(;++i<e.length;)if(o.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return n.next=n}}throw TypeError(s(e)+" is not iterable")}return y.prototype=g,h(E,"constructor",g),h(g,"constructor",y),h(g,u,y.displayName="GeneratorFunction"),r.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},r.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,h(e,u,"GeneratorFunction")),e.prototype=Object.create(E),e},r.awrap=function(e){return{__await:e}},w(_.prototype),h(_.prototype,l,function(){return this}),r.AsyncIterator=_,r.async=function(e,t,s,i,n){void 0===n&&(n=Promise);var o=new _(d(e,t,s,i),n);return r.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},w(E),h(E,u,"Generator"),h(E,c,function(){return this}),h(E,"toString",function(){return"[object Generator]"}),r.keys=function(e){var t=Object(e),r=[];for(var s in t)r.unshift(s);return function e(){for(;r.length;)if((s=r.pop())in t)return e.value=s,e.done=!1,e;return e.done=!0,e}},r.values=T,S.prototype={constructor:S,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(O),!e)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0][4];if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function s(t){o.type="throw",o.arg=e,r.next=t}for(var i=r.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i],o=n[4],a=this.prev,c=n[1],l=n[2];if(-1===n[0])return s("end"),!1;if(!c&&!l)throw Error("try statement without catch or finally");if(null!=n[0]&&n[0]<=a){if(a<c)return this.method="next",this.arg=t,s(c),!0;if(a<l)return s(l),!1}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var s=this.tryEntries[r];if(s[0]>-1&&s[0]<=this.prev&&this.prev<s[2]){var i=s;break}}i&&("break"===e||"continue"===e)&&i[0]<=t&&t<=i[2]&&(i=null);var n=i?i[4]:{};return n.type=e,n.arg=t,i?(this.method="next",this.next=i[2],p):this.complete(n)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r[2]===e)return this.complete(r[4],r[3]),O(r),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r[0]===e){var s=r[4];if("throw"===s.type){var i=s.arg;O(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,r,s){return this.delegate={i:T(e),r:r,n:s},"next"===this.method&&(this.arg=t),p}},r}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},79:function(e){function t(r){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},88215:function(e,t,r){var s=r(75544)();e.exports=s;try{regeneratorRuntime=s}catch{"object"==typeof globalThis?globalThis.regeneratorRuntime=s:Function("r","regeneratorRuntime = r")(s)}},31693:function(e,t,r){"use strict";var s=r(6822),i=typeof globalThis>"u"?r.g:globalThis;e.exports=function(){for(var e=[],t=0;t<s.length;t++)"function"==typeof i[s[t]]&&(e[e.length]=s[t]);return e}},66674:function(e,t,r){"use strict";function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,s=Array(t);r<t;r++)s[r]=e[r];return s}r.d(t,{A:()=>s})},63972:function(e,t,r){"use strict";function s(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}r.d(t,{A:()=>s})},63588:function(e,t,r){"use strict";function s(e,t,r,s,i,n,o){try{var a=e[n](o),c=a.value}catch(e){return void r(e)}a.done?t(c):Promise.resolve(c).then(s,i)}function i(e){return function(){var t=this,r=arguments;return new Promise(function(i,n){var o=e.apply(t,r);function a(e){s(o,i,n,a,c,"next",e)}function c(e){s(o,i,n,a,c,"throw",e)}a(void 0)})}}r.d(t,{A:()=>i})},17330:function(e,t,r){"use strict";function s(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}r.d(t,{A:()=>s})},16932:function(e,t,r){"use strict";r.d(t,{A:()=>n});var s=r(45067);function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(0,s.A)(i.key),i)}}function n(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}},55564:function(e,t,r){"use strict";r.d(t,{A:()=>i});var s=r(45067);function i(e,t,r){return(t=(0,s.A)(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}},60433:function(e,t,r){"use strict";function s(){return(s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e}).apply(null,arguments)}r.d(t,{A:()=>s})},97009:function(e,t,r){"use strict";function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}r.d(t,{A:()=>s})},69874:function(e,t,r){"use strict";r.d(t,{A:()=>i});var s=r(12109);function i(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&(0,s.A)(e,t)}},3334:function(e,t,r){"use strict";r.d(t,{A:()=>i});var s=r(12109);function i(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,(0,s.A)(e,t)}},68058:function(e,t,r){"use strict";r.d(t,{A:()=>n});var s=r(55564);function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function n(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach(function(t){(0,s.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}},68036:function(e,t,r){"use strict";r.d(t,{A:()=>i});var s=r(91920);function i(e,t){if(null==e)return{};var r,i,n=(0,s.A)(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)r=o[i],-1===t.indexOf(r)&&({}).propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}},91920:function(e,t,r){"use strict";function s(e,t){if(null==e)return{};var r={};for(var s in e)if(({}).hasOwnProperty.call(e,s)){if(-1!==t.indexOf(s))continue;r[s]=e[s]}return r}r.d(t,{A:()=>s})},69691:function(e,t,r){"use strict";r.d(t,{A:()=>n});var s=r(26967),i=r(63972);function n(e,t){if(t&&("object"==(0,s.A)(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return(0,i.A)(e)}},12109:function(e,t,r){"use strict";function s(e,t){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}r.d(t,{A:()=>s})},69474:function(e,t,r){"use strict";r.d(t,{A:()=>i});var s=r(37643);function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"u">typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var s,i,n,o,a=[],c=!0,l=!1;try{if(n=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(s=n.call(r)).done)&&(a.push(s.value),a.length!==t);c=!0);}catch(e){l=!0,i=e}finally{try{if(!c&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(l)throw i}}return a}}(e,t)||(0,s.A)(e,t)||function(){throw TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}},11849:function(e,t,r){"use strict";r.d(t,{A:()=>n});var s=r(66674),i=r(37643);function n(e){return function(e){if(Array.isArray(e))return(0,s.A)(e)}(e)||function(e){if("u">typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||(0,i.A)(e)||function(){throw TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}},45067:function(e,t,r){"use strict";r.d(t,{A:()=>i});var s=r(26967);function i(e){var t=function(e,t){if("object"!=(0,s.A)(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=(0,s.A)(i))return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==(0,s.A)(t)?t:t+""}},26967:function(e,t,r){"use strict";function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}r.d(t,{A:()=>s})},37643:function(e,t,r){"use strict";r.d(t,{A:()=>i});var s=r(66674);function i(e,t){if(e){if("string"==typeof e)return(0,s.A)(e,t);var r=({}).toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?(0,s.A)(e,t):void 0}}},22300:function(e,t,r){"use strict";function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,s=Array(t);r<t;r++)s[r]=e[r];return s}r.d(t,{A:()=>s})},20298:function(e,t,r){"use strict";function s(e,t,r,s,i,n,o){try{var a=e[n](o),c=a.value}catch(e){return void r(e)}a.done?t(c):Promise.resolve(c).then(s,i)}function i(e){return function(){var t=this,r=arguments;return new Promise(function(i,n){var o=e.apply(t,r);function a(e){s(o,i,n,a,c,"next",e)}function c(e){s(o,i,n,a,c,"throw",e)}a(void 0)})}}r.d(t,{A:()=>i})},77408:function(e,t,r){"use strict";function s(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}r.d(t,{A:()=>s})},12958:function(e,t,r){"use strict";r.d(t,{A:()=>n});var s=r(18054);function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(0,s.A)(i.key),i)}}function n(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}},51034:function(e,t,r){"use strict";r.d(t,{A:()=>i});var s=r(18054);function i(e,t,r){return(t=(0,s.A)(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}},53847:function(e,t,r){"use strict";function s(){return(s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e}).apply(null,arguments)}r.d(t,{A:()=>s})},98665:function(e,t,r){"use strict";r.d(t,{A:()=>i});var s=r(31259);function i(){return(i="u">typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var i=function(e,t){for(;!({}).hasOwnProperty.call(e,t)&&null!==(e=(0,s.A)(e)););return e}(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(arguments.length<3?e:r):n.value}}).apply(null,arguments)}},31259:function(e,t,r){"use strict";function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}r.d(t,{A:()=>s})},45440:function(e,t,r){"use strict";r.d(t,{A:()=>i});var s=r(25743);function i(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&(0,s.A)(e,t)}},77332:function(e,t,r){"use strict";r.d(t,{A:()=>i});var s=r(25743);function i(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,(0,s.A)(e,t)}},50938:function(e,t,r){"use strict";r.d(t,{A:()=>i});var s=r(33774);function i(e,t){if(null==e)return{};var r,i,n=(0,s.A)(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)r=o[i],-1===t.indexOf(r)&&({}).propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}},33774:function(e,t,r){"use strict";function s(e,t){if(null==e)return{};var r={};for(var s in e)if(({}).hasOwnProperty.call(e,s)){if(-1!==t.indexOf(s))continue;r[s]=e[s]}return r}r.d(t,{A:()=>s})},4449:function(e,t,r){"use strict";r.d(t,{A:()=>i});var s=r(12857);function i(e,t){if(t&&("object"==(0,s.A)(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}},25743:function(e,t,r){"use strict";function s(e,t){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}r.d(t,{A:()=>s})},95228:function(e,t,r){"use strict";r.d(t,{A:()=>i});var s=r(65889);function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"u">typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var s,i,n,o,a=[],c=!0,l=!1;try{if(n=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(s=n.call(r)).done)&&(a.push(s.value),a.length!==t);c=!0);}catch(e){l=!0,i=e}finally{try{if(!c&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(l)throw i}}return a}}(e,t)||(0,s.A)(e,t)||function(){throw TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}},31467:function(e,t,r){"use strict";r.d(t,{A:()=>n});var s=r(22300),i=r(65889);function n(e){return function(e){if(Array.isArray(e))return(0,s.A)(e)}(e)||function(e){if("u">typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||(0,i.A)(e)||function(){throw TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}},18054:function(e,t,r){"use strict";r.d(t,{A:()=>i});var s=r(12857);function i(e){var t=function(e,t){if("object"!=(0,s.A)(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=(0,s.A)(i))return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==(0,s.A)(t)?t:t+""}},12857:function(e,t,r){"use strict";function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}r.d(t,{A:()=>s})},65889:function(e,t,r){"use strict";r.d(t,{A:()=>i});var s=r(22300);function i(e,t){if(e){if("string"==typeof e)return(0,s.A)(e,t);var r=({}).toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?(0,s.A)(e,t):void 0}}},71839:function(e,t,r){"use strict";r.d(t,{A:()=>o});var s=r(31259),i=r(25743);function n(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(n=function(){return!!e})()}function o(e){var t="function"==typeof Map?new Map:void 0;return(o=function(e){if(null===e||!function(e){try{return -1!==Function.toString.call(e).indexOf("[native code]")}catch{return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return function(e,t,r){if(n())return Reflect.construct.apply(null,arguments);var s=[null];s.push.apply(s,t);var o=new(e.bind.apply(e,s));return r&&(0,i.A)(o,r.prototype),o}(e,arguments,(0,s.A)(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),(0,i.A)(r,e)})(e)}}}]);